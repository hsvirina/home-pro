import{a as A,b as I,c as T,d as x}from"./chunk-TWPB6RSP.js";import{a as U,b as l,c as g}from"./chunk-XY75CFKU.js";import"./chunk-6D6MAEM6.js";import{a as y}from"./chunk-BVDCD44H.js";import"./chunk-XXNIOMYX.js";import{a as b}from"./chunk-X25XQKGC.js";import"./chunk-H5V2GQTQ.js";import{Db as S,O as a,R as o,T as n,Wa as v,Y as p,ba as r,bb as h,ca as m,da as u,ea as d,ma as f,nb as P}from"./chunk-EAEB62OB.js";function N(s,i){if(s&1&&(m(0,"div",1),d(1,"app-info-sector",2)(2,"app-achievement-sector",3)(3,"app-favorites-visited-sector",4)(4,"app-my-reviews",5),u()),s&2){let e=f();a(),r("editableUser",e.authUserProfile)("isEditing",!1)("badgeType",e.badgeType)("public",!0),a(),r("achievements",e.achievements)("unlockedTitles",e.unlockedAchievementTitles)("public",!0),a(),r("favoritePlaces",e.favoritePlaces)("visitedPlaces",e.visitedPlaces)("isPublic",!0),a(),r("userId",e.authUserProfile.userId)("places",e.allPlaces)("badgeType",e.badgeType)("userPhotoUrl",e.authUserProfile.photoUrl)}}var C=class s{constructor(i,e,t,c){this.route=i;this.authApiService=e;this.loaderService=t;this.placesService=c}profile=null;authUserProfile=null;achievements=l;unlockedAchievementTitles=new Set;favoritePlaces=[];visitedPlaces=[];allPlaces=[];badgeType=null;ngOnInit(){let i=this.getUserIdFromRoute();i!==null&&this.loadUserProfile(i)}getUserIdFromRoute(){let i=this.route.snapshot.paramMap.get("id"),e=i?Number(i):NaN;return isNaN(e)?null:e}loadUserProfile(i){this.loaderService.show(),this.placesService.getPlaces().subscribe({next:e=>{this.allPlaces=e,this.fetchUserProfile(i)},error:()=>{this.loaderService.hide()}})}fetchUserProfile(i){this.authApiService.getPublicUserProfile(i).subscribe({next:e=>{this.profile=e,this.authUserProfile=this.mapPublicProfileToAuthUser(e),this.updateAchievements(e),this.updatePlaces(e),this.loaderService.hide()},error:()=>{this.resetProfileData(),this.loaderService.hide()}})}mapPublicProfileToAuthUser(i){return{userId:i.id,firstName:i.firstName,lastName:i.lastName,email:i.email,photoUrl:i.photoUrl,status:i.statusText??null,defaultCity:i.city,favoriteCafeIds:i.favoriteCafes.map(e=>e.id),theme:"light",emailNotifications:!1,pushNotifications:!1,reviewNotifications:!1,locationSharing:!1}}updateAchievements(i){let e=g(i);this.unlockedAchievementTitles=new Set(e.flatMap(t=>t.achievements.map(c=>c.key))),this.badgeType=U(e,l)}updatePlaces(i){this.favoritePlaces=this.allPlaces.filter(e=>i.favoriteCafes.some(t=>t.id===e.id)),this.visitedPlaces=this.allPlaces.filter(e=>i.checkInCafes.some(t=>t.id===e.id))}resetProfileData(){this.profile=null,this.authUserProfile=null,this.favoritePlaces=[],this.visitedPlaces=[]}static \u0275fac=function(e){return new(e||s)(o(P),o(S),o(y),o(b))};static \u0275cmp=n({type:s,selectors:[["app-public-user-profile"]],decls:1,vars:1,consts:[["class","mx-auto flex max-w-[1320px] flex-col gap-8 pb-[78px]",4,"ngIf"],[1,"mx-auto","flex","max-w-[1320px]","flex-col","gap-8","pb-[78px]"],[3,"editableUser","isEditing","badgeType","public"],[3,"achievements","unlockedTitles","public"],[3,"favoritePlaces","visitedPlaces","isPublic"],[3,"userId","places","badgeType","userPhotoUrl"]],template:function(e,t){e&1&&p(0,N,5,14,"div",0),e&2&&r("ngIf",t.authUserProfile)},dependencies:[h,v,A,I,T,x],encapsulation:2})};export{C as PublicUserProfileComponent};
