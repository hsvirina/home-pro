import{a as Pe,b as Se}from"./chunk-MB6SXXIW.js";import{a as Te}from"./chunk-2PS7XOXG.js";import{a as q}from"./chunk-GCYQK47Q.js";import{l as he,m as ve}from"./chunk-H4NB5YVJ.js";import{a as ye}from"./chunk-ZQAMXLUC.js";import{a as Fe,e as we}from"./chunk-F4QUQQ5E.js";import"./chunk-FQAFXMSY.js";import{a as ue,c as Ce,f as _e,j as B}from"./chunk-OVFD7ZCN.js";import{$ as p,$a as T,A as h,B as v,C as ne,Fa as ce,Ja as m,Ka as f,M as o,P as u,R as P,Sa as ge,Ta as w,Ua as S,W as C,X as I,Y as ae,Ya as de,_ as oe,a as te,aa as a,ba as l,ca as k,f as ie,ga as N,ha as D,ia as b,ja as d,ka as c,lb as me,na as le,nb as fe,oa as se,pa as pe,rb as $,s as M,sa as V,ta as g,tb as K,ua as F,ub as E,va as _,vb as O,w as re,wb as be,xa as j,xb as xe,ya as R,za as G}from"./chunk-2Z55U5GN.js";var Le=(r,t)=>({"border border-[var(--color-white)] bg-[var(--color-white)] text-[var(--color-gray-100)]":r,"border border-[var(--color-bg)] bg-[var(--color-bg-card)] text-[var(--color-gray-10)]":t});function Ve(r,t){if(r&1){let e=b();a(0,"label",10)(1,"input",11),G("ngModelChange",function(n){let s=h(e).$implicit,A=c(2).$implicit,x=c();return R(x.internalFilters[A.key][s.key],n)||(x.internalFilters[A.key][s.key]=n),v(n)}),l(),k(2,"span",12),g(3),l()}if(r&2){let e=t.$implicit,i=c(2).$implicit,n=c();o(),j("ngModel",n.internalFilters[i.key][e.key]),o(2),_(" ",e.label," ")}}function ze(r,t){if(r&1&&(a(0,"div",6)(1,"h5"),g(2),m(3,"translate"),l(),a(4,"div",7),C(5,Ve,4,2,"label",8),l(),k(6,"div",9),l()),r&2){let e=c().$implicit;o(2),F(f(3,2,e.title)),o(3),p("ngForOf",e.options)}}function Me(r,t){if(r&1&&(N(0),C(1,ze,7,4,"div",5),D()),r&2){let e=t.$implicit,i=c();o(),p("ngIf",i.internalFilters[e.key])}}var Q=class r{constructor(t){this.themeService=t;this.currentTheme$=this.themeService.theme$}filtersChange=new I;_filterCategories=[];set filterCategories(t){this._filterCategories=t,this.internalFilters=this.initializeFilters(this._filters)}get filterCategories(){return this._filterCategories}_filters={};set filters(t){this._filters=t,this.internalFilters=this.initializeFilters(t)}get filters(){return this._filters}internalFilters={};currentTheme$;applyFilters(){this.filtersChange.emit(this.deepClone(this.internalFilters))}clearAll(){for(let t in this.internalFilters)for(let e in this.internalFilters[t])this.internalFilters[t][e]=!1;this.applyFilters()}initializeFilters(t){let e={};for(let i of this._filterCategories){e[i.key]={};for(let n of i.options)e[i.key][n.key]=t?.[i.key]?.[n.key]??!1}return e}deepClone(t){return JSON.parse(JSON.stringify(t))}static \u0275fac=function(e){return new(e||r)(u($))};static \u0275cmp=P({type:r,selectors:[["app-catalog-filters"]],inputs:{filterCategories:"filterCategories",filters:"filters"},outputs:{filtersChange:"filtersChange"},decls:15,vars:21,consts:[[1,"flex","flex-col","gap-6","rounded-[24px]","p-6","xxl:w-full",3,"ngClass"],[1,"flex","items-center","justify-between"],["type","button",3,"click"],[4,"ngFor","ngForOf"],["type","button",1,"button-font","button-bg-blue","h-12","px-6","py-3",3,"click"],["class","flex flex-col gap-3",4,"ngIf"],[1,"flex","flex-col","gap-3"],[1,"flex","flex-col","gap-2"],["class","body-font-1 flex cursor-pointer select-none items-center gap-3",4,"ngFor","ngForOf"],[1,"my-2","h-px","bg-[var(--color-gray-20)]"],[1,"body-font-1","flex","cursor-pointer","select-none","items-center","gap-3"],["type","checkbox",1,"peer","sr-only",3,"ngModelChange","ngModel"],[1,"relative","flex","h-8","w-8","items-center","justify-center","rounded-lg","border","border-[var(--color-gray-20)]","before:absolute","before:left-1/2","before:top-1/2","before:h-4","before:w-2","before:-translate-x-1/2","before:-translate-y-[60%]","before:rotate-45","before:border-b-2","before:border-r-2","before:border-[var(--color-primary)]","before:opacity-0","before:transition-opacity","peer-checked:border-[var(--color-primary)]","peer-checked:before:opacity-100"]],template:function(e,i){e&1&&(a(0,"div",0),m(1,"async"),m(2,"async"),a(3,"div",1)(4,"h5"),g(5),m(6,"translate"),l(),a(7,"button",2),m(8,"translate"),d("click",function(){return i.clearAll()}),g(9),m(10,"translate"),l()(),C(11,Me,2,1,"ng-container",3),a(12,"button",4),d("click",function(){return i.applyFilters()}),g(13),m(14,"translate"),l()()),e&2&&(p("ngClass",ce(18,Le,f(1,6,i.currentTheme$)==="light",f(2,8,i.currentTheme$)==="dark")),o(5),F(f(6,10,"CATALOG.FILTERS.HEADER")),o(2),oe("aria-label",f(8,12,"CATALOG.FILTERS.CLEAR_ALL_ARIA")),o(2),_(" ",f(10,14,"CATALOG.FILTERS.CLEAR_ALL")," "),o(2),p("ngForOf",i.filterCategories),o(2),_(" ",f(14,16,"CATALOG.FILTERS.APPLY")," "))},dependencies:[T,ge,w,S,B,ue,Ce,_e,O,de,E],encapsulation:2})};function Ne(r,t){if(r&1){let e=b();a(0,"button",3),d("click",function(){let n=h(e).$implicit,s=c(2);return v(s.onPageChange(n))}),g(1),l()}if(r&2){let e=t.$implicit,i=c(2);V("bg-blue-600",e===i.currentPage)("text-white",e===i.currentPage)("bg-gray-200",e!==i.currentPage)("text-gray-700",e!==i.currentPage),p("disabled",e===i.currentPage),o(),_(" ",e," ")}}function De(r,t){if(r&1&&(N(0),a(1,"div",1),C(2,Ne,2,10,"button",2),l(),D()),r&2){let e=c();o(2),p("ngForOf",e.totalPagesArray)}}var H=class r{totalItems=0;selectedSize=6;currentPage=1;pageChange=new I;get totalPages(){return this.selectedSize===-1?1:Math.ceil(this.totalItems/this.selectedSize)}get totalPagesArray(){return Array.from({length:this.totalPages},(t,e)=>e+1)}onPageChange(t){this.pageChange.emit(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=P({type:r,selectors:[["app-pagination"]],inputs:{totalItems:"totalItems",selectedSize:"selectedSize",currentPage:"currentPage"},outputs:{pageChange:"pageChange"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"flex","w-full","justify-center","gap-2"],["class","button-bg-blue flex h-10 w-10",3,"disabled","bg-blue-600","text-white","bg-gray-200","text-gray-700","click",4,"ngFor","ngForOf"],[1,"button-bg-blue","flex","h-10","w-10",3,"click","disabled"]],template:function(e,i){e&1&&C(0,De,3,1,"ng-container",0),e&2&&p("ngIf",i.selectedSize!==-1)},dependencies:[T,w,S],encapsulation:2})};function je(r,t){if(r&1){let e=b();a(0,"div",7),d("click",function(){let n=h(e).$implicit,s=c(2);return v(s.selectOption(n.value))}),g(1),m(2,"translate"),l()}if(r&2){let e=t.$implicit,i=c(2);V("font-bold",e.value===i.selectedValue),o(),_(" ",f(2,3,"CATALOG.ITEMS_PER_PAGE."+(e.label==="All"?"ALL":e.label))," ")}}function Re(r,t){if(r&1&&(a(0,"div",5),C(1,je,3,5,"div",6),l()),r&2){let e=c();o(),p("ngForOf",e.sizeOptions)}}var Z=class r{constructor(t){this.translate=t}selectedValue;selectedValueChange=new I;dropdownOpen=!1;sizeOptions=[{label:"6",value:6},{label:"12",value:12},{label:"All",value:-1}];toggleDropdown(){this.dropdownOpen=!this.dropdownOpen}selectOption(t){this.selectedValueChange.emit(t),this.dropdownOpen=!1}getSelectedLabel(){let t=this.sizeOptions.find(e=>e.value===this.selectedValue);if(!t)return"Select";switch(t.label){case"All":return this.translate.instant("CATALOG.ITEMS_PER_PAGE.ALL");case"6":return this.translate.instant("CATALOG.ITEMS_PER_PAGE.6");case"12":return this.translate.instant("CATALOG.ITEMS_PER_PAGE.12");default:return t.label}}static \u0275fac=function(e){return new(e||r)(u(K))};static \u0275cmp=P({type:r,selectors:[["app-page-size-dropdown"]],inputs:{selectedValue:"selectedValue"},outputs:{selectedValueChange:"selectedValueChange"},decls:9,vars:7,consts:[[1,"custom-dropdown","relative","flex","items-center","gap-2"],[1,"flex","w-[80px]","cursor-pointer","items-center","justify-between","rounded","px-3","py-1",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"ml-2","h-4","w-4","transform","transition-transform","duration-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["class","absolute right-0 top-[110%] z-20 w-[80px] rounded-[16px] border p-2 bg-white dark:bg-gray-800 border-gray-300",4,"ngIf"],[1,"absolute","right-0","top-[110%]","z-20","w-[80px]","rounded-[16px]","border","p-2","bg-white","dark:bg-gray-800","border-gray-300"],["class","cursor-pointer rounded px-2 py-1 transition-colors duration-300 hover:bg-gray-200 dark:hover:bg-gray-700",3,"font-bold","click",4,"ngFor","ngForOf"],[1,"cursor-pointer","rounded","px-2","py-1","transition-colors","duration-300","hover:bg-gray-200","dark:hover:bg-gray-700",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"span"),g(2),m(3,"translate"),l(),a(4,"div",1),d("click",function(){return i.toggleDropdown()}),g(5),ne(),a(6,"svg",2),k(7,"path",3),l()(),C(8,Re,2,1,"div",4),l()),e&2&&(o(2),F(f(3,5,"CATALOG.SHOW_LABEL")),o(3),_(" ",i.getSelectedLabel()," "),o(),V("rotate-180",i.dropdownOpen),o(2),p("ngIf",i.dropdownOpen))},dependencies:[T,w,S,O,E],encapsulation:2})};function Ie(r,t,e){if(e===-1)return[...r];let i=(t-1)*e;return r.slice(i,i+e)}var U=class r{filterPlaces(t,e,i){return t.filter(n=>{let s=n.tags||[],A=n.city.toLowerCase();for(let x in e){let z=Object.keys(e[x]).filter(L=>e[x][L]);if(z.length!==0){if(x==="location"){let L=i.find(y=>y.key==="location");if(!z.map(y=>{let ee=L?.options.find(Oe=>Oe.key===y);return ee?ee.label.toLowerCase():y.toLowerCase()}).some(y=>A.includes(y)))return!1}else if(!z.some(L=>{let X=this.getLabelByKey(i,x,L);return s.some(y=>y.name===X)}))return!1}}return!0})}getLabelByKey(t,e,i){return t.find(s=>s.key===e)?.options.find(s=>s.key===i)?.label||""}static \u0275fac=function(e){return new(e||r)};static \u0275prov=re({token:r,factory:r.\u0275fac,providedIn:"root"})};var Be=["filtersPanel"];function $e(r,t){if(r&1){let e=b();a(0,"div",25),d("click",function(){h(e);let n=c();return v(n.toggleFilters())}),a(1,"div",26,0),d("click",function(n){return h(e),v(n.stopPropagation())}),a(3,"div",27)(4,"app-icon",28),d("click",function(){h(e);let n=c();return v(n.toggleFilters())}),l()(),a(5,"app-catalog-filters",29),d("filtersChange",function(n){h(e);let s=c();return v(s.onFiltersChange(n))}),l()()()}if(r&2){let e=c();o(4),p("icon",e.ICONS.Close),o(),p("filters",e.filters)("filterCategories",e.filterCategories)}}function Ke(r,t){if(r&1){let e=b();a(0,"app-place-card",30),d("unauthorizedFavoriteClick",function(){h(e);let n=c();return v(n.showLoginModal())}),l()}if(r&2){let e=t.$implicit,i=c();p("place",e)("cardType",i.PlaceCardType.Catalog)}}function Qe(r,t){r&1&&(a(0,"div",31)(1,"h3"),g(2),m(3,"translate"),l(),a(4,"p",32),g(5),m(6,"translate"),l()()),r&2&&(o(2),F(f(3,2,"CATALOG.NO_CAFES_FOUND_TITLE")),o(3),_(" ",f(6,4,"CATALOG.NO_CAFES_FOUND_DESC")," "))}var Ee=class r{constructor(t,e,i,n,s,A,x,z){this.router=t;this.route=e;this.loaderService=i;this.themeService=n;this.translate=s;this.placesStore=A;this.catalogFilterService=x;this.ngZone=z;this.currentTheme$=this.themeService.theme$}ICONS=be;PlaceCardType=Fe;filtersPanel;places=[];filteredPlaces=[];paginatedPlaces=[];filters={};filterCategories=q;showFilters=!1;isLoginModalVisible=!1;itemsPerPage=-1;currentPage=1;currentTheme$;destroy$=new ie;updatingFromQueryParams=!1;ngOnInit(){this.loaderService.show(),this.placesStore.loadPlaces(),this.placesStore.places$.pipe(M(this.destroy$)).subscribe({next:t=>{this.places=t||[],this.setFilterCategories(this.translate.currentLang),this.initializeFilters(),this.filterAndPaginate(),this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngZone.run(()=>{setTimeout(()=>this.loaderService.hide(),300)})},0)})},error:t=>{console.error("Error loading places:",t),this.loaderService.hide()}}),this.route.queryParams.pipe(M(this.destroy$)).subscribe(t=>{if(this.loaderService.show(),this.updatingFromQueryParams)this.updatingFromQueryParams=!1;else{this.initializeFilters();for(let e in t)this.filters[e]||(this.filters[e]={}),(Array.isArray(t[e])?t[e]:[t[e]]).forEach(n=>this.filters[e][n]=!0)}this.filterAndPaginate(),setTimeout(()=>this.loaderService.hide(),300)}),this.translate.onLangChange.pipe(M(this.destroy$)).subscribe(t=>{this.setFilterCategories(t.lang),this.initializeFilters(),this.filterAndPaginate()})}onFiltersChange(t){this.loaderService.show(),this.filters=te({},t);let e={};for(let i in this.filters){let n=Object.keys(this.filters[i]).filter(s=>this.filters[i][s]);n.length&&(e[i]=n)}this.updatingFromQueryParams=!0,this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:""}),this.showFilters=!1,document.body.style.overflow=""}initializeFilters(){this.filters={};for(let t of this.filterCategories){this.filters[t.key]={};for(let e of t.options)this.filters[t.key][e.key]=!1}}toggleFilters(){this.showFilters=!this.showFilters,document.body.style.overflow=this.showFilters?"hidden":""}setFilterCategories(t){this.filterCategories=t==="uk"?Pe:q}onPageChange(t){this.currentPage=t,this.updatePaginatedPlaces(),window.scrollTo({top:0,behavior:"smooth"})}onPageSizeChange(t){this.itemsPerPage=t,this.currentPage=1,this.updatePaginatedPlaces()}filterAndPaginate(){this.filteredPlaces=this.catalogFilterService.filterPlaces(this.places,this.filters,this.filterCategories),this.updatePaginatedPlaces()}updatePaginatedPlaces(){this.paginatedPlaces=Ie(this.filteredPlaces,this.currentPage,this.itemsPerPage)}showLoginModal(){this.isLoginModalVisible=!0}onLoginClick(){this.isLoginModalVisible=!1,this.router.navigate(["/login"])}get hasActiveFilters(){return Object.values(this.filters).some(t=>Object.values(t).some(e=>e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||r)(u(fe),u(me),u(ye),u($),u(K),u(Se),u(U),u(ae))};static \u0275cmp=P({type:r,selectors:[["app-catalog-page"]],viewQuery:function(e,i){if(e&1&&le(Be,5),e&2){let n;se(n=pe())&&(i.filtersPanel=n.first)}},decls:36,vars:19,consts:[["filtersPanel",""],[1,"mx-auto","grid","w-full","max-w-[1320px]","grid-cols-4","gap-[16px]","px-[20px]","xxl:grid-cols-8","xxl:gap-[20px]","xxl:px-[0px]"],[1,"col-span-4","xxl:col-span-8"],[1,"col-span-4","mb-[60px]","text-center","text-[32px]","xxl:col-span-8","xxl:text-[64px]"],[1,"text-[var(--color-primary)]"],[1,"col-span-4","mb-[40px]","h-[48px]","rounded-[40px]","border","border-[var(--color-gray-20)]","xxl:hidden"],["aria-label","Toggle filters",1,"flex","h-full","w-full","items-center","justify-center",3,"click"],[1,"mb-4","flex","justify-end"],[3,"selectedValueChange","selectedValue"],["aria-label","Catalog filters sidebar",1,"col-span-4","hidden","xxl:col-span-2","xxl:block"],[3,"filtersChange","filters","filterCategories"],["class","fixed inset-0 z-50 h-full w-full max-w-full xxl:hidden","appClickOutside","","role","dialog","aria-modal","true","aria-labelledby","filters-panel-title",3,"click",4,"ngIf"],["aria-live","polite",1,"col-span-4","lg:col-span-6"],[1,"grid","grid-cols-1","gap-5","sm:grid-cols-2","lg:grid-cols-3"],[3,"place","cardType","unauthorizedFavoriteClick",4,"ngFor","ngForOf"],["class","col-span-full flex flex-col items-center justify-center gap-4 p-12 text-center","role","alert","aria-live","assertive",4,"ngIf"],[1,"col-span-4","mt-6","flex","flex-col","items-center","gap-4","lg:col-span-6","xxl:col-span-8","xxl:mb-[148px]"],["aria-label","Catalog pagination",3,"pageChange","totalItems","selectedSize","currentPage"],["width","400px","role","dialog","aria-modal","true","aria-labelledby","login-modal-title",3,"close","isOpen"],[1,"flex","flex-col","items-center","gap-3"],["id","login-modal-title",1,"mb-4","text-xl","font-semibold"],[1,"mb-6"],[1,"flex","flex-wrap","justify-end","gap-4"],["aria-label","Login",1,"button-bg-blue","min-w-[120px]","px-6","py-3",3,"click"],["aria-label","Close",1,"button-bg-transparent","px-6","py-3",3,"click"],["appClickOutside","","role","dialog","aria-modal","true","aria-labelledby","filters-panel-title",1,"fixed","inset-0","z-50","h-full","w-full","max-w-full","xxl:hidden",3,"click"],[1,"relative","h-full","w-full","max-w-full","overflow-y-auto","bg-[var(--color-gray-20)]","px-[20px]","pt-[12px]","box-border",3,"click"],[1,"mb-[25px]","ml-auto","flex","h-[40px]","w-[40px]","items-center","justify-center","rounded-[40px]","bg-white"],["aria-label","Close filters",1,"cursor-pointer",3,"click","icon"],[1,"w-full","max-w-full","box-border",3,"filtersChange","filters","filterCategories"],[3,"unauthorizedFavoriteClick","place","cardType"],["role","alert","aria-live","assertive",1,"col-span-full","flex","flex-col","items-center","justify-center","gap-4","p-12","text-center"],[1,"max-w-sm"]],template:function(e,i){e&1&&(a(0,"div",1)(1,"div",2),k(2,"app-breadcrumbs"),l(),a(3,"h2",3),g(4),m(5,"translate"),a(6,"span",4),g(7),m(8,"translate"),l()(),a(9,"div",5)(10,"button",6),d("click",function(){return i.toggleFilters()}),g(11),m(12,"translate"),l()(),a(13,"div",2)(14,"div",7)(15,"app-page-size-dropdown",8),G("selectedValueChange",function(s){return R(i.itemsPerPage,s)||(i.itemsPerPage=s),s}),d("selectedValueChange",function(s){return i.onPageSizeChange(s)}),l()()(),a(16,"div",9)(17,"app-catalog-filters",10),d("filtersChange",function(s){return i.onFiltersChange(s)}),l()(),C(18,$e,6,3,"div",11),a(19,"div",12)(20,"div",13),C(21,Ke,1,2,"app-place-card",14)(22,Qe,7,6,"div",15),l()(),a(23,"div",16)(24,"app-pagination",17),d("pageChange",function(s){return i.onPageChange(s)}),l()(),a(25,"app-modal",18),d("close",function(){return i.isLoginModalVisible=!1}),a(26,"div",19)(27,"h2",20),g(28," Please log in "),l(),a(29,"p",21),g(30," You need to be logged in to add cafes to your favorites. "),l(),a(31,"div",22)(32,"button",23),d("click",function(){return i.onLoginClick()}),g(33," Login "),l(),a(34,"button",24),d("click",function(){return i.isLoginModalVisible=!1}),g(35," Close "),l()()()()()),e&2&&(o(4),_(" ",f(5,13,"CATALOG.TITLE")," "),o(3),F(f(8,15,"CATALOG.HIGHLIGHT")),o(4),_(" ",f(12,17,"CATALOG.FILTERS_BUTTON")," "),o(4),j("selectedValue",i.itemsPerPage),o(2),p("filters",i.filters)("filterCategories",i.filterCategories),o(),p("ngIf",i.showFilters),o(3),p("ngForOf",i.paginatedPlaces),o(),p("ngIf",i.paginatedPlaces.length===0&&i.hasActiveFilters),o(2),p("totalItems",i.filteredPlaces.length)("selectedSize",i.itemsPerPage)("currentPage",i.currentPage),o(),p("isOpen",i.isLoginModalVisible))},dependencies:[T,w,S,B,O,Q,Te,H,xe,we,Z,he,E],encapsulation:2,data:{animation:[ve]}})};export{Ee as CatalogPageComponent};
