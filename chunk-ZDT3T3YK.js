import{B as l,Bb as be,Ca as re,Cb as Se,Db as ye,Eb as S,Ga as w,H as G,Ha as P,Ja as oe,Ka as n,L as B,La as c,Ma as ae,O as o,Qa as ne,R as u,T as J,Ta as se,Ua as ce,Va as pe,Y as D,Z as M,Za as le,_ as K,a as Z,ab as de,ba as a,ca as s,da as d,db as ue,ea as I,f as q,fb as A,g as V,i as W,ia as X,j as _,ja as Y,k as Q,la as T,ma as k,ob as ve,pa as ee,qa as te,ra as ie,t as N,ta as R,ub as me,v as f,va as g,vb as he,wb as fe,xa as b,xb as ge,y as m,yb as Ce,zb as F}from"./chunk-F4VAWNME.js";var z=(t=>(t.Full="full",t.Favourites="favourites",t.Catalog="catalog",t))(z||{});var j=class r{constructor(e,i){this.http=e;this.authService=i}baseUrl=F.user.favorites;getAuthHeaders(){let e=this.authService.getToken();return e?W(new ue({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})):_(()=>new Error("Authorization token is missing"))}addFavorite(e){return this.getAuthHeaders().pipe(N(i=>this.http.post(this.baseUrl,{cafeId:e},{headers:i})))}removeFavorite(e){return this.getAuthHeaders().pipe(N(i=>this.http.request("delete",this.baseUrl,{headers:i,body:{cafeId:e}})))}static \u0275fac=function(i){return new(i||r)(l(A),l(S))};static \u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})};var O=class r{constructor(e,i){this.favoritesService=e;this.authService=i;this.loadFavorites()}favoritesSubject=new V([]);favorites$=this.favoritesSubject.asObservable();loadFavorites(){let e=this.authService.getCurrentUser();e?.favoriteCafeIds?this.favoritesSubject.next(e.favoriteCafeIds):this.favoritesSubject.next([])}addFavorite(e){return this.favoritesService.addFavorite(e).pipe(f(()=>{let i=this.favoritesSubject.value;i.includes(e)||this.favoritesSubject.next([...i,e])}))}removeFavorite(e){return this.favoritesService.removeFavorite(e).pipe(f(()=>{let i=this.favoritesSubject.value.filter(t=>t!==e);this.favoritesSubject.next(i)}))}isFavorite(e){return this.favoritesSubject.value.includes(e)}static \u0275fac=function(i){return new(i||r)(l(j),l(S))};static \u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})};var $=class r{constructor(e,i){this.authService=e;this.favoritesStore=i}isFavorite(e){return this.favoritesStore.isFavorite(e)}toggleFavorite(e){if(!this.authService.getCurrentUser())return _(()=>new Error("NOT_AUTHENTICATED"));let t=e.id,p=this.favoritesStore.isFavorite(t);return(p?this.favoritesStore.removeFavorite(t):this.favoritesStore.addFavorite(t)).pipe(f(()=>{let v=this.authService.getCurrentUser();v&&(v.favoriteCafeIds=p?v.favoriteCafeIds.filter(C=>C!==t):[...v.favoriteCafeIds,t],this.authService.updateCurrentUser(Z({},v)))}),Q(()=>!p))}static \u0275fac=function(i){return new(i||r)(l(S),l(O))};static \u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})};var H=class r{constructor(e){this.http=e}checkInsUpdatedSource=new q;checkInsUpdated$=this.checkInsUpdatedSource.asObservable();checkInToCafe(e){return this.http.post(`${F.checkins.base}/${e}`,null).pipe(f(()=>this.checkInsUpdatedSource.next()))}getCheckInsByCafe(e){return this.http.get(`${F.checkins.base}/cafe/${e}`)}static \u0275fac=function(i){return new(i||r)(l(A))};static \u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})};var Ae=["tagsContainer"],je=(r,e,i,t)=>({"h-[510px]":r,"h-[334px]":e,"bg-[var(--color-white)] hover:bg-[var(--color-gray-10)]":i,"bg-[var(--color-bg-card)] hover:bg-[var(--color-gray-100)]":t}),Te=(r,e)=>({"bg-[#FFFFFF]/60":r,"bg-[#0D0D0D]/60":e}),Ee=(r,e)=>({"text-[var(--color-gray-75)]":r,"text-[var(--color-white)]":e}),Oe=r=>({"text-[var(--color-gray-10)]":r}),$e=r=>({"text-[var(--color-white)]":r}),He=r=>({city:r});function Ue(r,e){if(r&1&&(s(0,"p",16),g(1),d()),r&2){let i=k();o(),b(" ",i.place.shortDescription," ")}}function Ne(r,e){if(r&1&&(s(0,"span",20),n(1,"async"),g(2),d()),r&2){let i=e.$implicit,t=k(2);R("background-color",c(1,3,t.currentTheme$)==="dark"?t.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)"),o(2),b(" ",i.name," ")}}function Be(r,e){if(r&1&&(s(0,"span",20),n(1,"async"),g(2," ... "),d()),r&2){let i=k(2);R("background-color",c(1,2,i.currentTheme$)==="dark"?i.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)")}}function De(r,e){if(r&1&&(s(0,"div",17,0),X(2),D(3,Ne,3,5,"span",18)(4,Be,3,4,"span",19),Y(),d()),r&2){let i=k();o(3),a("ngForOf",i.displayTags),o(),a("ngIf",i.showEllipsis)}}var ke=class r{constructor(e,i,t,p,h,v,C,x){this.cdr=e;this.ngZone=i;this.router=t;this.favoriteToggleService=p;this.themeService=h;this.storageService=v;this.checkInsService=C;this.userService=x;this.currentTheme$=this.themeService.theme$}place;cardType="full";unauthorizedFavoriteClick=new M;favoriteToggled=new M;tagsContainer;displayTags=[];showEllipsis=!1;isHovered=!1;isCheckedIn=!1;ICONS=ge;PlaceCardType=z;currentTheme$;ngOnChanges(){this.place?.tags&&(this.displayTags=[...this.place.tags]),this.updateCheckInStatus()}ngAfterViewInit(){this.cardType==="full"&&(this.displayTags=[...this.place.tags],this.updateCheckInStatus(),this.ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{let e=this.tagsContainer.nativeElement,i=getComputedStyle(e),t=parseFloat(i.gap)||0,p=e.clientWidth,h=2,v=Array.from(e.querySelectorAll("span")),C=[],x=0,L=1;for(let y=0;y<this.place.tags.length;y++){let U=v[y]?.offsetWidth||0;if(x+U<=p)C.push(this.place.tags[y]),x+=U+t;else{if(L++,L>h){this.showEllipsis=!0;break}C.push(this.place.tags[y]),x=U+t}}this.ngZone.run(()=>{this.displayTags=C,this.cdr.detectChanges()})})}))}get isFavorite(){return this.favoriteToggleService.isFavorite(this.place.id)}get isAuthenticated(){return!!this.storageService.getUser()}onCardClick(){this.router.navigate(["/catalog",this.place.id])}onToggleFavorite(e){e.preventDefault(),e.stopPropagation(),this.favoriteToggleService.toggleFavorite(this.place).subscribe({next:i=>{this.cdr.detectChanges(),this.favoriteToggled.emit({placeId:this.place.id,isFavorite:i})},error:i=>{i.message==="NOT_AUTHENTICATED"?this.unauthorizedFavoriteClick.emit():alert("An error occurred while updating favorites.")}})}getGoogleMapsLink(e){return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`}updateCheckInStatus(){if(!this.place)return;let e=this.storageService.getPublicUserProfile();e&&e.checkInCafes?this.isCheckedIn=e.checkInCafes.some(i=>i.id===this.place.id):this.isCheckedIn=!1,this.cdr.detectChanges()}onCheckInClick(e){this.isAuthenticated&&(e.preventDefault(),e.stopPropagation(),!this.isCheckedIn&&this.performCheckIn())}performCheckIn(){this.checkInsService.checkInToCafe(this.place.id).subscribe({next:()=>{this.userService.getPublicUserProfile(this.storageService.getUser()?.userId||0).subscribe({next:e=>{this.storageService.setPublicUserProfile(e),this.isCheckedIn=!0,this.cdr.detectChanges(),this.router.navigate(["/catalog",this.place.id])},error:e=>{console.error("Error updating public profile:",e)}})},error:e=>{console.error("Error during check-in:",e)}})}static \u0275fac=function(i){return new(i||r)(u(ne),u(K),u(ve),u($),u(fe),u(ye),u(H),u(Se))};static \u0275cmp=J({type:r,selectors:[["app-place-card"]],viewQuery:function(i,t){if(i&1&&ee(Ae,5),i&2){let p;te(p=ie())&&(t.tagsContainer=p.first)}},inputs:{place:"place",cardType:"cardType"},outputs:{unauthorizedFavoriteClick:"unauthorizedFavoriteClick",favoriteToggled:"favoriteToggled"},features:[G],decls:33,vars:65,consts:[["tagsContainer",""],[1,"box-border","w-full","cursor-pointer","overflow-hidden","rounded-[40px]","transition-colors","duration-300",3,"mouseenter","mouseleave","ngClass"],[1,"block","w-full","no-underline",3,"click"],[1,"relative"],["alt","Place Image",1,"h-[222px]","w-full","rounded-t-[40px]","object-cover",3,"src"],[1,"absolute","left-[12px]","top-[12px]","z-10","flex","items-center","justify-center","gap-1","rounded-[40px]","px-2","py-[4px]","backdrop-blur",3,"ngClass"],[1,"body-font-1",3,"ngClass"],[3,"icon"],[1,"absolute","right-[12px]","top-[12px]","z-10","flex","h-[32px]","w-[32px]","items-center","justify-center","rounded-[40px]","p-[4px]","backdrop-blur",3,"click","ngClass","title"],[1,"flex","flex-col","gap-[12px]","p-[12px]",3,"ngClass"],[1,"flex","h-[52px]","items-start","justify-between"],[3,"ngClass"],["target","_blank","rel","noopener noreferrer",1,"group","flex","items-center","gap-2",3,"click","href"],[1,"body-font-1","relative","underline"],["class","body-font-1 line-clamp-3 h-[72px] overflow-hidden",4,"ngIf"],["class","flex h-[80px] flex-wrap gap-2 overflow-hidden",4,"ngIf"],[1,"body-font-1","line-clamp-3","h-[72px]","overflow-hidden"],[1,"flex","h-[80px]","flex-wrap","gap-2","overflow-hidden"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngFor","ngForOf"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngIf"],[1,"body-font-2","whitespace-nowrap","rounded-[40px]","px-[12px]","py-[8px]",2,"transition","background-color 0.3s ease"]],template:function(i,t){i&1&&(s(0,"div",1),n(1,"async"),n(2,"async"),T("mouseenter",function(){return t.isHovered=!0})("mouseleave",function(){return t.isHovered=!1}),s(3,"div",2),T("click",function(){return t.onCardClick()}),s(4,"div",3),I(5,"img",4),s(6,"div",5),n(7,"async"),n(8,"async"),s(9,"span",6),n(10,"async"),n(11,"async"),g(12),d(),I(13,"app-icon",7),d(),s(14,"button",8),n(15,"translate"),n(16,"async"),n(17,"async"),T("click",function(h){return t.onToggleFavorite(h)}),I(18,"app-icon",7),n(19,"themedIcon"),d()(),s(20,"div",9),n(21,"async"),s(22,"div",10)(23,"h5",11),n(24,"async"),g(25),d()(),s(26,"a",12),T("click",function(h){return h.stopPropagation()}),I(27,"app-icon",7),s(28,"span",13),g(29),n(30,"translate"),d()(),D(31,Ue,2,1,"p",14)(32,De,5,2,"div",15),d()()()),i&2&&(a("ngClass",oe(45,je,t.cardType===t.PlaceCardType.Full,t.cardType===t.PlaceCardType.Favourites,c(1,18,t.currentTheme$)==="light",c(2,20,t.currentTheme$)==="dark")),o(5),a("src",t.place.photoUrls[0],B),o(),a("ngClass",P(50,Te,c(7,22,t.currentTheme$)==="light",c(8,24,t.currentTheme$)==="dark")),o(3),a("ngClass",P(53,Ee,c(10,26,t.currentTheme$)==="light",c(11,28,t.currentTheme$)==="dark")),o(3),b(" ",t.place.rating," "),o(),a("icon",t.ICONS.Star),o(),a("title",re(c(15,30,"BUTTON.ADD_TO_FAVORITES")))("ngClass",P(56,Te,c(16,32,t.currentTheme$)==="light",c(17,34,t.currentTheme$)==="dark")),o(4),a("icon",c(19,36,t.isFavorite?"HeartBlueFill":"HeartBlue")),o(2),a("ngClass",w(59,Oe,c(21,38,t.currentTheme$)==="dark")),o(3),a("ngClass",w(61,$e,c(24,40,t.currentTheme$)==="dark")),o(2),b(" ",t.place.name," "),o(),a("href",t.getGoogleMapsLink(t.place.address),B),o(),a("icon",t.ICONS.Location),o(2),b(" ",ae(30,42,"infoSector.cityCountry",w(63,He,t.place.city))," "),o(2),a("ngIf",t.cardType===t.PlaceCardType.Full),o(),a("ngIf",t.cardType===t.PlaceCardType.Full))},dependencies:[de,se,ce,pe,Ce,he,le,be,me],encapsulation:2})};export{z as a,j as b,$ as c,H as d,ke as e};
