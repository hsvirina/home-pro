import{a as lt}from"./chunk-QK4TDZWV.js";import{a as vt}from"./chunk-2PS7XOXG.js";import{a as rt}from"./chunk-GCYQK47Q.js";import{l as ne,p as ot}from"./chunk-H4NB5YVJ.js";import{a as Re,b as le,c as ce,d as pe}from"./chunk-R7A6PUGH.js";import{a as ut}from"./chunk-OEEKGOY4.js";import{a as pt}from"./chunk-ZQAMXLUC.js";import{b as mt,c as dt,d as Ae}from"./chunk-7C5YTNTV.js";import{a as at}from"./chunk-FQAFXMSY.js";import{b as tt,c as it,f as nt,j as ye}from"./chunk-OVFD7ZCN.js";import{$ as s,$a as S,A as f,Ab as Te,B as h,Bb as Z,Ca as Qe,Cb as Fe,Da as X,Db as ct,Ea as xe,F as J,Fa as F,Ga as Je,H as fe,J as N,Ja as c,K as he,Ka as p,M as o,Ma as H,P as v,Pa as B,R as I,Sa as V,Ta as P,Ua as A,W as w,X as k,Xa as Ye,Ya as ee,_a as be,a as se,aa as a,b as de,ba as l,ca as _,da as Ve,e as Xe,ea as je,eb as Ie,ga as T,ha as R,ia as y,ja as g,ka as u,lb as et,m as ue,na as qe,nb as te,oa as Ze,ob as Se,pa as Ge,qa as z,qb as ie,rb as q,sa as Ke,ta as d,tb as re,ua as b,ub as M,va as C,vb as E,w as ve,wa as Y,wb as O,xa as we,xb as j,ya as _e,yb as ke,z as ge,za as Ce,zb as st}from"./chunk-2Z55U5GN.js";var Me=class n{constructor(t){this.http=t}shareCafe(t){return this.http.post(`${ke.sharedCafes.base}/${t}`,null)}static \u0275fac=function(e){return new(e||n)(ge(Ie))};static \u0275prov=ve({token:n,factory:n.\u0275fac,providedIn:"root"})};function xt(n,t){if(n&1&&_(0,"img",12),n&2){let e=u().$implicit;s("@fadeInOutImage",void 0)("src",e,N)}}function bt(n,t){if(n&1&&(T(0),w(1,xt,1,2,"img",11),R()),n&2){let e=t.$implicit;o(),s("ngIf",e)}}var Ee=class n{constructor(t,e,i,r){this.themeService=t;this.sharedCafesService=e;this.userService=i;this.storageService=r}photoUrls=[];isFavorite=!1;place;onToggleFavorite=new k;onShare=new k;currentIndex=0;prevIndex=null;isAnimating=!1;ICONS=O;animationDuration=600;touchStartX=null;touchMoveX=null;handleNext(){if(!this.photoUrls.length)return;let t=(this.currentIndex+1)%this.photoUrls.length;this.triggerChange(t)}handlePrev(){if(!this.photoUrls.length)return;let t=this.currentIndex===0?this.photoUrls.length-1:this.currentIndex-1;this.triggerChange(t)}triggerChange(t){this.prevIndex=this.currentIndex,this.currentIndex=t,this.isAnimating=!0,setTimeout(()=>{this.isAnimating=!1,this.prevIndex=null},this.animationDuration)}get imagesToRender(){return this.isAnimating&&this.prevImageUrl&&this.currentImageUrl?[this.prevImageUrl,this.currentImageUrl]:this.currentImageUrl?[this.currentImageUrl]:[]}get currentImageUrl(){return this.photoUrls?.[this.currentIndex]??null}get prevImageUrl(){return this.prevIndex!==null?this.photoUrls?.[this.prevIndex]??null:null}onTouchStart(t){this.touchStartX=t.touches[0].clientX}onTouchMove(t){this.touchMoveX=t.touches[0].clientX}onTouchEnd(){if(this.touchStartX!==null&&this.touchMoveX!==null){let t=this.touchStartX-this.touchMoveX;Math.abs(t)>50&&(t>0?this.handleNext():this.handlePrev())}this.touchStartX=null,this.touchMoveX=null}handleShare(){if(!this.storageService.isAuthenticated()){this.onShare.emit();return}this.place?.id&&this.sharedCafesService.shareCafe(this.place.id).subscribe({next:()=>{let t=this.storageService.getUser()?.userId||0;this.userService.getPublicUserProfile(t).subscribe({next:e=>{this.storageService.setPublicUserProfile(e),this.onShare.emit()},error:e=>{console.error("Error updating public profile:",e)}})},error:t=>{console.error("Error sharing cafe:",t)}})}getButtonBgClass(){return{"bg-[#FFFFFF]/60":this.themeService.currentTheme==="light","bg-[#0D0D0D]/60":this.themeService.currentTheme==="dark"}}getIndicatorClass(){return{"bg-[#FFFFFF]/60":this.themeService.currentTheme==="light","bg-[#0D0D0D]/60 text-[var(--color-white)]":this.themeService.currentTheme==="dark"}}ngOnDestroy(){}static \u0275fac=function(e){return new(e||n)(v(q),v(Me),v(Z),v(Fe))};static \u0275cmp=I({type:n,selectors:[["app-carousel-section"]],inputs:{photoUrls:"photoUrls",isFavorite:"isFavorite",place:"place"},outputs:{onToggleFavorite:"onToggleFavorite",onShare:"onShare"},decls:20,vars:30,consts:[[1,"relative","flex","h-[550px]","touch-pan-y","items-center","justify-center","overflow-hidden",3,"touchstart","touchmove","touchend"],["aria-label","Previous image",1,"absolute","left-[24px]","top-1/2","z-10","flex","h-[52px]","w-[52px]","-translate-y-1/2","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass"],[3,"icon","width","height"],[1,"relative","h-full","w-full"],[1,"absolute","right-[24px]","top-[24px]","z-10","flex","gap-[16px]"],["aria-label","Toggle favorite",1,"relative","flex","h-[44px]","w-[44px]","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass","title"],[3,"icon"],["aria-label","Share this place",1,"flex","h-[44px]","w-[44px]","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass","title"],[4,"ngFor","ngForOf"],["aria-label","Next image",1,"absolute","right-[24px]","top-1/2","z-10","flex","h-[52px]","w-[52px]","-translate-y-1/2","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass"],[1,"button-font","absolute","bottom-5","right-5","rounded-[40px]","px-3","py-1","backdrop-blur",3,"ngClass"],["class","absolute inset-0 h-full w-full rounded-[40px] object-cover","alt","Carousel image",3,"src",4,"ngIf"],["alt","Carousel image",1,"absolute","inset-0","h-full","w-full","rounded-[40px]","object-cover",3,"src"]],template:function(e,i){e&1&&(a(0,"div",0),g("touchstart",function(m){return i.onTouchStart(m)})("touchmove",function(m){return i.onTouchMove(m)})("touchend",function(){return i.onTouchEnd()}),a(1,"button",1),g("click",function(){return i.handlePrev()}),_(2,"app-icon",2),c(3,"themedIcon"),l(),a(4,"div",3)(5,"div",4)(6,"button",5),c(7,"translate"),g("click",function(){return i.onToggleFavorite.emit()}),_(8,"app-icon",6),c(9,"themedIcon"),l(),a(10,"button",7),c(11,"translate"),g("click",function(){return i.handleShare()}),_(12,"app-icon",6),c(13,"themedIcon"),l()(),w(14,bt,2,1,"ng-container",8),l(),a(15,"button",9),g("click",function(){return i.handleNext()}),_(16,"app-icon",2),c(17,"themedIcon"),l(),a(18,"div",10),d(19),l()()),e&2&&(o(),s("ngClass",i.getButtonBgClass()),o(),s("icon",p(3,18,"ArrowLeft"))("width",32)("height",32),o(4),s("ngClass",i.getButtonBgClass())("title",p(7,20,"carousel.addToFavorites")),o(2),s("icon",i.isFavorite?i.ICONS.HeartBlueFill:p(9,22,"HeartBlue")),o(2),s("ngClass",i.getButtonBgClass())("title",p(11,24,"carousel.shareThisPlace")),o(2),s("icon",p(13,26,"Share")),o(2),s("ngForOf",i.imagesToRender),o(),s("ngClass",i.getButtonBgClass()),o(),s("icon",p(17,28,"ArrowRight"))("width",32)("height",32),o(2),s("ngClass",i.getIndicatorClass()),o(),Y(" ",i.currentIndex+1," / ",i.photoUrls.length||0," "))},dependencies:[S,V,P,A,j,E,Te,M],encapsulation:2,data:{animation:[ot]}})};var St=(n,t)=>({"text-[var(--color-gray-20)]":n,"text-[var(--color-gray-75)]":t}),yt=(n,t)=>({"text-[var(--color-gray-75)]":n,"text-[var(--color-gray-20)]":t}),kt=(n,t)=>({"bg-[var(--color-bg-2)] text-[var(--color-gray-100)]":n,"bg-[var(--color-bg-card)] text-[var(--color-gray-20)]":t}),Tt=(n,t)=>({"bg-[var(--color-secondary)]":n,"bg-[var(--color-bg-card)]":t});function Rt(n,t){if(n&1&&(a(0,"div",15)(1,"div",16)(2,"div",17),c(3,"async"),c(4,"async"),_(5,"app-icon",7),c(6,"themedIcon"),a(7,"div",18)(8,"span",19),d(9),c(10,"translate"),l(),a(11,"span",11),d(12),l()()()()()),n&2){let e=u();o(2),s("ngClass",F(12,kt,p(3,4,e.currentTheme$)==="light",p(4,6,e.currentTheme$)==="dark")),o(3),s("icon",p(6,8,"Clock")),o(4),b(p(10,10,"mainInfo.openingHours")),o(3),b(e.place.workingHours)}}function Ft(n,t){if(n&1&&(T(0),_(1,"app-icon",7),R()),n&2){let e=u().ngIf;o(),s("icon",e)}}function At(n,t){if(n&1&&_(0,"img",25),n&2){let e=u().ngIf,i=u(3);s("src",i.getIconURL(e),N)("alt",i.getIconLabel(e))}}function Mt(n,t){if(n&1&&(T(0),w(1,Ft,2,1,"ng-container",14)(2,At,1,2,"ng-template",null,1,H),R()),n&2){let e=t.ngIf,i=z(3),r=u(3);o(),s("ngIf",r.isIconData(e))("ngIfElse",i)}}function Et(n,t){if(n&1&&(a(0,"div",22),c(1,"async"),c(2,"async"),w(3,Mt,4,2,"ng-container",23),a(4,"span",24),d(5),l()()),n&2){let e=t.$implicit,i=u(2);s("ngClass",F(7,Tt,p(1,3,i.currentTheme$)==="light",p(2,5,i.currentTheme$)==="dark")),o(3),s("ngIf",i.TAG_ICON_MAP[e.id.toString()]),o(2),b(e.name)}}function Dt(n,t){if(n&1&&(a(0,"div",20),w(1,Et,6,10,"div",21),l()),n&2){let e=u();o(),s("ngForOf",e.place.tags)}}function Lt(n,t){if(n&1&&(T(0),_(1,"app-icon",7),d(2),c(3,"translate"),c(4,"translate"),R()),n&2){let e=u();o(),s("icon",e.isCheckedIn?e.ICONS.CheckCircle:e.ICONS.AddCircle),o(),C(" ",e.isCheckedIn?p(3,2,"mainInfo.checkedIn"):p(4,4,"mainInfo.checkIn")," ")}}function Pt(n,t){if(n&1&&(_(0,"app-icon",7),d(1),c(2,"translate")),n&2){let e=u();s("icon",e.ICONS.AddCircle),o(),C(" ",p(2,2,"mainInfo.logInToCheckIn")," ")}}var De=class n{constructor(t,e,i,r,m,x){this.themeService=t;this.router=e;this.checkInsService=i;this.storageService=r;this.userService=m;this.cdr=x;this.currentTheme$=this.themeService.theme$,this.initializeTagIconMap()}place;currentTheme$;ICONS=O;TAG_ICON_MAP={};isCheckedIn=!1;initializeTagIconMap(){rt.forEach(t=>{t.options.forEach(e=>{this.TAG_ICON_MAP[e.id.toString()]={iconURL:e.iconURL??"",iconURLDarkTheme:e.iconURLDarkTheme??"",label:e.label}})})}ngOnInit(){this.updateCheckInStatus()}get isAuthenticated(){return!!this.storageService.getUser()}get googleMapsUrl(){return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${this.place.address}, ${this.place.city}`)}`}get checkInTitle(){return this.isCheckedIn?"mainInfo.alreadyCheckedIn":this.isAuthenticated?"mainInfo.checkIn":"mainInfo.pleaseLoginToCheckIn"}isIconData(t){return"viewBox"in t}getIconURL(t){return this.isIconData(t)?"":this.themeService.currentTheme==="dark"&&t.iconURLDarkTheme?t.iconURLDarkTheme:t.iconURL}getIconLabel(t){return this.isIconData(t)?"":t.label}updateCheckInStatus(){if(!this.place)return;let t=this.storageService.getPublicUserProfile();this.isCheckedIn=t?.checkInCafes?.some(e=>e.id===this.place.id)??!1,this.cdr.detectChanges()}onCheckInClick(t){if(!this.isAuthenticated){this.router.navigate(["/auth"]);return}this.isCheckedIn||(t.preventDefault(),t.stopPropagation(),this.performCheckIn())}performCheckIn(){this.checkInsService.checkInToCafe(this.place.id).subscribe({next:()=>{this.userService.getPublicUserProfile(this.storageService.getUser()?.userId||0).subscribe({next:t=>{this.storageService.setPublicUserProfile(t),this.isCheckedIn=!0,this.checkInsService.checkInsUpdatedSource.next(),this.cdr.detectChanges(),this.router.navigate(["/catalog",this.place.id])},error:t=>console.error("Error updating user profile:",t)})},error:t=>console.error("Error performing check-in:",t)})}static \u0275fac=function(e){return new(e||n)(v(q),v(te),v(Ae),v(Fe),v(Z),v(B))};static \u0275cmp=I({type:n,selectors:[["app-main-info-section"]],inputs:{place:"place"},decls:32,vars:33,consts:[["notAuth",""],["customIcon",""],[1,"flex","flex-col","gap-6",3,"ngClass"],[1,"body-font-1","flex","flex-col","justify-between","gap-[32px]","lg:flex-row"],[1,"flex","flex-1","flex-col","gap-2",3,"ngClass"],[1,"flex","gap-2"],[1,"flex","items-center","gap-2"],[3,"icon"],["target","_blank","rel","noopener noreferrer",1,"underline",3,"href"],["class","flex-1",4,"ngIf"],[1,"flex","flex-col","gap-4"],[1,"body-font-1"],["class","flex flex-wrap gap-2",4,"ngIf"],[1,"button-bg-transparent","w-full","gap-2","px-4","py-3","lg:w-1/2",3,"click","disabled","title"],[4,"ngIf","ngIfElse"],[1,"flex-1"],[1,"gap-[20px]"],[1,"flex","items-center","justify-center","gap-3","rounded-[40px]","px-6","py-2",3,"ngClass"],[1,"flex","flex-col","justify-center","gap-1","text-center"],[1,"menu-text-font"],[1,"flex","flex-wrap","gap-2"],["class","tag-item flex items-center justify-center gap-2 rounded-[40px] px-4 py-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"tag-item","flex","items-center","justify-center","gap-2","rounded-[40px]","px-4","py-2",3,"ngClass"],[4,"ngIf"],[1,"body-font-2"],[3,"src","alt"]],template:function(e,i){if(e&1){let r=y();a(0,"div",2),c(1,"async"),c(2,"async"),a(3,"h3"),d(4),l(),a(5,"div",3)(6,"div",4),c(7,"async"),c(8,"async"),a(9,"div",5)(10,"div",6),_(11,"app-icon",7),a(12,"span"),d(13),l()(),a(14,"span"),d(15),l()(),a(16,"div",6),_(17,"app-icon",7),a(18,"a",8),d(19),l()()(),w(20,Rt,13,15,"div",9),l(),a(21,"div",10)(22,"h5"),d(23),c(24,"translate"),l(),a(25,"span",11),d(26),l(),w(27,Dt,2,1,"div",12),l(),a(28,"button",13),g("click",function(x){return f(r),h(i.onCheckInClick(x))}),w(29,Lt,5,6,"ng-container",14)(30,Pt,3,4,"ng-template",null,0,H),l()()}if(e&2){let r=z(31);s("ngClass",F(27,St,p(1,17,i.currentTheme$)==="dark",p(2,19,i.currentTheme$)==="light")),o(4),b(i.place.name),o(2),s("ngClass",F(30,yt,p(7,21,i.currentTheme$)==="light",p(8,23,i.currentTheme$)==="dark")),o(5),s("icon",i.ICONS.Star),o(2),b(i.place.rating),o(2),C("(",i.place.reviewCount,")"),o(2),s("icon",i.ICONS.Location),o(),s("href",i.googleMapsUrl,N),o(),C(" ",i.place.address," "),o(),s("ngIf",i.place==null?null:i.place.workingHours),o(3),b(p(24,25,"mainInfo.aboutCafe")),o(3),b(i.place.longDescription),o(),s("ngIf",i.place==null||i.place.tags==null?null:i.place.tags.length),o(),s("disabled",i.isCheckedIn)("title",i.checkInTitle),o(),s("ngIf",i.isAuthenticated)("ngIfElse",r)}},dependencies:[S,V,P,A,j,E,ee,M,Te],encapsulation:2})};function Ot(n,t){if(n&1){let e=y();a(0,"button",9),g("click",function(){f(e);let r=u();return h(r.leaveReviewClick.emit())}),d(1),c(2,"translate"),l()}n&2&&(o(),C(" ",p(2,1,"actions.leaveReview")," "))}function Ut(n,t){if(n&1&&(T(0),_(1,"app-icon",8),R()),n&2){let e=u();o(),s("icon",e.ICONS.HeartBlueFill)}}function Nt(n,t){if(n&1&&_(0,"app-icon",8),n&2){let e=u();s("icon",e.ICONS.HeartBlue)}}var Le=class n{ICONS=O;isFavorite=!1;showAddReviewForm=!1;isMobile=!1;isLoggedIn=!1;leaveReviewClick=new k;onToggleFavorite=new k;onShare=new k;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-actions-sector"]],inputs:{isFavorite:"isFavorite",showAddReviewForm:"showAddReviewForm",isMobile:"isMobile",isLoggedIn:"isLoggedIn"},outputs:{leaveReviewClick:"leaveReviewClick",onToggleFavorite:"onToggleFavorite",onShare:"onShare"},decls:20,vars:18,consts:[["blueHeart",""],[1,"mb-11","flex","flex-col","items-center","gap-4"],[1,"body-font-1"],[1,"flex","w-full","flex-col","gap-4","lg:w-auto","lg:flex-row"],["class","button-font button-bg-blue w-full px-6 py-3 lg:w-auto",3,"click",4,"ngIf"],[1,"button-bg-transparent","button-font","flex","w-full","items-center","gap-2","rounded-[40px]","px-6","py-3","lg:w-auto",3,"click"],[4,"ngIf","ngIfElse"],[1,"button-font","button-bg-transparent","flex","w-full","gap-2","px-6","py-3","lg:w-auto",3,"click"],[3,"icon"],[1,"button-font","button-bg-blue","w-full","px-6","py-3","lg:w-auto",3,"click"]],template:function(e,i){if(e&1){let r=y();a(0,"div",1)(1,"h5"),d(2),c(3,"translate"),l(),a(4,"span",2),d(5),c(6,"translate"),l(),a(7,"div",3),w(8,Ot,3,3,"button",4),a(9,"button",5),g("click",function(){return f(r),h(i.onToggleFavorite.emit())}),w(10,Ut,2,1,"ng-container",6)(11,Nt,1,1,"ng-template",null,0,H),d(13),c(14,"translate"),c(15,"translate"),l(),a(16,"button",7),g("click",function(){return f(r),h(i.onShare.emit())}),_(17,"app-icon",8),d(18),c(19,"translate"),l()()()}if(e&2){let r=z(12);o(2),b(p(3,8,"actions.title")),o(3),C(" ",p(6,10,"actions.subtitle")," "),o(3),s("ngIf",!i.showAddReviewForm&&(!i.isLoggedIn||i.isMobile)),o(2),s("ngIf",i.isFavorite)("ngIfElse",r),o(3),C(" ",i.isFavorite?p(14,12,"actions.removeFromFavorites"):p(15,14,"actions.saveToFavorites")," "),o(4),s("icon",i.ICONS.ShareBlue),o(),C(" ",p(19,16,"actions.share")," ")}},dependencies:[S,A,j,E,M],encapsulation:2})};var Pe=class n{value=0;previousValue=0;shouldAnimate=!1;ngOnChanges(t){let e=t.value?.currentValue,i=t.value?.previousValue;e!==i&&(this.previousValue=i??0,this.shouldAnimate=!0,setTimeout(()=>{this.shouldAnimate=!1},400))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-flip-number"]],inputs:{value:"value"},features:[J],decls:6,vars:4,consts:[[1,"flip-wrapper"],[1,"flip-digit"],[1,"front"],[1,"back"]],template:function(e,i){e&1&&(Ve(0,"div",0)(1,"div",1)(2,"span",2),d(3),je(),Ve(4,"span",3),d(5),je()()()),e&2&&(o(),Ke("flip",i.shouldAnimate),o(2),b(i.previousValue),o(2),b(i.value))},dependencies:[S],styles:[".flip-wrapper[_ngcontent-%COMP%]{perspective:1000px;height:14px;width:14px;overflow:hidden;align-items:flex-end;justify-content:center;padding-bottom:2px}.flip-digit[_ngcontent-%COMP%]{position:relative;height:100%;transform-style:preserve-3d;transition:transform .4s ease-in-out}.flip-digit.flip[_ngcontent-%COMP%]{transform:rotateX(-180deg)}.front[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center;backface-visibility:hidden}.back[_ngcontent-%COMP%]{transform:rotateX(180deg)}"],changeDetection:0})};var Bt=n=>["/users",n],Vt=(n,t)=>({width:n,height:t}),jt=(n,t)=>({transform:"translate(-50%, -50%)",width:n,height:t}),$t=()=>({"items-end":!0,"lg:items-center":!0}),zt=(n,t)=>({width:n,height:t,transform:"translate(-50%, -50%)",objectFit:"contain"});function Ht(n,t){if(n&1&&_(0,"img",26),n&2){let e=t.ngIf,i=u();s("src",e,N)("ngStyle",F(2,zt,i.isMobile?"50px":"113px",i.isMobile?"50px":"113px"))}}function Wt(n,t){if(n&1&&(a(0,"span",27),d(1),l()),n&2){let e=u();o(),b(e.review.text)}}function Xt(n,t){if(n&1&&(T(0),_(1,"app-icon",20),R()),n&2){let e=u();o(),s("icon",e.ICONS.Star)}}function qt(n,t){if(n&1){let e=y();a(0,"button",28),g("click",function(){f(e);let r=u();return h(r.onDeleteClick())}),_(1,"app-icon",20),l()}if(n&2){let e=u();o(),s("icon",e.ICONS.Close)}}var Oe=class n{constructor(t,e,i,r,m){this.datePipe=t;this.elRef=e;this.translate=i;this.router=r;this.cdr=m;this.checkScreenSize()}review;badgeType=null;currentUserId=null;likesInfo={likedByCurrentUser:!1,totalLikes:0};isLoggedIn=!1;delete=new k;toggleLike=new k;animatedLikesCount=0;ICONS=O;isMobile=!1;showLoginModal=!1;animationInterval=null;ngOnDestroy(){this.animationInterval&&clearInterval(this.animationInterval)}ngOnChanges(t){let e=t.likesInfo;e&&e.currentValue&&e.previousValue&&e.previousValue.totalLikes!==e.currentValue.totalLikes?this.animateLikesCount(e.currentValue.totalLikes):e?.currentValue&&!e.previousValue&&(this.animatedLikesCount=e.currentValue.totalLikes),this.cdr.markForCheck()}onDeleteClick(){this.delete.emit(this.review.id)}onToggleLike(){if(!this.isLoggedIn){this.showLoginModal=!0;return}this.toggleLike.emit(!this.likesInfo.likedByCurrentUser),this.likesInfo={likedByCurrentUser:!this.likesInfo.likedByCurrentUser,totalLikes:this.likesInfo.likedByCurrentUser?this.likesInfo.totalLikes-1:this.likesInfo.totalLikes+1},this.cdr.markForCheck()}closeLoginModal(){this.showLoginModal=!1}goToLogin(){this.showLoginModal=!1,this.router.navigate(["/auth"])}getLikeIcon(){return this.isLoggedIn?this.likesInfo.likedByCurrentUser?this.ICONS.LikeFill:this.ICONS.Like:this.likesInfo.totalLikes>0?this.ICONS.LikeFill:this.ICONS.Like}getStarsArray(t){return Array.from({length:t},(e,i)=>i+1)}formatDate(t){return this.datePipe.transform(t,"MMM dd, yyyy")}checkScreenSize(){this.isMobile=window.innerWidth<1024}get hasBadge(){return!!this.badgeType}get roundedLikesCount(){return Math.round(this.animatedLikesCount)}animateLikesCount(t){if(this.animationInterval&&clearInterval(this.animationInterval),t===0){this.animatedLikesCount=0;return}let e=500,i=60,r=Math.ceil(e/1e3*i),m=this.animatedLikesCount,x=(t-m)/r,U=0;this.animationInterval=setInterval(()=>{U++,this.animatedLikesCount+=x,U>=r&&(this.animatedLikesCount=t,clearInterval(this.animationInterval),this.animationInterval=null)},1e3/i),setTimeout(()=>{this.cdr.markForCheck()},e)}static \u0275fac=function(e){return new(e||n)(v(be),v(fe),v(re),v(te),v(B))};static \u0275cmp=I({type:n,selectors:[["app-review-item"]],hostBindings:function(e,i){e&1&&g("resize",function(){return i.checkScreenSize()},he)},inputs:{review:"review",badgeType:"badgeType",currentUserId:"currentUserId",likesInfo:"likesInfo",isLoggedIn:"isLoggedIn"},outputs:{delete:"delete",toggleLike:"toggleLike"},features:[Qe([be]),J],decls:35,vars:39,consts:[[1,"flex","gap-4","px-[18px]","py-[15px]"],[1,"relative","inline-block","bg-transparent",3,"routerLink"],[1,"relative","flex","items-center","justify-center",3,"ngStyle"],["alt","badge","class","absolute left-1/2 top-1/2 z-0",3,"src","ngStyle",4,"ngIf"],[1,"absolute","left-1/2","top-1/2","z-10",3,"ngStyle"],[3,"userPhoto","avatarSize","badgeSize","hasBadge"],[1,"flex","w-full","flex-col","justify-between","gap-2","lg:flex-row","lg:gap-0"],[1,"flex","flex-1","flex-col","gap-2"],[1,"menu-text-font"],["class","body-font-1",4,"ngIf"],[1,"flex","gap-[2px]"],[4,"ngFor","ngForOf"],[1,"w-22","relative","flex","flex-shrink-0","justify-between","lg:h-[113px]","lg:flex-col"],[1,"flex",3,"ngClass"],[1,"body-font-2"],[1,"flex","justify-between"],["class","cursor-pointer border-none bg-none","aria-label","Delete review",3,"click",4,"ngIf"],[1,"body-font-2","ml-auto","flex","items-end","gap-1"],[3,"value"],["aria-label","Like review",1,"flex","cursor-pointer","items-end","border-none",3,"click"],[3,"icon"],[3,"close","isOpen","width"],[1,"flex","flex-col","items-center","p-4","text-center"],[1,"mb-4","text-xl","font-semibold"],[1,"body-font-1","mb-4"],[1,"btn","btn-primary",3,"click"],["alt","badge",1,"absolute","left-1/2","top-1/2","z-0",3,"src","ngStyle"],[1,"body-font-1"],["aria-label","Delete review",1,"cursor-pointer","border-none","bg-none",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"a",1)(2,"div",2),w(3,Ht,1,5,"img",3),c(4,"badgeImage"),a(5,"div",4),_(6,"app-user-menu",5),l()()(),a(7,"div",6)(8,"div",7)(9,"span",8),d(10),l(),w(11,Wt,2,1,"span",9),a(12,"div",10),w(13,Xt,2,1,"ng-container",11),l()(),a(14,"div",12)(15,"div",13)(16,"span",14),d(17),l()(),a(18,"div",15),w(19,qt,2,1,"button",16),a(20,"div",17),_(21,"app-flip-number",18),a(22,"button",19),g("click",function(){return i.onToggleLike()}),_(23,"app-icon",20),l()()()()(),a(24,"app-modal",21),g("close",function(){return i.closeLoginModal()}),a(25,"div",22)(26,"h3",23),d(27),c(28,"translate"),l(),a(29,"p",24),d(30),c(31,"translate"),l(),a(32,"button",25),g("click",function(){return i.goToLogin()}),d(33),c(34,"translate"),l()()()()),e&2&&(o(),s("routerLink",xe(30,Bt,i.review.userId)),o(),s("ngStyle",F(32,Vt,i.isMobile?"50px":"113px",i.isMobile?"50px":"113px")),o(),s("ngIf",p(4,22,i.badgeType)),o(2),s("ngStyle",F(35,jt,i.isMobile?"40px":"100px",i.isMobile?"40px":"100px")),o(),s("userPhoto",i.review.userPhotoUrl)("avatarSize",i.isMobile?40:100)("badgeSize",i.isMobile?50:113)("hasBadge",i.hasBadge),o(4),Y("",i.review.userName," ",i.review.userSurname),o(),s("ngIf",i.review.text),o(2),s("ngForOf",i.getStarsArray(i.review.rating)),o(2),s("ngClass",X(38,$t)),o(2),b(i.formatDate(i.review.createdAt)),o(2),s("ngIf",i.currentUserId===i.review.userId),o(2),s("value",i.roundedLikesCount),o(2),s("icon",i.getLikeIcon()),o(),s("isOpen",i.showLoginModal)("width","400px"),o(3),C(" ",p(28,24,"modals.loginTitle")," "),o(3),C(" ",p(31,26,"modals.loginMessageForLike")," "),o(3),C(" ",p(34,28,"modals.loginBtn")," "))},dependencies:[S,V,P,A,Ye,ie,Se,j,Pe,lt,ne,E,Re,M],styles:[".liked[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{color:red}"]})};var Zt=(n,t)=>({"border-[var(--color-gray-20)]":n,"border-[var(--color-gray-75)]":t}),Gt=()=>[1,2,3,4,5],gt=(n,t)=>({"border-[var(--color-gray-20)] bg-[var(--color-white)]":n,"border-[var(--color-gray-100)] bg-transparent":t}),Kt=(n,t)=>({"border-[var(--color-gray-20)] bg-[var(--color-gray-10)]":n,"border-[var(--color-gray-100)] bg-[var(--color-bg-card)] text-[var(--color-gray-75)]":t}),Qt=(n,t,e)=>[n,t,e];function Jt(n,t){if(n&1){let e=y();T(0),a(1,"app-icon",14),g("mouseenter",function(){let r=f(e).$implicit,m=u(2);return h(m.hoveredRating=r)})("mouseleave",function(){f(e);let r=u(2);return h(r.hoveredRating=0)})("click",function(){let r=f(e).$implicit,m=u(2);return h(m.onStarClick(r))}),l(),R()}if(n&2){let e=t.$implicit,i=u(2);o(),s("icon",e<=(i.hoveredRating||i.newReviewRating)?i.ICONS.Star:i.ICONS.StarEmpty)}}function Yt(n,t){if(n&1){let e=y();a(0,"div",1),c(1,"async"),c(2,"async"),a(3,"h5"),d(4,"Submit your review"),l(),a(5,"div",2)(6,"span",3),d(7,"Add your rating"),l(),a(8,"div",4),w(9,Jt,2,1,"ng-container",5),l()(),a(10,"div",6)(11,"div",7)(12,"div",8)(13,"span",9),d(14,"Name*"),l(),a(15,"input",10),c(16,"async"),c(17,"async"),Ce("ngModelChange",function(r){f(e);let m=u();return _e(m.userName,r)||(m.userName=r),h(r)}),l()(),a(18,"div",8)(19,"span",9),d(20,"Email*"),l(),a(21,"input",11),c(22,"async"),c(23,"async"),Ce("ngModelChange",function(r){f(e);let m=u();return _e(m.userEmail,r)||(m.userEmail=r),h(r)}),l()()(),a(24,"div",8)(25,"span",9),d(26,"Write your review*"),l(),a(27,"textarea",12),c(28,"async"),c(29,"async"),Ce("ngModelChange",function(r){f(e);let m=u();return _e(m.newReviewText,r)||(m.newReviewText=r),h(r)}),g("input",function(r){f(e);let m=u();return h(m.onTextInput(r))}),l()()(),a(30,"button",13),c(31,"async"),c(32,"async"),g("click",function(){f(e);let r=u();return h(r.onAddReview())}),d(33," Leave a Review "),l()()}if(n&2){let e=u();s("ngClass",F(31,Zt,p(1,11,e.currentTheme$)==="light",p(2,13,e.currentTheme$)==="dark")),o(9),s("ngForOf",X(34,Gt)),o(6),we("ngModel",e.userName),s("ngClass",F(35,gt,p(16,15,e.currentTheme$)==="light",p(17,17,e.currentTheme$)==="dark")),o(6),we("ngModel",e.userEmail),s("disabled",!0)("ngClass",F(38,Kt,p(22,19,e.currentTheme$)==="light",p(23,21,e.currentTheme$)==="dark")),o(6),we("ngModel",e.newReviewText),s("ngClass",F(41,gt,p(28,23,e.currentTheme$)==="light",p(29,25,e.currentTheme$)==="dark")),o(3),s("disabled",!e.canSubmitReview)("ngClass",Je(44,Qt,e.canSubmitReview?"button-bg-blue cursor-pointer":"text-[var(--color-gray-55)]",p(31,27,e.currentTheme$)==="light"&&!e.canSubmitReview?"bg-[var(--color-gray-20)]":"",p(32,29,e.currentTheme$)==="dark"&&!e.canSubmitReview?"bg-[var(--color-gray-100)]":""))}}var Ue=class n{currentTheme$;userName="";userEmail="";newReviewText="";newReviewRating=0;canSubmitReview=!1;currentUser;alwaysShowFormOnDesktop=!1;showAddReviewForm=!1;reviewTextChange=new k;reviewRatingChange=new k;addReview=new k;hoveredRating=0;ICONS=O;onAddReview(){this.addReview.emit()}onStarClick(t){this.newReviewRating=t,this.reviewRatingChange.emit(t)}onTextInput(t){let e=t.target.value;this.newReviewText=e,this.reviewTextChange.emit(e),this.autoGrow(t)}autoGrow(t){let e=t.target;e.style.height="auto",e.style.height=`${e.scrollHeight}px`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-add-review-form"]],inputs:{currentTheme$:"currentTheme$",userName:"userName",userEmail:"userEmail",newReviewText:"newReviewText",newReviewRating:"newReviewRating",canSubmitReview:"canSubmitReview",currentUser:"currentUser",alwaysShowFormOnDesktop:"alwaysShowFormOnDesktop",showAddReviewForm:"showAddReviewForm"},outputs:{reviewTextChange:"reviewTextChange",reviewRatingChange:"reviewRatingChange",addReview:"addReview"},decls:1,vars:1,consts:[["class","flex flex-col gap-4 rounded-[40px] border p-4",3,"ngClass",4,"ngIf"],[1,"flex","flex-col","gap-4","rounded-[40px]","border","p-4",3,"ngClass"],[1,"flex","flex-col","gap-2"],[1,"body-font-2"],[1,"flex"],[4,"ngFor","ngForOf"],[1,"body-font-2","flex","flex-col","gap-2"],[1,"flex","gap-5"],[1,"flex","flex-1","flex-col","gap-1"],[1,"text-[var(--color-gray-55)]"],[1,"body-font-1","flex-1","rounded-[40px]","border","px-6","py-3","focus:border-[var(--color-gray-20)]","focus:outline-none",3,"ngModelChange","ngModel","ngClass"],[1,"body-font-1","flex-1","cursor-not-allowed","rounded-[40px]","border","px-6","py-3","text-[var(--color-gray-55)]",3,"ngModelChange","ngModel","disabled","ngClass"],["placeholder","Write what you think about this cafe...","rows","1",1,"body-font-1","w-full","flex-grow","resize-none","overflow-hidden","rounded-[40px]","border","px-8","py-3","focus:outline-none",3,"ngModelChange","input","ngModel","ngClass"],[1,"button-font","h-[48px]","w-[215px]","flex-shrink-0","rounded-[40px]","px-8","py-3",3,"click","disabled","ngClass"],[1,"cursor-pointer","transition","duration-200",3,"mouseenter","mouseleave","click","icon"]],template:function(e,i){e&1&&w(0,Yt,34,48,"div",0),e&2&&s("ngIf",i.currentUser&&(i.alwaysShowFormOnDesktop||i.showAddReviewForm))},dependencies:[S,V,P,A,ye,tt,it,nt,j,ee],encapsulation:2})};var Ne=class n{constructor(t){this.http=t}baseUrl=ke.reviews.base;getReviewsByCafeId(t){return this.http.get(`${this.baseUrl}/cafe/${t}`)}addReview(t){return this.http.post(this.baseUrl,t,{headers:{"Content-Type":"application/json"}})}deleteReview(t){return this.http.delete(`${this.baseUrl}/${t}`)}static \u0275fac=function(e){return new(e||n)(ge(Ie))};static \u0275prov=ve({token:n,factory:n.\u0275fac,providedIn:"root"})};function ti(n,t){if(n&1){let e=y();a(0,"button",14),g("click",function(){f(e);let r=u();return h(r.showMore())}),d(1),c(2,"translate"),l()}if(n&2){let e=u();s("disabled",e.visibleCount>=e.reviews.length),o(),C(" ",p(2,2,"reviews.showMore")," ")}}function ii(n,t){if(n&1){let e=y();a(0,"app-review-item",16),g("toggleLike",function(r){let m=f(e).$implicit,x=u(2);return h(x.onToggleLike(m,r))})("delete",function(r){f(e);let m=u(2);return h(m.confirmDelete(r))}),l()}if(n&2){let e=t.$implicit,i=u(2);s("review",e)("badgeType",i.userBadgeTypes.get(e.userId)??null)("currentUserId",(i.currentUser==null?null:i.currentUser.userId)??null)("likesInfo",i.getLikesInfo(e.id))("isLoggedIn",!!i.currentUser)}}function ni(n,t){if(n&1&&(T(0),w(1,ii,1,5,"app-review-item",15),R()),n&2){let e=u();o(),s("ngForOf",e.reviews.slice(0,e.visibleCount))}}function ri(n,t){if(n&1){let e=y();a(0,"app-add-review-form",17),g("reviewTextChange",function(r){f(e);let m=u();return h(m.newReviewText=r)})("reviewRatingChange",function(r){f(e);let m=u();return h(m.newReviewRating=r)})("addReview",function(){f(e);let r=u();return h(r.addReview())}),l()}if(n&2){let e=u();s("currentUser",e.currentUser)("currentTheme$",e.currentTheme$)("userName",e.userName)("userEmail",e.userEmail)("newReviewText",e.newReviewText)("newReviewRating",e.newReviewRating)("canSubmitReview",e.canSubmitReview)("alwaysShowFormOnDesktop",e.alwaysShowFormOnDesktop)("showAddReviewForm",e.showAddReviewForm)}}function oi(n,t){n&1&&(a(0,"h5",18),d(1),c(2,"translate"),l()),n&2&&(o(),C(" ",p(2,1,"reviews.noReviews")," "))}var me=class n{constructor(t,e,i,r){this.reviewsService=t;this.cdr=e;this.themeService=i;this.authApiService=r;this.currentTheme$=this.themeService.theme$}cafeId=null;place=null;currentUser=null;isMobile=!1;showAddReviewForm=!1;alwaysShowFormOnDesktop=!1;publicUserProfile;reviewAdded=new k;currentTheme$;ICONS=O;reviews=[];reviewLikesMap=new Map;userProfiles=new Map;userBadgeTypes=new Map;visibleCount=2;newReviewText="";newReviewRating=0;reviewToDeleteId=null;showDeleteModal=!1;userName="";userEmail="";badgeType=null;ngOnChanges(t){t.cafeId&&this.cafeId!==null&&(this.visibleCount=2,this.loadReviews(this.cafeId)),t.currentUser&&this.currentUser&&(this.userName=`${this.currentUser.firstName} ${this.currentUser.lastName}`,this.userEmail=this.currentUser.email),t.publicUserProfile&&this.publicUserProfile&&this.updateBadgeType()}loadReviews(t){this.reviewsService.getReviewsByCafeId(t).subscribe({next:e=>{this.reviews=e,this.loadLikesForReviews(e),this.loadProfilesForReviews()},error:()=>{this.reviews=[]}})}loadLikesForReviews(t){let e=t.map(i=>this.authApiService.getReviewLikesInfo(i.id));ue(e).subscribe({next:i=>{let r=new Map;t.forEach((m,x)=>{r.set(m.id,i[x])}),this.reviewLikesMap=r,this.cdr.detectChanges()},error:i=>{console.warn("Failed to load likes info for some reviews",i)}})}updateLikesLocal(t,e){let i=this.reviewLikesMap.get(t);if(!i)return;let r=e?i.totalLikes+1:i.totalLikes-1,m=new Map(this.reviewLikesMap);m.set(t,{likedByCurrentUser:e,totalLikes:Math.max(0,r)}),this.reviewLikesMap=m,this.cdr.detectChanges()}loadProfilesForReviews(){this.reviews.forEach(t=>{let e=t.userId;this.userProfiles.has(e)||this.authApiService.getPublicUserProfile(e).subscribe({next:i=>{this.userProfiles.set(e,i),this.calculateAndSetBadge(e,i),this.cdr.detectChanges()},error:i=>{console.warn(`Failed to load profile for user ${e}`,i)}})})}calculateAndSetBadge(t,e){let i=pe(e),r=le(i,ce);this.userBadgeTypes.set(t,r)}updateBadgeType(){let t=pe(this.publicUserProfile);this.badgeType=le(t,ce)}get canSubmitReview(){return this.newReviewRating>0}addReview(){if(!this.cafeId||this.newReviewRating===0)return;let t=this.newReviewText.trim(),e=se({cafeId:this.cafeId,rating:this.newReviewRating},t&&{text:t});this.reviewsService.addReview(e).subscribe({next:i=>{let r=de(se({},i),{userName:this.currentUser?.firstName??"Anonymous",userSurname:this.currentUser?.lastName??"",userPhotoUrl:this.currentUser?.photoUrl||""});this.reviews.unshift(r),this.newReviewText="",this.newReviewRating=0,this.visibleCount++,this.cdr.detectChanges(),this.reviewAdded.emit(),this.place&&(this.place.reviewCount=(this.place.reviewCount||0)+1),setTimeout(()=>{let m=document.querySelector("textarea");m&&(m.style.height="auto")})},error:i=>{console.error("Failed to add review:",i)}})}confirmDelete(t){this.reviewToDeleteId=t,this.showDeleteModal=!0}deleteConfirmed(){this.reviewToDeleteId!==null&&(this.deleteReview(this.reviewToDeleteId),this.cancelDelete())}deleteReview(t){this.reviewsService.deleteReview(t).subscribe({next:()=>{this.reviews=this.reviews.filter(e=>e.id!==t),this.visibleCount=Math.min(this.visibleCount,this.reviews.length),this.place&&(this.place.reviewCount=Math.max((this.place.reviewCount||1)-1,0)),this.cdr.detectChanges()},error:e=>{console.error("Failed to delete review:",e)}})}cancelDelete(){this.showDeleteModal=!1,this.reviewToDeleteId=null}showMore(){this.visibleCount<this.reviews.length&&(this.visibleCount+=2)}getLikesInfo(t){return this.reviewLikesMap.get(t)??{likedByCurrentUser:!1,totalLikes:0}}onToggleLike(t,e){(e?this.authApiService.likeReview(t.id):this.authApiService.unlikeReview(t.id)).subscribe({next:()=>{this.updateLikesLocal(t.id,e)},error:r=>{console.error(`Server like action failed for reviewId=${t.id}`,r)}})}static \u0275fac=function(e){return new(e||n)(v(Ne),v(B),v(q),v(Z))};static \u0275cmp=I({type:n,selectors:[["app-rating-reviews-section"]],inputs:{cafeId:"cafeId",place:"place",currentUser:"currentUser",isMobile:"isMobile",showAddReviewForm:"showAddReviewForm",alwaysShowFormOnDesktop:"alwaysShowFormOnDesktop",publicUserProfile:"publicUserProfile"},outputs:{reviewAdded:"reviewAdded"},features:[J],decls:30,vars:23,consts:[["noReviews",""],[1,"flex","flex-col","gap-[16px]"],[1,"flex","flex-col","gap-2"],[1,"body-font-1","flex","justify-between"],["class","underline","style","text-decoration-style: dotted; text-underline-offset: 4px;",3,"disabled","click",4,"ngIf"],[1,"flex","flex-col","gap-4"],[4,"ngIf","ngIfElse"],[3,"currentUser","currentTheme$","userName","userEmail","newReviewText","newReviewRating","canSubmitReview","alwaysShowFormOnDesktop","showAddReviewForm","reviewTextChange","reviewRatingChange","addReview",4,"ngIf"],[3,"close","isOpen"],[1,"mb-4","text-center"],[1,"menu-text-font","mb-4","text-center","text-[var(--color-gray-75)]"],[1,"flex","justify-center","gap-4"],[1,"button-font","button-bg-blue","px-6","py-2",3,"click"],[1,"button-font","button-bg-transparent","px-6","py-2",3,"click"],[1,"underline",2,"text-decoration-style","dotted","text-underline-offset","4px",3,"click","disabled"],[3,"review","badgeType","currentUserId","likesInfo","isLoggedIn","toggleLike","delete",4,"ngFor","ngForOf"],[3,"toggleLike","delete","review","badgeType","currentUserId","likesInfo","isLoggedIn"],[3,"reviewTextChange","reviewRatingChange","addReview","currentUser","currentTheme$","userName","userEmail","newReviewText","newReviewRating","canSubmitReview","alwaysShowFormOnDesktop","showAddReviewForm"],[1,"col-span-8","mb-11"]],template:function(e,i){if(e&1){let r=y();a(0,"section")(1,"div",1)(2,"div",2)(3,"h4"),d(4),c(5,"translate"),l(),a(6,"div",3)(7,"span"),d(8),c(9,"translate"),l(),w(10,ti,3,4,"button",4),l()(),a(11,"div",5),w(12,ni,2,1,"ng-container",6),l(),w(13,ri,1,9,"app-add-review-form",7),l(),w(14,oi,3,3,"ng-template",null,0,H),a(16,"app-modal",8),g("close",function(){return f(r),h(i.cancelDelete())}),a(17,"h4",9),d(18),c(19,"translate"),l(),a(20,"p",10),d(21),c(22,"translate"),l(),a(23,"div",11)(24,"button",12),g("click",function(){return f(r),h(i.deleteConfirmed())}),d(25),c(26,"translate"),l(),a(27,"button",13),g("click",function(){return f(r),h(i.cancelDelete())}),d(28),c(29,"translate"),l()()()()}if(e&2){let r=z(15);o(4),b(p(5,11,"reviews.title")),o(4),b(p(9,13,"reviews.subtitle")),o(2),s("ngIf",i.reviews.length>2),o(2),s("ngIf",i.reviews.length>0)("ngIfElse",r),o(),s("ngIf",i.currentUser),o(3),s("isOpen",i.showDeleteModal),o(2),C(" ",p(19,15,"reviews.deleteConfirmTitle")," "),o(3),C(" ",p(22,17,"reviews.deleteConfirmMessage")," "),o(4),C(" ",p(26,19,"reviews.deleteYes")," "),o(3),C(" ",p(29,21,"reviews.deleteCancel")," ")}},dependencies:[S,P,A,ye,ne,ie,Oe,Ue,E,M],encapsulation:2})};var ai=(n,t)=>({"bg-[var(--color-bg-2)]":n,"bg-[var(--color-bg-card)]":t}),si=n=>["/users",n],ft=()=>({"h-[44px] w-[50px]":!0,"lg:h-[58px] lg:w-[58px]":!0}),li=()=>({"h-[44px] w-[44px]":!0,"lg:h-[50px] lg:w-[50px]":!0});function ci(n,t){if(n&1&&_(0,"img",14),n&2){let e=t.ngIf;s("src",e,N)("ngClass",X(2,ft))}}function pi(n,t){if(n&1&&(a(0,"div",7)(1,"div",8),c(2,"async"),c(3,"async"),a(4,"a",9),w(5,ci,1,3,"img",10),c(6,"badgeImage"),_(7,"img",11),l(),a(8,"div",2)(9,"div",12),d(10),l(),a(11,"div",13),d(12),l()()()()),n&2){let e=t.$implicit,i=u(2);o(),s("ngClass",F(17,ai,p(2,11,i.currentTheme$)==="light",p(3,13,i.currentTheme$)==="dark")),o(3),s("routerLink",xe(20,si,e.userId))("ngClass",X(22,ft))("title",e.userFirstName+" "+e.userLastName),o(),s("ngIf",p(6,15,e.badge)),o(2),s("src",e.userPhotoUrl,N)("alt",e.userFirstName+" "+e.userLastName)("ngClass",X(23,li)),o(3),Y(" ",e.userFirstName," ",e.userLastName," "),o(2),C(" ",i.formatCheckInDate(e.timestamp)," ")}}function mi(n,t){if(n&1&&(T(0),a(1,"div",5),w(2,pi,13,24,"div",6),l(),R()),n&2){let e=u();o(2),s("ngForOf",e.checkIns)}}function di(n,t){n&1&&(a(0,"div",15),d(1),c(2,"translate"),l()),n&2&&(o(),C(" ",p(2,1,"checkIns.noRecent")," "))}var Be=class n{constructor(t,e,i,r,m,x){this.checkInsService=t;this.authApiService=e;this.languageService=i;this.translate=r;this.cdr=m;this.themeService=x;this.currentTheme$=this.themeService.theme$}cafeId;checkIns=[];currentTheme$;subscription=new Xe;ngOnInit(){if(!this.cafeId)return;this.loadCheckIns();let t=this.checkInsService.checkInsUpdated$.subscribe(()=>{this.loadCheckIns()});this.subscription.add(t)}ngOnDestroy(){this.subscription.unsubscribe()}loadCheckIns(){this.checkInsService.getCheckInsByCafe(this.cafeId).subscribe({next:t=>{let i=t.sort((x,U)=>new Date(U.timestamp).getTime()-new Date(x.timestamp).getTime()).slice(0,4),m=Array.from(new Set(i.map(x=>x.userId))).map(x=>this.authApiService.getPublicUserProfile(x));ue(m).subscribe({next:x=>{let U=this.getAllAchievements(),W=new Map;x.forEach(L=>{let K=pe(L);W.set(L.id,K)}),this.checkIns=i.map(L=>{let K=W.get(L.userId)||[],ae=le(K,U);return de(se({},L),{badge:ae})}),this.cdr.detectChanges()},error:x=>console.error("Failed to load user profiles",x)})},error:t=>console.error("Failed to load check-ins",t)})}getAllAchievements(){return ce}formatCheckInDate(t){let e=this.parseDateInTimeZone(t,"Europe/Zurich"),i=new Date,r=this.languageService.currentLang==="uk"?"uk-UA":"en-US",m=i.toLocaleDateString(r,{timeZone:"Europe/Kiev"}),x=new Date(i);x.setDate(i.getDate()-1);let U=x.toLocaleDateString(r,{timeZone:"Europe/Kiev"}),W=e.toLocaleDateString(r,{timeZone:"Europe/Kiev"}),L={hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Europe/Kiev"},K={month:"long",day:"numeric",timeZone:"Europe/Kiev"},ae=this.translate.instant("date.today"),D=this.translate.instant("date.yesterday"),We=this.translate.instant("date.at");return W===m?`${ae} ${We} ${e.toLocaleTimeString(r,L)}`:W===U?`${D} ${We} ${e.toLocaleTimeString(r,L)}`:`${e.toLocaleDateString(r,K)}, ${e.toLocaleTimeString(r,L)}`}parseDateInTimeZone(t,e){let i=new Date(t),m=new Intl.DateTimeFormat("en-US",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(i),x=Number(m.find(D=>D.type==="year")?.value),U=Number(m.find(D=>D.type==="month")?.value)-1,W=Number(m.find(D=>D.type==="day")?.value),L=Number(m.find(D=>D.type==="hour")?.value),K=Number(m.find(D=>D.type==="minute")?.value),ae=Number(m.find(D=>D.type==="second")?.value);return new Date(Date.UTC(x,U,W,L,K,ae))}static \u0275fac=function(e){return new(e||n)(v(Ae),v(Z),v(st),v(re),v(B),v(q))};static \u0275cmp=I({type:n,selectors:[["app-last-check-ins"]],inputs:{cafeId:"cafeId"},decls:11,vars:8,consts:[["noCheckins",""],[1,"flex","flex-col","gap-4"],[1,"flex","flex-col","gap-2"],[1,"body-font-1"],[4,"ngIf","ngIfElse"],[1,"flex","flex-col","gap-2","lg:flex-row","lg:gap-5"],["class","flex-grow",4,"ngFor","ngForOf"],[1,"flex-grow"],[1,"flex","gap-4","rounded-[24px]","p-2",3,"ngClass"],[1,"relative","inline-block","bg-transparent",3,"routerLink","ngClass","title"],["alt","badge","class","absolute left-0 top-0 rounded-full bg-transparent","style","object-fit: cover; pointer-events: none;",3,"src","ngClass",4,"ngIf"],[1,"absolute","left-1/2","top-1/2","rounded-full",2,"object-fit","cover","transform","translate(-50%, -50%)",3,"src","alt","ngClass"],[1,"menu-text-font"],[1,"body-font-2"],["alt","badge",1,"absolute","left-0","top-0","rounded-full","bg-transparent",2,"object-fit","cover","pointer-events","none",3,"src","ngClass"],[1,"text-[var(--color-gray-75)]"]],template:function(e,i){if(e&1&&(a(0,"div",1)(1,"div",2)(2,"h4"),d(3),c(4,"translate"),l(),a(5,"span",3),d(6),c(7,"translate"),l()(),w(8,mi,3,1,"ng-container",4)(9,di,3,3,"ng-template",null,0,H),l()),e&2){let r=z(10);o(3),b(p(4,4,"checkIns.title")),o(3),C(" ",p(7,6,"checkIns.subtitle")," "),o(2),s("ngIf",i.checkIns.length>0)("ngIfElse",r)}},dependencies:[S,V,P,A,ie,Se,E,ee,Re,M],encapsulation:2})};function ui(n,t){if(n&1&&_(0,"app-last-check-ins",17),n&2){let e=u(2);s("cafeId",e.place.id)}}function vi(n,t){if(n&1){let e=y();a(0,"div",8)(1,"div",9),_(2,"app-breadcrumbs",10),a(3,"app-carousel-section",11),g("onToggleFavorite",function(){f(e);let r=u();return h(r.onToggleFavorite())})("onShare",function(){f(e);let r=u();return h(r.openShareModal())}),l(),_(4,"app-main-info-section",12),l(),a(5,"app-rating-reviews-section",13),g("closeAddReviewForm",function(){f(e);let r=u();return h(r.showAddReviewForm=!1)}),l(),w(6,ui,1,1,"app-last-check-ins",14),a(7,"app-slider-places",15),c(8,"translate"),g("unauthorizedFavoriteClick",function(){f(e);let r=u();return h(r.showLoginModal=!0)}),l(),a(9,"app-actions-sector",16),g("leaveReviewClick",function(){f(e);let r=u();return h(r.handleLeaveReviewClick())})("onToggleFavorite",function(){f(e);let r=u();return h(r.onToggleFavorite())})("onShare",function(){f(e);let r=u();return h(r.openShareModal())}),l()()}if(n&2){let e=u();o(2),s("lastLabel",e.place.name),o(),s("place",e.place)("photoUrls",e.place.photoUrls)("isFavorite",e.isFavorite),o(),s("place",e.place),o(),s("cafeId",e.place.id)("place",e.place)("currentUser",e.currentUser)("isMobile",e.isMobile)("showAddReviewForm",e.showAddReviewForm)("alwaysShowFormOnDesktop",!e.isMobile),o(),s("ngIf",e.place),o(),s("title",p(8,18,"places.moreCafes"))("places",e.randomPlaces),o(2),s("isFavorite",e.isFavorite)("isMobile",e.isMobile)("showAddReviewForm",e.showAddReviewForm)("isLoggedIn",e.isLoggedIn)}}var ht=class n{constructor(t,e,i,r,m,x,U,W,L){this.route=t;this.router=e;this.placesService=i;this.favoritesService=r;this.authService=m;this.loaderService=x;this.cdr=U;this.favoriteToggleService=W;this.translate=L}place=null;isMobile=!1;showAddReviewForm=!1;showLoginModal=!1;showShareModal=!1;copied=!1;scrollToReviewForm=!1;reviewsSectionRef;randomPlaces=[];isFavorite=!1;ngOnInit(){this.updateScreenMode(),this.route.paramMap.subscribe(t=>{let e=t.get("id");if(!e){this.router.navigate(["/not-found"]);return}let i=localStorage.getItem("lang")||"en";this.loadPlaceData(i,e)}),this.translate.onLangChange.subscribe(t=>{let e=this.route.snapshot.paramMap.get("id");e&&this.loadPlaceData(t.lang,e)})}loadPlaceData(t,e){this.loaderService.show();let i=Number(e);if(isNaN(i)){this.router.navigate(["/not-found"]),this.loaderService.hide();return}this.placesService.getPlaces(t).subscribe({next:r=>{if(this.place=r.find(m=>m.id===i)||null,!this.place){this.router.navigate(["/not-found"]),this.loaderService.hide();return}this.isFavorite=this.favoriteToggleService.isFavorite(this.place.id),this.cdr.detectChanges(),this.randomPlaces=this.shuffleArray(r.filter(m=>m.id!==this.place.id)).slice(0,8),this.loaderService.hide()},error:()=>{this.router.navigate(["/not-found"]),this.loaderService.hide()}})}ngAfterViewChecked(){this.scrollToReviewForm&&this.reviewsSectionRef&&(this.scrollToReviewForm=!1,this.reviewsSectionRef.nativeElement.scrollIntoView({behavior:"smooth",block:"start"}))}shuffleArray(t){let e=[...t];for(let i=e.length-1;i>0;i--){let r=Math.floor(Math.random()*(i+1));[e[i],e[r]]=[e[r],e[i]]}return e}onResize(){this.updateScreenMode()}updateScreenMode(){this.isMobile=window.innerWidth<1024,this.cdr.detectChanges()}handleLeaveReviewClick(){if(!this.currentUser){this.showLoginModal=!0;return}this.showAddReviewForm=!0,this.isMobile&&(this.scrollToReviewForm=!0)}onToggleFavorite(){event?.preventDefault(),event?.stopPropagation(),this.place&&this.favoriteToggleService.toggleFavorite(this.place).subscribe({next:()=>{this.isFavorite=this.favoriteToggleService.isFavorite(this.place.id),this.cdr.detectChanges()},error:t=>{t.message==="NOT_AUTHENTICATED"?this.showLoginModal=!0:alert("An error occurred while updating favorites.")}})}navigateToAuth(){localStorage.setItem("returnUrl",this.router.url),this.showLoginModal=!1,this.router.navigate(["/auth"])}openShareModal(){if(!this.isLoggedIn){this.showLoginModal=!0;return}this.showShareModal=!0,this.copied=!1}handleShare(){this.place?.id&&navigator.clipboard.writeText(this.currentShareLink).then(()=>{this.copied=!0,setTimeout(()=>{this.copied=!1},3e3)}).catch(t=>{console.error("Failed to copy URL: ",t)})}get currentUser(){return this.authService.getCurrentUser()}get isLoggedIn(){return!!this.currentUser}get currentShareLink(){return`${window.location.origin}/places/${this.place?.id}`}static \u0275fac=function(e){return new(e||n)(v(et),v(te),v(at),v(mt),v(ct),v(pt),v(B),v(dt),v(re))};static \u0275cmp=I({type:n,selectors:[["app-place-details-page"]],viewQuery:function(e,i){if(e&1&&qe(me,5,fe),e&2){let r;Ze(r=Ge())&&(i.reviewsSectionRef=r.first)}},hostBindings:function(e,i){e&1&&g("resize",function(){return i.onResize()},he)},decls:20,vars:18,consts:[["class","flex max-w-[1320px] flex-col gap-20 px-5 lg:px-10 xxl:mx-auto xxl:px-0",4,"ngIf"],[3,"close","isOpen"],[1,"mb-4","text-center"],[1,"flex","justify-center","gap-4"],[1,"button-font","button-bg-blue","px-6","py-2",3,"click"],[1,"button-font","button-bg-transparent","px-6","py-2",3,"click"],["readonly","",1,"mb-4","w-full","truncate","rounded-lg","border","p-3",3,"value"],[1,"button-bg-blue","h-12","w-full",3,"click"],[1,"flex","max-w-[1320px]","flex-col","gap-20","px-5","lg:px-10","xxl:mx-auto","xxl:px-0"],[1,"xxl:grid","xxl:grid-cols-8","xxl:gap-5"],[1,"mb-[24px]","xxl:col-span-8",3,"lastLabel"],[1,"xxl:col-span-4",3,"onToggleFavorite","onShare","place","photoUrls","isFavorite"],[1,"mt-4","lg:mt-0","xxl:col-span-4",3,"place"],[3,"closeAddReviewForm","cafeId","place","currentUser","isMobile","showAddReviewForm","alwaysShowFormOnDesktop"],[3,"cafeId",4,"ngIf"],[3,"unauthorizedFavoriteClick","title","places"],[3,"leaveReviewClick","onToggleFavorite","onShare","isFavorite","isMobile","showAddReviewForm","isLoggedIn"],[3,"cafeId"]],template:function(e,i){e&1&&(w(0,vi,10,20,"div",0),a(1,"app-modal",1),g("close",function(){return i.showLoginModal=!1}),a(2,"h4",2),d(3),c(4,"translate"),l(),a(5,"div",3)(6,"button",4),g("click",function(){return i.navigateToAuth()}),d(7),c(8,"translate"),l(),a(9,"button",5),g("click",function(){return i.showLoginModal=!1}),d(10),c(11,"translate"),l()()(),a(12,"app-modal",1),g("close",function(){return i.showShareModal=!1}),a(13,"h4",2),d(14,"Share this caf\xE9"),l(),_(15,"input",6),a(16,"button",7),g("click",function(){return i.handleShare()}),d(17),c(18,"translate"),c(19,"translate"),l()()),e&2&&(s("ngIf",i.place),o(),s("isOpen",i.showLoginModal),o(2),b(p(4,8,"modals.loginTitle")),o(4),C(" ",p(8,10,"modals.loginBtn")," "),o(3),C(" ",p(11,12,"modals.closeBtn")," "),o(2),s("isOpen",i.showShareModal),o(3),s("value",i.currentShareLink),o(2),C(" ",i.copied?p(18,14,"modals.copied"):p(19,16,"modals.copyLink")," "))},dependencies:[S,A,Ee,De,Le,ne,vt,me,ut,E,Be,M],encapsulation:2})};export{ht as PlaceDetailsPageComponent};
