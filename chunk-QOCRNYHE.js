import{a as pt}from"./chunk-BY6SHIMA.js";import{a as ft}from"./chunk-DJVKRGXL.js";import{a as at}from"./chunk-GCYQK47Q.js";import{l as ne,p as st}from"./chunk-JNKG7ZJO.js";import{a as le,b as ce,c as pe,d as Re}from"./chunk-XY75CFKU.js";import{a as gt}from"./chunk-DBSFUAGU.js";import{a as dt}from"./chunk-BVDCD44H.js";import{b as ut,c as vt,d as Ae}from"./chunk-J6SAVLMI.js";import{a as lt}from"./chunk-X25XQKGC.js";import{b as nt,c as rt,f as ot,j as ke}from"./chunk-H5V2GQTQ.js";import{Aa as we,Ab as Te,B as ge,Ba as Ce,Bb as ct,C as f,Cb as re,D as h,Db as K,Ea as Ye,Eb as Fe,Fa as q,Fb as mt,Ga as xe,H as J,Ha as U,Ia as et,J as fe,L as N,La as c,M as he,Ma as p,O as o,Oa as W,R as v,Ra as B,T as I,Ua as V,Va as L,Wa as F,Y as _,Z as k,Za as tt,_a as be,a as se,ab as Ie,b as de,ba as a,bb as S,ca as s,da as l,e as Xe,ea as w,fa as je,ga as $e,gb as Se,ia as T,j as qe,ja as R,ka as y,la as g,m as ue,ma as u,nb as it,p as Ke,pa as Ze,pb as ee,qa as Ge,qb as ye,ra as Qe,sa as z,sb as te,ua as Je,ub as ie,va as d,vb as A,wa as b,wb as M,xa as C,xb as j,y as ve,ya as Y,yb as P,za as _e,zb as $}from"./chunk-EAEB62OB.js";var Me=class n{constructor(i){this.http=i}shareCafe(i){return this.http.post(`${Te.sharedCafes.base}/${i}`,null).pipe(Ke(this.handleError))}handleError(i){let e="An unknown error occurred!";return i.error instanceof ErrorEvent?e=`Client-side error: ${i.error.message}`:e=`Server returned code ${i.status}, body was: ${i.error}`,console.error(e),qe(()=>new Error(e))}static \u0275fac=function(e){return new(e||n)(ge(Se))};static \u0275prov=ve({token:n,factory:n.\u0275fac,providedIn:"root"})};function It(n,i){if(n&1&&w(0,"img",12),n&2){let e=u().$implicit;a("@fadeInOutImage",void 0)("src",e,N)}}function St(n,i){if(n&1&&(T(0),_(1,It,1,2,"img",11),R()),n&2){let e=i.$implicit;o(),a("ngIf",e)}}var Ee=class n{constructor(i,e,t,r){this.themeService=i;this.sharedCafesService=e;this.userService=t;this.storageService=r}photoUrls=[];isFavorite=!1;place;onToggleFavorite=new k;onShare=new k;currentIndex=0;prevIndex=null;isAnimating=!1;ICONS=P;animationDuration=600;touchStartX=null;touchMoveX=null;handleNext(){if(!this.photoUrls.length)return;let i=(this.currentIndex+1)%this.photoUrls.length;this.triggerChange(i)}handlePrev(){if(!this.photoUrls.length)return;let i=this.currentIndex===0?this.photoUrls.length-1:this.currentIndex-1;this.triggerChange(i)}triggerChange(i){this.prevIndex=this.currentIndex,this.currentIndex=i,this.isAnimating=!0,setTimeout(()=>{this.isAnimating=!1,this.prevIndex=null},this.animationDuration)}get imagesToRender(){return this.isAnimating&&this.prevImageUrl&&this.currentImageUrl?[this.prevImageUrl,this.currentImageUrl]:this.currentImageUrl?[this.currentImageUrl]:[]}get currentImageUrl(){return this.photoUrls?.[this.currentIndex]??null}get prevImageUrl(){return this.prevIndex!==null?this.photoUrls?.[this.prevIndex]??null:null}onTouchStart(i){this.touchStartX=i.touches[0].clientX}onTouchMove(i){this.touchMoveX=i.touches[0].clientX}onTouchEnd(){if(this.touchStartX!==null&&this.touchMoveX!==null){let i=this.touchStartX-this.touchMoveX;Math.abs(i)>50&&(i>0?this.handleNext():this.handlePrev())}this.touchStartX=null,this.touchMoveX=null}handleShare(){let i=`${window.location.origin}/home-pro/catalog/${this.place.id}`;if(!this.storageService.isAuthenticated()){this.onShare.emit(i);return}this.place?.id&&this.sharedCafesService.shareCafe(this.place.id).subscribe({next:()=>{let e=this.storageService.getUser()?.userId||0;this.userService.getPublicUserProfile(e).subscribe({next:t=>{this.storageService.setPublicUserProfile(t),this.onShare.emit(i)},error:t=>{console.error("Error updating public profile:",t)}})},error:e=>{console.error("Error sharing cafe:",e)}})}getButtonBgClass(){return{"bg-[#FFFFFF]/60":this.themeService.currentTheme==="light","bg-[#0D0D0D]/60":this.themeService.currentTheme==="dark"}}getIndicatorClass(){return{"bg-[#FFFFFF]/60":this.themeService.currentTheme==="light","bg-[#0D0D0D]/60 text-[var(--color-white)]":this.themeService.currentTheme==="dark"}}ngOnDestroy(){}static \u0275fac=function(e){return new(e||n)(v(j),v(Me),v(K),v(Fe))};static \u0275cmp=I({type:n,selectors:[["app-carousel-section"]],inputs:{photoUrls:"photoUrls",isFavorite:"isFavorite",place:"place"},outputs:{onToggleFavorite:"onToggleFavorite",onShare:"onShare"},decls:20,vars:30,consts:[[1,"relative","flex","h-[550px]","touch-pan-y","items-center","justify-center","overflow-hidden",3,"touchstart","touchmove","touchend"],["aria-label","Previous image",1,"absolute","left-[24px]","top-1/2","z-10","flex","h-[52px]","w-[52px]","-translate-y-1/2","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass"],[3,"icon","width","height"],[1,"relative","h-full","w-full"],[1,"absolute","right-[24px]","top-[24px]","z-10","flex","gap-[16px]"],["aria-label","Toggle favorite",1,"relative","flex","h-[44px]","w-[44px]","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass","title"],[3,"icon"],["aria-label","Share this place",1,"flex","h-[44px]","w-[44px]","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass","title"],[4,"ngFor","ngForOf"],["aria-label","Next image",1,"absolute","right-[24px]","top-1/2","z-10","flex","h-[52px]","w-[52px]","-translate-y-1/2","items-center","justify-center","rounded-full","p-[10px]","backdrop-blur","transition",3,"click","ngClass"],[1,"button-font","absolute","bottom-5","right-5","rounded-[40px]","px-3","py-1","backdrop-blur",3,"ngClass"],["class","absolute inset-0 h-full w-full rounded-[40px] object-cover","alt","Carousel image",3,"src",4,"ngIf"],["alt","Carousel image",1,"absolute","inset-0","h-full","w-full","rounded-[40px]","object-cover",3,"src"]],template:function(e,t){e&1&&(s(0,"div",0),g("touchstart",function(m){return t.onTouchStart(m)})("touchmove",function(m){return t.onTouchMove(m)})("touchend",function(){return t.onTouchEnd()}),s(1,"button",1),g("click",function(){return t.handlePrev()}),w(2,"app-icon",2),c(3,"themedIcon"),l(),s(4,"div",3)(5,"div",4)(6,"button",5),c(7,"translate"),g("click",function(){return t.onToggleFavorite.emit()}),w(8,"app-icon",6),c(9,"themedIcon"),l(),s(10,"button",7),c(11,"translate"),g("click",function(){return t.handleShare()}),w(12,"app-icon",6),c(13,"themedIcon"),l()(),_(14,St,2,1,"ng-container",8),l(),s(15,"button",9),g("click",function(){return t.handleNext()}),w(16,"app-icon",2),c(17,"themedIcon"),l(),s(18,"div",10),d(19),l()()),e&2&&(o(),a("ngClass",t.getButtonBgClass()),o(),a("icon",p(3,18,"ArrowLeft"))("width",32)("height",32),o(4),a("ngClass",t.getButtonBgClass())("title",p(7,20,"place_details_page.carousel.addToFavorites")),o(2),a("icon",t.isFavorite?t.ICONS.HeartBlueFill:p(9,22,"HeartBlue")),o(2),a("ngClass",t.getButtonBgClass())("title",p(11,24,"place_details_page.carousel.shareThisPlace")),o(2),a("icon",p(13,26,"Share")),o(2),a("ngForOf",t.imagesToRender),o(),a("ngClass",t.getButtonBgClass()),o(),a("icon",p(17,28,"ArrowRight"))("width",32)("height",32),o(2),a("ngClass",t.getIndicatorClass()),o(),Y(" ",t.currentIndex+1," / ",t.photoUrls.length||0," "))},dependencies:[S,V,L,F,$,M,re,A],encapsulation:2,data:{animation:[st]}})};function kt(n,i){if(n&1&&(s(0,"div",15)(1,"div",16)(2,"div",17),w(3,"app-icon",6),c(4,"themedIcon"),s(5,"div",18)(6,"span",19),d(7),c(8,"translate"),l(),s(9,"span",11),d(10),l()()()()()),n&2){let e=u();o(2),a("ngClass",e.workingHoursClass),o(),a("icon",p(4,4,"Clock")),o(4),b(p(8,6,"place_details_page.main_info.opening_hours")),o(3),b(e.place.workingHours)}}function Tt(n,i){if(n&1&&(T(0),w(1,"app-icon",6),R()),n&2){let e=u().ngIf;o(),a("icon",e)}}function Rt(n,i){if(n&1&&w(0,"img",25),n&2){let e=u().ngIf,t=u(3);a("src",t.getIconURL(e),N)("alt",t.getIconLabel(e))}}function Ft(n,i){if(n&1&&(T(0),_(1,Tt,2,1,"ng-container",14)(2,Rt,1,2,"ng-template",null,1,W),R()),n&2){let e=i.ngIf,t=z(3),r=u(3);o(),a("ngIf",r.isIconData(e))("ngIfElse",t)}}function At(n,i){if(n&1&&(s(0,"div",22),_(1,Ft,4,2,"ng-container",23),s(2,"span",24),d(3),l()()),n&2){let e=i.$implicit,t=u(2);a("ngClass",t.tagClass),o(),a("ngIf",t.TAG_ICON_MAP[e.id.toString()]),o(2),b(e.name)}}function Mt(n,i){if(n&1&&(s(0,"div",20),_(1,At,4,3,"div",21),l()),n&2){let e=u();o(),a("ngForOf",e.place.tags)}}function Et(n,i){if(n&1&&(T(0),w(1,"app-icon",6),d(2),c(3,"translate"),c(4,"translate"),R()),n&2){let e=u();o(),a("icon",e.isCheckedIn?e.ICONS.CheckCircle:e.ICONS.AddCircle),o(),C(" ",e.isCheckedIn?p(3,2,"button.check_in.checked_in"):p(4,4,"button.check_in.check_in")," ")}}function Dt(n,i){if(n&1&&(w(0,"app-icon",6),d(1),c(2,"translate")),n&2){let e=u();a("icon",e.ICONS.AddCircle),o(),C(" ",p(2,2,"place_details_page.main_info.log_in_to_check_in")," ")}}var Le=class n{constructor(i,e,t,r,m,x){this.themeService=i;this.router=e;this.checkInsService=t;this.storageService=r;this.userService=m;this.cdr=x;this.currentTheme$=this.themeService.theme$,this.initializeTagIconMap()}place;currentTheme$;ICONS=P;TAG_ICON_MAP={};isCheckedIn=!1;ngOnInit(){this.updateCheckInStatus()}get isAuthenticated(){return!!this.storageService.getUser()}get googleMapsUrl(){return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${this.place.address}, ${this.place.city}`)}`}get checkInTitle(){return this.isCheckedIn?"button.check_in.already_checked_in":this.isAuthenticated?"button.check_in.check_in":"place_details_page.main_info.please_login_to_check_in"}get themeTextClass(){return this.themeService.currentTheme==="dark"?"text-[var(--color-gray-20)]":"text-[var(--color-gray-75)]"}get workingHoursClass(){return this.themeService.currentTheme==="dark"?"bg-[var(--color-bg-card)] text-[var(--color-gray-20)]":"bg-[var(--color-bg-2)] text-[var(--color-gray-100)]"}get tagClass(){return this.themeService.currentTheme==="dark"?"bg-[var(--color-bg-card)]":"bg-[var(--color-secondary)]"}get checkInButtonClass(){return this.isAuthenticated&&this.isCheckedIn?"button-bg-transparent":"button-bg-blue"}initializeTagIconMap(){at.forEach(i=>{i.options.forEach(e=>{this.TAG_ICON_MAP[e.id.toString()]={iconURL:e.iconURL??"",iconURLDarkTheme:e.iconURLDarkTheme??"",label:e.label}})})}isIconData(i){return"viewBox"in i}getIconURL(i){return this.isIconData(i)?"":this.themeService.currentTheme==="dark"&&i.iconURLDarkTheme?i.iconURLDarkTheme:i.iconURL}getIconLabel(i){return this.isIconData(i)?"":i.label}updateCheckInStatus(){if(!this.place)return;let i=this.storageService.getPublicUserProfile();this.isCheckedIn=i?.checkInCafes?.some(e=>e.id===this.place.id)??!1,this.cdr.detectChanges()}onCheckInClick(i){if(i.stopPropagation(),!this.isAuthenticated){this.router.navigate(["/auth"]);return}this.isCheckedIn||this.performCheckIn()}performCheckIn(){this.checkInsService.checkInToCafe(this.place.id).subscribe({next:()=>{let i=this.storageService.getUser()?.userId||0;this.userService.getPublicUserProfile(i).subscribe({next:e=>{this.storageService.setPublicUserProfile(e),this.isCheckedIn=!0,this.checkInsService.checkInsUpdatedSource.next(),this.cdr.detectChanges(),this.router.navigate(["/catalog",this.place.id])},error:e=>console.error("Error updating user profile:",e)})},error:i=>console.error("Error performing check-in:",i)})}static \u0275fac=function(e){return new(e||n)(v(j),v(ee),v(Ae),v(Fe),v(K),v(B))};static \u0275cmp=I({type:n,selectors:[["app-main-info-section"]],inputs:{place:"place"},decls:28,vars:22,consts:[["notAuth",""],["customIcon",""],[1,"flex","flex-col","gap-6",3,"ngClass"],[1,"body-font-1","flex","flex-col","justify-between","gap-[32px]","lg:flex-row"],[1,"flex","flex-1","flex-col","gap-2",3,"ngClass"],[1,"flex","gap-2","items-center"],[3,"icon"],[1,"flex","items-center","gap-2"],["target","_blank","rel","noopener noreferrer",1,"underline",3,"href"],["class","flex-1",4,"ngIf"],[1,"flex","flex-col","gap-4"],[1,"body-font-1"],["class","flex flex-wrap gap-2",4,"ngIf"],["type","button",1,"w-full","gap-2","px-4","py-3","lg:w-1/2",3,"click","disabled","title","ngClass"],[4,"ngIf","ngIfElse"],[1,"flex-1"],[1,"gap-[20px]"],[1,"flex","items-center","justify-center","gap-3","rounded-[40px]","px-6","py-2",3,"ngClass"],[1,"flex","flex-col","justify-center","gap-1","text-center"],[1,"menu-text-font"],[1,"flex","flex-wrap","gap-2"],["class","tag-item flex items-center justify-center gap-2 rounded-[40px] px-4 py-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"tag-item","flex","items-center","justify-center","gap-2","rounded-[40px]","px-4","py-2",3,"ngClass"],[4,"ngIf"],[1,"body-font-2"],[3,"src","alt"]],template:function(e,t){if(e&1){let r=y();s(0,"div",2)(1,"h3"),d(2),l(),s(3,"div",3)(4,"div",4)(5,"div",5),w(6,"app-icon",6),s(7,"span"),d(8),l(),s(9,"span"),d(10),l()(),s(11,"div",7),w(12,"app-icon",6),s(13,"a",8),d(14),l()()(),_(15,kt,11,8,"div",9),l(),s(16,"div",10)(17,"h5"),d(18),c(19,"translate"),l(),s(20,"span",11),d(21),l(),_(22,Mt,2,1,"div",12),l(),s(23,"button",13),c(24,"translate"),g("click",function(x){return f(r),h(t.onCheckInClick(x))}),_(25,Et,5,6,"ng-container",14)(26,Dt,3,4,"ng-template",null,0,W),l()()}if(e&2){let r=z(27);a("ngClass",t.themeTextClass),o(2),b(t.place.name),o(2),a("ngClass",t.themeTextClass),o(2),a("icon",t.ICONS.Star),o(2),b(t.place.rating),o(2),C("(",t.place.reviewCount,")"),o(2),a("icon",t.ICONS.Location),o(),a("href",t.googleMapsUrl,N),o(),C(" ",t.place.address," "),o(),a("ngIf",t.place==null?null:t.place.workingHours),o(3),b(p(19,18,"place_details_page.main_info.about_cafe")),o(3),b(t.place.longDescription),o(),a("ngIf",t.place==null||t.place.tags==null?null:t.place.tags.length),o(),a("disabled",t.isCheckedIn)("title",p(24,20,t.checkInTitle))("ngClass",t.checkInButtonClass),o(2),a("ngIf",t.isAuthenticated)("ngIfElse",r)}},dependencies:[S,V,L,F,$,M,A,re],encapsulation:2})};function Lt(n,i){if(n&1){let e=y();s(0,"button",9),g("click",function(){f(e);let r=u();return h(r.leaveReviewClick.emit())}),d(1),c(2,"translate"),l()}n&2&&(o(),C(" ",p(2,1,"actions.leaveReview")," "))}function Pt(n,i){if(n&1&&(T(0),w(1,"app-icon",8),R()),n&2){let e=u();o(),a("icon",e.ICONS.HeartBlueFill)}}function Ot(n,i){if(n&1&&w(0,"app-icon",8),n&2){let e=u();a("icon",e.ICONS.HeartBlue)}}var Pe=class n{ICONS=P;isFavorite=!1;showAddReviewForm=!1;isMobile=!1;isLoggedIn=!1;leaveReviewClick=new k;onToggleFavorite=new k;onShare=new k;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-actions-sector"]],inputs:{isFavorite:"isFavorite",showAddReviewForm:"showAddReviewForm",isMobile:"isMobile",isLoggedIn:"isLoggedIn"},outputs:{leaveReviewClick:"leaveReviewClick",onToggleFavorite:"onToggleFavorite",onShare:"onShare"},decls:20,vars:18,consts:[["blueHeart",""],[1,"mb-11","flex","flex-col","items-center","gap-4"],[1,"body-font-1"],[1,"flex","w-full","flex-col","gap-4","lg:w-auto","lg:flex-row"],["class","button-font button-bg-blue w-full px-6 py-3 lg:w-auto",3,"click",4,"ngIf"],[1,"button-bg-transparent","button-font","flex","w-full","items-center","gap-2","rounded-[40px]","px-6","py-3","lg:w-auto",3,"click"],[4,"ngIf","ngIfElse"],[1,"button-font","button-bg-transparent","flex","w-full","gap-2","px-6","py-3","lg:w-auto",3,"click"],[3,"icon"],[1,"button-font","button-bg-blue","w-full","px-6","py-3","lg:w-auto",3,"click"]],template:function(e,t){if(e&1){let r=y();s(0,"div",1)(1,"h5"),d(2),c(3,"translate"),l(),s(4,"span",2),d(5),c(6,"translate"),l(),s(7,"div",3),_(8,Lt,3,3,"button",4),s(9,"button",5),g("click",function(){return f(r),h(t.onToggleFavorite.emit())}),_(10,Pt,2,1,"ng-container",6)(11,Ot,1,1,"ng-template",null,0,W),d(13),c(14,"translate"),c(15,"translate"),l(),s(16,"button",7),g("click",function(){return f(r),h(t.onShare.emit())}),w(17,"app-icon",8),d(18),c(19,"translate"),l()()()}if(e&2){let r=z(12);o(2),b(p(3,8,"actions.title")),o(3),C(" ",p(6,10,"actions.subtitle")," "),o(3),a("ngIf",!t.showAddReviewForm&&(!t.isLoggedIn||t.isMobile)),o(2),a("ngIf",t.isFavorite)("ngIfElse",r),o(3),C(" ",t.isFavorite?p(14,12,"actions.removeFromFavorites"):p(15,14,"actions.saveToFavorites")," "),o(4),a("icon",t.ICONS.ShareBlue),o(),C(" ",p(19,16,"actions.share")," ")}},dependencies:[S,F,$,M,A],encapsulation:2})};var Oe=class n{value=0;previousValue=0;shouldAnimate=!1;ngOnChanges(i){let e=i.value?.currentValue,t=i.value?.previousValue;e!==t&&(this.previousValue=t??0,this.shouldAnimate=!0,setTimeout(()=>{this.shouldAnimate=!1},400))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-flip-number"]],inputs:{value:"value"},features:[J],decls:6,vars:4,consts:[[1,"flip-wrapper"],[1,"flip-digit"],[1,"front"],[1,"back"]],template:function(e,t){e&1&&(je(0,"div",0)(1,"div",1)(2,"span",2),d(3),$e(),je(4,"span",3),d(5),$e()()()),e&2&&(o(),Je("flip",t.shouldAnimate),o(2),b(t.previousValue),o(2),b(t.value))},dependencies:[S],styles:[".flip-wrapper[_ngcontent-%COMP%]{perspective:1000px;height:14px;width:14px;overflow:hidden;align-items:flex-end;justify-content:center;padding-bottom:2px}.flip-digit[_ngcontent-%COMP%]{position:relative;height:100%;transform-style:preserve-3d;transition:transform .4s ease-in-out}.flip-digit.flip[_ngcontent-%COMP%]{transform:rotateX(-180deg)}.front[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center;backface-visibility:hidden}.back[_ngcontent-%COMP%]{transform:rotateX(180deg)}"],changeDetection:0})};var Ut=n=>["/users",n],Nt=(n,i)=>({width:n,height:i}),Bt=(n,i)=>({transform:"translate(-50%, -50%)",width:n,height:i}),Vt=()=>({"items-end":!0,"lg:items-center":!0}),jt=(n,i)=>({width:n,height:i,transform:"translate(-50%, -50%)",objectFit:"contain"});function $t(n,i){if(n&1&&w(0,"img",26),n&2){let e=i.ngIf,t=u();a("src",e,N)("ngStyle",U(2,jt,t.isMobile?"50px":"113px",t.isMobile?"50px":"113px"))}}function Ht(n,i){if(n&1&&(s(0,"span",27),d(1),l()),n&2){let e=u();o(),b(e.review.text)}}function zt(n,i){if(n&1&&(T(0),w(1,"app-icon",20),R()),n&2){let e=u();o(),a("icon",e.ICONS.Star)}}function Wt(n,i){if(n&1){let e=y();s(0,"button",28),g("click",function(){f(e);let r=u();return h(r.onDeleteClick())}),w(1,"app-icon",20),l()}if(n&2){let e=u();o(),a("icon",e.ICONS.Close)}}var Ue=class n{constructor(i,e,t,r,m,x){this.datePipe=i;this.elRef=e;this.translate=t;this.router=r;this.cdr=m;this.themeService=x;this.checkScreenSize(),this.currentTheme$=this.themeService.theme$}review;badgeType=null;currentUserId=null;likesInfo={likedByCurrentUser:!1,totalLikes:0};isLoggedIn=!1;delete=new k;toggleLike=new k;currentTheme$;animatedLikesCount=0;ICONS=P;isMobile=!1;showLoginModal=!1;animationInterval=null;ngOnDestroy(){this.animationInterval&&clearInterval(this.animationInterval)}ngOnChanges(i){let e=i.likesInfo;e&&e.currentValue&&e.previousValue&&e.previousValue.totalLikes!==e.currentValue.totalLikes?this.animateLikesCount(e.currentValue.totalLikes):e?.currentValue&&!e.previousValue&&(this.animatedLikesCount=e.currentValue.totalLikes),this.cdr.markForCheck()}onDeleteClick(){this.delete.emit(this.review.id)}onToggleLike(){if(!this.isLoggedIn){this.showLoginModal=!0;return}this.toggleLike.emit(!this.likesInfo.likedByCurrentUser),this.likesInfo={likedByCurrentUser:!this.likesInfo.likedByCurrentUser,totalLikes:this.likesInfo.likedByCurrentUser?this.likesInfo.totalLikes-1:this.likesInfo.totalLikes+1},this.cdr.markForCheck()}closeLoginModal(){this.showLoginModal=!1}goToLogin(){this.showLoginModal=!1,this.router.navigate(["/auth"])}getLikeIcon(){return this.isLoggedIn?this.likesInfo.likedByCurrentUser?"LikeFill":"Like":this.likesInfo.totalLikes>0?"LikeFill":"Like"}getStarsArray(i){return Array.from({length:i},(e,t)=>t+1)}formatDate(i){return this.datePipe.transform(i,"MMM dd, yyyy")}checkScreenSize(){this.isMobile=window.innerWidth<1024}get hasBadge(){return!!this.badgeType}get roundedLikesCount(){return Math.round(this.animatedLikesCount)}animateLikesCount(i){if(this.animationInterval&&clearInterval(this.animationInterval),i===0){this.animatedLikesCount=0;return}let e=500,t=60,r=Math.ceil(e/1e3*t),m=this.animatedLikesCount,x=(i-m)/r,O=0;this.animationInterval=setInterval(()=>{O++,this.animatedLikesCount+=x,O>=r&&(this.animatedLikesCount=i,clearInterval(this.animationInterval),this.animationInterval=null)},1e3/t),setTimeout(()=>{this.cdr.markForCheck()},e)}static \u0275fac=function(e){return new(e||n)(v(Ie),v(fe),v(ie),v(ee),v(B),v(j))};static \u0275cmp=I({type:n,selectors:[["app-review-item"]],hostBindings:function(e,t){e&1&&g("resize",function(){return t.checkScreenSize()},he)},inputs:{review:"review",badgeType:"badgeType",currentUserId:"currentUserId",likesInfo:"likesInfo",isLoggedIn:"isLoggedIn"},outputs:{delete:"delete",toggleLike:"toggleLike"},features:[Ye([Ie]),J],decls:36,vars:41,consts:[[1,"flex","gap-4","px-[18px]","py-[15px]"],[1,"relative","inline-block","bg-transparent",3,"routerLink"],[1,"relative","flex","items-center","justify-center",3,"ngStyle"],["alt","badge","class","absolute left-1/2 top-1/2 z-0",3,"src","ngStyle",4,"ngIf"],[1,"absolute","left-1/2","top-1/2","z-10",3,"ngStyle"],[3,"userPhoto","avatarSize","badgeSize","hasBadge"],[1,"flex","w-full","flex-col","justify-between","gap-2","lg:flex-row","lg:gap-0"],[1,"flex","flex-1","flex-col","gap-2"],[1,"menu-text-font"],["class","body-font-1",4,"ngIf"],[1,"flex","gap-[2px]"],[4,"ngFor","ngForOf"],[1,"w-22","relative","flex","flex-shrink-0","justify-between","lg:h-[113px]","lg:flex-col"],[1,"flex",3,"ngClass"],[1,"body-font-2"],[1,"flex","justify-between"],["class","cursor-pointer border-none bg-none","aria-label","Delete review",3,"click",4,"ngIf"],[1,"body-font-2","ml-auto","flex","items-end","gap-1"],[3,"value"],["aria-label","Like review",1,"flex","cursor-pointer","items-end","border-none",3,"click"],[3,"icon"],[3,"close","isOpen","width"],[1,"flex","flex-col","items-center","p-4","text-center"],[1,"mb-4","text-xl","font-semibold"],[1,"body-font-1","mb-4"],[1,"btn","btn-primary",3,"click"],["alt","badge",1,"absolute","left-1/2","top-1/2","z-0",3,"src","ngStyle"],[1,"body-font-1"],["aria-label","Delete review",1,"cursor-pointer","border-none","bg-none",3,"click"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"a",1)(2,"div",2),_(3,$t,1,5,"img",3),c(4,"badgeImage"),s(5,"div",4),w(6,"app-user-menu",5),l()()(),s(7,"div",6)(8,"div",7)(9,"span",8),d(10),l(),_(11,Ht,2,1,"span",9),s(12,"div",10),_(13,zt,2,1,"ng-container",11),l()(),s(14,"div",12)(15,"div",13)(16,"span",14),d(17),l()(),s(18,"div",15),_(19,Wt,2,1,"button",16),s(20,"div",17),w(21,"app-flip-number",18),s(22,"button",19),g("click",function(){return t.onToggleLike()}),w(23,"app-icon",20),c(24,"themedIcon"),l()()()()(),s(25,"app-modal",21),g("close",function(){return t.closeLoginModal()}),s(26,"div",22)(27,"h3",23),d(28),c(29,"translate"),l(),s(30,"p",24),d(31),c(32,"translate"),l(),s(33,"button",25),g("click",function(){return t.goToLogin()}),d(34),c(35,"translate"),l()()()()),e&2&&(o(),a("routerLink",xe(32,Ut,t.review.userId)),o(),a("ngStyle",U(34,Nt,t.isMobile?"50px":"113px",t.isMobile?"50px":"113px")),o(),a("ngIf",p(4,22,t.badgeType)),o(2),a("ngStyle",U(37,Bt,t.isMobile?"40px":"100px",t.isMobile?"40px":"100px")),o(),a("userPhoto",t.review.userPhotoUrl)("avatarSize",t.isMobile?40:100)("badgeSize",t.isMobile?50:113)("hasBadge",t.hasBadge),o(4),Y("",t.review.userName," ",t.review.userSurname),o(),a("ngIf",t.review.text),o(2),a("ngForOf",t.getStarsArray(t.review.rating)),o(2),a("ngClass",q(40,Vt)),o(2),b(t.formatDate(t.review.createdAt)),o(2),a("ngIf",t.currentUserId===t.review.userId),o(2),a("value",t.roundedLikesCount),o(2),a("icon",p(24,24,t.getLikeIcon())),o(2),a("isOpen",t.showLoginModal)("width","400px"),o(3),C(" ",p(29,26,"modals.loginTitle")," "),o(3),C(" ",p(32,28,"modals.loginMessageForLike")," "),o(3),C(" ",p(35,30,"modals.loginBtn")," "))},dependencies:[S,V,L,F,tt,te,ye,$,Oe,pt,ne,M,Re,A,re],styles:[".liked[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{color:red}"]})};var Xt=(n,i)=>({"border-[var(--color-gray-20)]":n,"border-[var(--color-gray-75)]":i}),qt=()=>[1,2,3,4,5],ht=(n,i)=>({"border-[var(--color-gray-20)] bg-[var(--color-white)]":n,"border-[var(--color-gray-100)] bg-transparent":i}),Kt=(n,i)=>({"border-[var(--color-gray-20)] bg-[var(--color-gray-10)]":n,"border-[var(--color-gray-100)] bg-[var(--color-bg-card)] text-[var(--color-gray-75)]":i}),Zt=(n,i,e)=>[n,i,e];function Gt(n,i){if(n&1){let e=y();T(0),s(1,"app-icon",14),g("mouseenter",function(){let r=f(e).$implicit,m=u(2);return h(m.hoveredRating=r)})("mouseleave",function(){f(e);let r=u(2);return h(r.hoveredRating=0)})("click",function(){let r=f(e).$implicit,m=u(2);return h(m.onStarClick(r))}),l(),R()}if(n&2){let e=i.$implicit,t=u(2);o(),a("icon",e<=(t.hoveredRating||t.newReviewRating)?t.ICONS.Star:t.ICONS.StarEmpty)}}function Qt(n,i){if(n&1){let e=y();s(0,"div",1),c(1,"async"),c(2,"async"),s(3,"h5"),d(4,"Submit your review"),l(),s(5,"div",2)(6,"span",3),d(7,"Add your rating"),l(),s(8,"div",4),_(9,Gt,2,1,"ng-container",5),l()(),s(10,"div",6)(11,"div",7)(12,"div",8)(13,"span",9),d(14,"Name*"),l(),s(15,"input",10),c(16,"async"),c(17,"async"),Ce("ngModelChange",function(r){f(e);let m=u();return we(m.userName,r)||(m.userName=r),h(r)}),l()(),s(18,"div",8)(19,"span",9),d(20,"Email*"),l(),s(21,"input",11),c(22,"async"),c(23,"async"),Ce("ngModelChange",function(r){f(e);let m=u();return we(m.userEmail,r)||(m.userEmail=r),h(r)}),l()()(),s(24,"div",8)(25,"span",9),d(26,"Write your review*"),l(),s(27,"textarea",12),c(28,"async"),c(29,"async"),Ce("ngModelChange",function(r){f(e);let m=u();return we(m.newReviewText,r)||(m.newReviewText=r),h(r)}),g("input",function(r){f(e);let m=u();return h(m.onTextInput(r))}),l()()(),s(30,"button",13),c(31,"async"),c(32,"async"),g("click",function(){f(e);let r=u();return h(r.onAddReview())}),d(33," Leave a Review "),l()()}if(n&2){let e=u();a("ngClass",U(31,Xt,p(1,11,e.currentTheme$)==="light",p(2,13,e.currentTheme$)==="dark")),o(9),a("ngForOf",q(34,qt)),o(6),_e("ngModel",e.userName),a("ngClass",U(35,ht,p(16,15,e.currentTheme$)==="light",p(17,17,e.currentTheme$)==="dark")),o(6),_e("ngModel",e.userEmail),a("disabled",!0)("ngClass",U(38,Kt,p(22,19,e.currentTheme$)==="light",p(23,21,e.currentTheme$)==="dark")),o(6),_e("ngModel",e.newReviewText),a("ngClass",U(41,ht,p(28,23,e.currentTheme$)==="light",p(29,25,e.currentTheme$)==="dark")),o(3),a("disabled",!e.canSubmitReview)("ngClass",et(44,Zt,e.canSubmitReview?"button-bg-blue cursor-pointer":"text-[var(--color-gray-55)]",p(31,27,e.currentTheme$)==="light"&&!e.canSubmitReview?"bg-[var(--color-gray-20)]":"",p(32,29,e.currentTheme$)==="dark"&&!e.canSubmitReview?"bg-[var(--color-gray-100)]":""))}}var Ne=class n{currentTheme$;userName="";userEmail="";newReviewText="";newReviewRating=0;canSubmitReview=!1;currentUser;alwaysShowFormOnDesktop=!1;showAddReviewForm=!1;reviewTextChange=new k;reviewRatingChange=new k;addReview=new k;hoveredRating=0;ICONS=P;onAddReview(){this.addReview.emit()}onStarClick(i){this.newReviewRating=i,this.reviewRatingChange.emit(i)}onTextInput(i){let e=i.target.value;this.newReviewText=e,this.reviewTextChange.emit(e),this.autoGrow(i)}autoGrow(i){let e=i.target;e.style.height="auto",e.style.height=`${e.scrollHeight}px`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-add-review-form"]],inputs:{currentTheme$:"currentTheme$",userName:"userName",userEmail:"userEmail",newReviewText:"newReviewText",newReviewRating:"newReviewRating",canSubmitReview:"canSubmitReview",currentUser:"currentUser",alwaysShowFormOnDesktop:"alwaysShowFormOnDesktop",showAddReviewForm:"showAddReviewForm"},outputs:{reviewTextChange:"reviewTextChange",reviewRatingChange:"reviewRatingChange",addReview:"addReview"},decls:1,vars:1,consts:[["class","flex flex-col gap-4 rounded-[40px] border p-4",3,"ngClass",4,"ngIf"],[1,"flex","flex-col","gap-4","rounded-[40px]","border","p-4",3,"ngClass"],[1,"flex","flex-col","gap-2"],[1,"body-font-2"],[1,"flex"],[4,"ngFor","ngForOf"],[1,"body-font-2","flex","flex-col","gap-2"],[1,"flex","gap-5"],[1,"flex","flex-1","flex-col","gap-1"],[1,"text-[var(--color-gray-55)]"],[1,"body-font-1","flex-1","rounded-[40px]","border","px-6","py-3","focus:border-[var(--color-gray-20)]","focus:outline-none",3,"ngModelChange","ngModel","ngClass"],[1,"body-font-1","flex-1","cursor-not-allowed","rounded-[40px]","border","px-6","py-3","text-[var(--color-gray-55)]",3,"ngModelChange","ngModel","disabled","ngClass"],["placeholder","Write what you think about this cafe...","rows","1",1,"body-font-1","w-full","flex-grow","resize-none","overflow-hidden","rounded-[40px]","border","px-8","py-3","focus:outline-none",3,"ngModelChange","input","ngModel","ngClass"],[1,"button-font","h-[48px]","w-[215px]","flex-shrink-0","rounded-[40px]","px-8","py-3",3,"click","disabled","ngClass"],[1,"cursor-pointer","transition","duration-200",3,"mouseenter","mouseleave","click","icon"]],template:function(e,t){e&1&&_(0,Qt,34,48,"div",0),e&2&&a("ngIf",t.currentUser&&(t.alwaysShowFormOnDesktop||t.showAddReviewForm))},dependencies:[S,V,L,F,ke,nt,rt,ot,$,be],encapsulation:2})};var Be=class n{constructor(i){this.http=i}baseUrl=Te.reviews.base;getReviewsByCafeId(i){return this.http.get(`${this.baseUrl}/cafe/${i}`)}addReview(i){return this.http.post(this.baseUrl,i,{headers:{"Content-Type":"application/json"}})}deleteReview(i){return this.http.delete(`${this.baseUrl}/${i}`)}static \u0275fac=function(e){return new(e||n)(ge(Se))};static \u0275prov=ve({token:n,factory:n.\u0275fac,providedIn:"root"})};function Yt(n,i){if(n&1){let e=y();s(0,"button",14),g("click",function(){f(e);let r=u();return h(r.showMore())}),d(1),c(2,"translate"),l()}if(n&2){let e=u();a("disabled",e.visibleCount>=e.reviews.length),o(),C(" ",p(2,2,"reviews.showMore")," ")}}function ei(n,i){if(n&1){let e=y();s(0,"app-review-item",16),g("toggleLike",function(r){let m=f(e).$implicit,x=u(2);return h(x.onToggleLike(m,r))})("delete",function(r){f(e);let m=u(2);return h(m.confirmDelete(r))}),l()}if(n&2){let e=i.$implicit,t=u(2);a("review",e)("badgeType",t.userBadgeTypes.get(e.userId)??null)("currentUserId",(t.currentUser==null?null:t.currentUser.userId)??null)("likesInfo",t.getLikesInfo(e.id))("isLoggedIn",!!t.currentUser)}}function ti(n,i){if(n&1&&(T(0),_(1,ei,1,5,"app-review-item",15),R()),n&2){let e=u();o(),a("ngForOf",e.reviews.slice(0,e.visibleCount))}}function ii(n,i){if(n&1){let e=y();s(0,"app-add-review-form",17),g("reviewTextChange",function(r){f(e);let m=u();return h(m.newReviewText=r)})("reviewRatingChange",function(r){f(e);let m=u();return h(m.newReviewRating=r)})("addReview",function(){f(e);let r=u();return h(r.addReview())}),l()}if(n&2){let e=u();a("currentUser",e.currentUser)("currentTheme$",e.currentTheme$)("userName",e.userName)("userEmail",e.userEmail)("newReviewText",e.newReviewText)("newReviewRating",e.newReviewRating)("canSubmitReview",e.canSubmitReview)("alwaysShowFormOnDesktop",e.alwaysShowFormOnDesktop)("showAddReviewForm",e.showAddReviewForm)}}function ni(n,i){n&1&&(s(0,"h5",18),d(1),c(2,"translate"),l()),n&2&&(o(),b(p(2,1,"reviews.noReviews")))}var me=class n{constructor(i,e,t,r){this.reviewsService=i;this.cdr=e;this.themeService=t;this.authApiService=r;this.currentTheme$=this.themeService.theme$}cafeId=null;place=null;currentUser=null;isMobile=!1;showAddReviewForm=!1;alwaysShowFormOnDesktop=!1;publicUserProfile;reviewAdded=new k;currentTheme$;ICONS=P;reviews=[];reviewLikesMap=new Map;userProfiles=new Map;userBadgeTypes=new Map;visibleCount=2;newReviewText="";newReviewRating=0;reviewToDeleteId=null;showDeleteModal=!1;userName="";userEmail="";badgeType=null;ngOnChanges(i){i.cafeId&&this.cafeId!==null&&(this.visibleCount=2,this.loadReviews(this.cafeId)),i.currentUser&&this.currentUser&&(this.userName=`${this.currentUser.firstName} ${this.currentUser.lastName}`,this.userEmail=this.currentUser.email),i.publicUserProfile&&this.publicUserProfile&&this.updateBadgeType()}loadReviews(i){this.reviewsService.getReviewsByCafeId(i).subscribe({next:e=>{this.reviews=e,this.loadLikesForReviews(e),this.loadProfilesForReviews()},error:()=>this.reviews=[]})}loadLikesForReviews(i){let e=i.map(t=>this.authApiService.getReviewLikesInfo(t.id));ue(e).subscribe({next:t=>{let r=new Map;i.forEach((m,x)=>r.set(m.id,t[x])),this.reviewLikesMap=r,this.cdr.detectChanges()},error:t=>console.warn("Failed to load likes info",t)})}loadProfilesForReviews(){this.reviews.forEach(i=>{let e=i.userId;this.userProfiles.has(e)||this.authApiService.getPublicUserProfile(e).subscribe({next:t=>{this.userProfiles.set(e,t),this.calculateAndSetBadge(e,t),this.cdr.detectChanges()},error:t=>console.warn(`Failed to load profile for user ${e}`,t)})})}calculateAndSetBadge(i,e){let t=pe(e),r=le(t,ce);this.userBadgeTypes.set(i,r)}updateBadgeType(){let i=pe(this.publicUserProfile);this.badgeType=le(i,ce)}updateLikesLocal(i,e){let t=this.reviewLikesMap.get(i);if(!t)return;let r=e?t.totalLikes+1:t.totalLikes-1;this.reviewLikesMap.set(i,{likedByCurrentUser:e,totalLikes:Math.max(0,r)}),this.cdr.detectChanges()}get canSubmitReview(){return this.newReviewRating>0}addReview(){if(!this.cafeId||this.newReviewRating===0)return;let i=this.newReviewText.trim(),e=se({cafeId:this.cafeId,rating:this.newReviewRating},i&&{text:i});this.reviewsService.addReview(e).subscribe({next:t=>{let r=de(se({},t),{userName:this.currentUser?.firstName??"Anonymous",userSurname:this.currentUser?.lastName??"",userPhotoUrl:this.currentUser?.photoUrl||""});this.reviews.unshift(r),this.newReviewText="",this.newReviewRating=0,this.visibleCount++,this.cdr.detectChanges(),this.reviewAdded.emit(),this.place&&(this.place.reviewCount=(this.place.reviewCount||0)+1),setTimeout(()=>{let m=document.querySelector("textarea");m&&(m.style.height="auto")})},error:t=>console.error("Failed to add review:",t)})}confirmDelete(i){this.reviewToDeleteId=i,this.showDeleteModal=!0}deleteConfirmed(){this.reviewToDeleteId!==null&&(this.deleteReview(this.reviewToDeleteId),this.cancelDelete())}deleteReview(i){this.reviewsService.deleteReview(i).subscribe({next:()=>{this.reviews=this.reviews.filter(e=>e.id!==i),this.visibleCount=Math.min(this.visibleCount,this.reviews.length),this.place&&(this.place.reviewCount=Math.max((this.place.reviewCount||1)-1,0)),this.cdr.detectChanges()},error:e=>console.error("Failed to delete review:",e)})}cancelDelete(){this.showDeleteModal=!1,this.reviewToDeleteId=null}showMore(){this.visibleCount<this.reviews.length&&(this.visibleCount+=2)}getLikesInfo(i){return this.reviewLikesMap.get(i)??{likedByCurrentUser:!1,totalLikes:0}}onToggleLike(i,e){(e?this.authApiService.likeReview(i.id):this.authApiService.unlikeReview(i.id)).subscribe({next:()=>this.updateLikesLocal(i.id,e),error:r=>console.error(`Server like action failed for reviewId=${i.id}`,r)})}static \u0275fac=function(e){return new(e||n)(v(Be),v(B),v(j),v(K))};static \u0275cmp=I({type:n,selectors:[["app-rating-reviews-section"]],inputs:{cafeId:"cafeId",place:"place",currentUser:"currentUser",isMobile:"isMobile",showAddReviewForm:"showAddReviewForm",alwaysShowFormOnDesktop:"alwaysShowFormOnDesktop",publicUserProfile:"publicUserProfile"},outputs:{reviewAdded:"reviewAdded"},features:[J],decls:30,vars:23,consts:[["noReviews",""],[1,"flex","flex-col","gap-[16px]"],[1,"flex","flex-col","gap-2"],[1,"body-font-1","flex","justify-between"],["class","underline","style","text-decoration-style: dotted; text-underline-offset: 4px;",3,"disabled","click",4,"ngIf"],[1,"flex","flex-col","gap-4"],[4,"ngIf","ngIfElse"],[3,"currentUser","currentTheme$","userName","userEmail","newReviewText","newReviewRating","canSubmitReview","alwaysShowFormOnDesktop","showAddReviewForm","reviewTextChange","reviewRatingChange","addReview",4,"ngIf"],[3,"close","isOpen"],[1,"mb-4","text-center"],[1,"menu-text-font","mb-4","text-center","text-[var(--color-gray-75)]"],[1,"flex","justify-center","gap-4"],[1,"button-font","button-bg-blue","px-6","py-2",3,"click"],[1,"button-font","button-bg-transparent","px-6","py-2",3,"click"],[1,"underline",2,"text-decoration-style","dotted","text-underline-offset","4px",3,"click","disabled"],[3,"review","badgeType","currentUserId","likesInfo","isLoggedIn","toggleLike","delete",4,"ngFor","ngForOf"],[3,"toggleLike","delete","review","badgeType","currentUserId","likesInfo","isLoggedIn"],[3,"reviewTextChange","reviewRatingChange","addReview","currentUser","currentTheme$","userName","userEmail","newReviewText","newReviewRating","canSubmitReview","alwaysShowFormOnDesktop","showAddReviewForm"],[1,"col-span-8","mb-11"]],template:function(e,t){if(e&1){let r=y();s(0,"section")(1,"div",1)(2,"div",2)(3,"h4"),d(4),c(5,"translate"),l(),s(6,"div",3)(7,"span"),d(8),c(9,"translate"),l(),_(10,Yt,3,4,"button",4),l()(),s(11,"div",5),_(12,ti,2,1,"ng-container",6),l(),_(13,ii,1,9,"app-add-review-form",7),l(),_(14,ni,3,3,"ng-template",null,0,W),s(16,"app-modal",8),g("close",function(){return f(r),h(t.cancelDelete())}),s(17,"h4",9),d(18),c(19,"translate"),l(),s(20,"p",10),d(21),c(22,"translate"),l(),s(23,"div",11)(24,"button",12),g("click",function(){return f(r),h(t.deleteConfirmed())}),d(25),c(26,"translate"),l(),s(27,"button",13),g("click",function(){return f(r),h(t.cancelDelete())}),d(28),c(29,"translate"),l()()()()}if(e&2){let r=z(15);o(4),b(p(5,11,"reviews.title")),o(4),b(p(9,13,"reviews.subtitle")),o(2),a("ngIf",t.reviews.length>2),o(2),a("ngIf",t.reviews.length>0)("ngIfElse",r),o(),a("ngIf",t.currentUser),o(3),a("isOpen",t.showDeleteModal),o(2),b(p(19,15,"reviews.deleteConfirmTitle")),o(3),C(" ",p(22,17,"reviews.deleteConfirmMessage")," "),o(4),C(" ",p(26,19,"reviews.deleteYes")," "),o(3),C(" ",p(29,21,"reviews.deleteCancel")," ")}},dependencies:[S,L,F,ke,ne,te,Ue,Ne,M,A],encapsulation:2})};var ri=(n,i)=>({"bg-[var(--color-bg-2)]":n,"bg-[var(--color-bg-card)]":i}),oi=n=>["/users",n],_t=()=>({"h-[44px] w-[50px]":!0,"lg:h-[58px] lg:w-[58px]":!0}),ai=()=>({"h-[44px] w-[44px]":!0,"lg:h-[50px] lg:w-[50px]":!0});function si(n,i){if(n&1&&w(0,"img",14),n&2){let e=i.ngIf;a("src",e,N)("ngClass",q(2,_t))}}function li(n,i){if(n&1&&(s(0,"div",7)(1,"div",8),c(2,"async"),c(3,"async"),s(4,"a",9),_(5,si,1,3,"img",10),c(6,"badgeImage"),w(7,"img",11),l(),s(8,"div",2)(9,"div",12),d(10),l(),s(11,"div",13),d(12),l()()()()),n&2){let e=i.$implicit,t=u(2);o(),a("ngClass",U(17,ri,p(2,11,t.currentTheme$)==="light",p(3,13,t.currentTheme$)==="dark")),o(3),a("routerLink",xe(20,oi,e.userId))("ngClass",q(22,_t))("title",e.userFirstName+" "+e.userLastName),o(),a("ngIf",p(6,15,e.badge)),o(2),a("src",e.userPhotoUrl,N)("alt",e.userFirstName+" "+e.userLastName)("ngClass",q(23,ai)),o(3),Y(" ",e.userFirstName," ",e.userLastName," "),o(2),C(" ",t.formatCheckInDate(e.timestamp)," ")}}function ci(n,i){if(n&1&&(T(0),s(1,"div",5),_(2,li,13,24,"div",6),l(),R()),n&2){let e=u();o(2),a("ngForOf",e.checkIns)}}function pi(n,i){n&1&&(s(0,"div",15),d(1),c(2,"translate"),l()),n&2&&(o(),C(" ",p(2,1,"checkIns.noRecent")," "))}var Ve=class n{constructor(i,e,t,r,m,x){this.checkInsService=i;this.authApiService=e;this.languageService=t;this.translate=r;this.cdr=m;this.themeService=x;this.currentTheme$=this.themeService.theme$}cafeId;checkIns=[];currentTheme$;subscription=new Xe;ngOnInit(){if(!this.cafeId)return;this.loadCheckIns();let i=this.checkInsService.checkInsUpdated$.subscribe(()=>{this.loadCheckIns()});this.subscription.add(i)}ngOnDestroy(){this.subscription.unsubscribe()}loadCheckIns(){this.checkInsService.getCheckInsByCafe(this.cafeId).subscribe({next:i=>{let t=i.sort((x,O)=>new Date(O.timestamp).getTime()-new Date(x.timestamp).getTime()).slice(0,4),m=Array.from(new Set(t.map(x=>x.userId))).map(x=>this.authApiService.getPublicUserProfile(x));ue(m).subscribe({next:x=>{let O=this.getAllAchievements(),X=new Map;x.forEach(D=>{let G=pe(D);X.set(D.id,G)}),this.checkIns=t.map(D=>{let G=X.get(D.userId)||[],ae=le(G,O);return de(se({},D),{badge:ae})}),this.cdr.detectChanges()},error:x=>console.error("Failed to load user profiles",x)})},error:i=>console.error("Failed to load check-ins",i)})}getAllAchievements(){return ce}formatCheckInDate(i){let e=this.parseDateInTimeZone(i,"Europe/Kiev"),t=new Date,r=this.languageService.currentLang==="uk"?"uk-UA":"en-US",m=t.toLocaleDateString(r,{timeZone:"Europe/Kiev"}),x=new Date(t);x.setDate(t.getDate()-1);let O=x.toLocaleDateString(r,{timeZone:"Europe/Kiev"}),X=e.toLocaleDateString(r,{timeZone:"Europe/Kiev"}),D={hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Europe/Kiev"},G={month:"long",day:"numeric",timeZone:"Europe/Kiev"},ae=this.translate.instant("date.today"),E=this.translate.instant("date.yesterday"),We=this.translate.instant("date.at");return X===m?`${ae} ${We} ${e.toLocaleTimeString(r,D)}`:X===O?`${E} ${We} ${e.toLocaleTimeString(r,D)}`:`${e.toLocaleDateString(r,G)}, ${e.toLocaleTimeString(r,D)}`}parseDateInTimeZone(i,e){let t=new Date(i),m=new Intl.DateTimeFormat("en-US",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(t),x=Number(m.find(E=>E.type==="year")?.value),O=Number(m.find(E=>E.type==="month")?.value)-1,X=Number(m.find(E=>E.type==="day")?.value),D=Number(m.find(E=>E.type==="hour")?.value),G=Number(m.find(E=>E.type==="minute")?.value),ae=Number(m.find(E=>E.type==="second")?.value);return new Date(Date.UTC(x,O,X,D,G,ae))}static \u0275fac=function(e){return new(e||n)(v(Ae),v(K),v(ct),v(ie),v(B),v(j))};static \u0275cmp=I({type:n,selectors:[["app-last-check-ins"]],inputs:{cafeId:"cafeId"},decls:11,vars:8,consts:[["noCheckins",""],[1,"flex","flex-col","gap-4"],[1,"flex","flex-col","gap-2"],[1,"body-font-1"],[4,"ngIf","ngIfElse"],[1,"flex","flex-col","gap-2","lg:flex-row","lg:gap-5"],["class","flex-grow",4,"ngFor","ngForOf"],[1,"flex-grow"],[1,"flex","gap-4","rounded-[24px]","p-2",3,"ngClass"],[1,"relative","inline-block","bg-transparent",3,"routerLink","ngClass","title"],["alt","badge","class","absolute left-0 top-0 rounded-full bg-transparent","style","object-fit: cover; pointer-events: none;",3,"src","ngClass",4,"ngIf"],[1,"absolute","left-1/2","top-1/2","rounded-full",2,"object-fit","cover","transform","translate(-50%, -50%)",3,"src","alt","ngClass"],[1,"menu-text-font"],[1,"body-font-2"],["alt","badge",1,"absolute","left-0","top-0","rounded-full","bg-transparent",2,"object-fit","cover","pointer-events","none",3,"src","ngClass"],[1,"text-[var(--color-gray-75)]"]],template:function(e,t){if(e&1&&(s(0,"div",1)(1,"div",2)(2,"h4"),d(3),c(4,"translate"),l(),s(5,"span",3),d(6),c(7,"translate"),l()(),_(8,ci,3,1,"ng-container",4)(9,pi,3,3,"ng-template",null,0,W),l()),e&2){let r=z(10);o(3),b(p(4,4,"checkIns.title")),o(3),C(" ",p(7,6,"checkIns.subtitle")," "),o(2),a("ngIf",t.checkIns.length>0)("ngIfElse",r)}},dependencies:[S,V,L,F,te,ye,M,be,Re,A],encapsulation:2})};function mi(n,i){if(n&1&&w(0,"app-last-check-ins",17),n&2){let e=u(2);a("cafeId",e.place.id)}}function di(n,i){if(n&1){let e=y();s(0,"div",8)(1,"div",9),w(2,"app-breadcrumbs",10),s(3,"app-carousel-section",11),g("onToggleFavorite",function(){f(e);let r=u();return h(r.onToggleFavorite())})("onShare",function(){f(e);let r=u();return h(r.openShareModal())}),l(),w(4,"app-main-info-section",12),l(),s(5,"app-rating-reviews-section",13),g("closeAddReviewForm",function(){f(e);let r=u();return h(r.showAddReviewForm=!1)}),l(),_(6,mi,1,1,"app-last-check-ins",14),s(7,"app-slider-places",15),c(8,"translate"),g("unauthorizedFavoriteClick",function(){f(e);let r=u();return h(r.showLoginModal=!0)}),l(),s(9,"app-actions-sector",16),g("leaveReviewClick",function(){f(e);let r=u();return h(r.handleLeaveReviewClick())})("onToggleFavorite",function(){f(e);let r=u();return h(r.onToggleFavorite())})("onShare",function(){f(e);let r=u();return h(r.openShareModal())}),l()()}if(n&2){let e=u();o(2),a("lastLabel",e.place.name),o(),a("place",e.place)("photoUrls",e.place.photoUrls)("isFavorite",e.isFavorite),o(),a("place",e.place),o(),a("cafeId",e.place.id)("place",e.place)("currentUser",e.currentUser)("isMobile",e.isMobile)("showAddReviewForm",e.showAddReviewForm)("alwaysShowFormOnDesktop",!e.isMobile),o(),a("ngIf",e.place),o(),a("title",p(8,18,"places.moreCafes"))("places",e.randomPlaces),o(2),a("isFavorite",e.isFavorite)("isMobile",e.isMobile)("showAddReviewForm",e.showAddReviewForm)("isLoggedIn",e.isLoggedIn)}}var wt=class n{constructor(i,e,t,r,m,x,O,X,D){this.route=i;this.router=e;this.placesService=t;this.favoritesService=r;this.authService=m;this.loaderService=x;this.cdr=O;this.favoriteToggleService=X;this.translate=D}place=null;isMobile=!1;showAddReviewForm=!1;showLoginModal=!1;showShareModal=!1;copied=!1;scrollToReviewForm=!1;reviewsSectionRef;randomPlaces=[];isFavorite=!1;ngOnInit(){this.updateScreenMode(),this.route.paramMap.subscribe(i=>{let e=i.get("id");if(!e){this.router.navigate(["/not-found"]);return}let t=localStorage.getItem("lang")||"en";this.loadPlaceData(t,e)}),this.translate.onLangChange.subscribe(i=>{let e=this.route.snapshot.paramMap.get("id");e&&this.loadPlaceData(i.lang,e)})}loadPlaceData(i,e){this.loaderService.show();let t=Number(e);if(isNaN(t)){this.router.navigate(["/not-found"]),this.loaderService.hide();return}this.placesService.getPlaces(i).subscribe({next:r=>{if(this.place=r.find(m=>m.id===t)||null,!this.place){this.router.navigate(["/not-found"]),this.loaderService.hide();return}this.isFavorite=this.favoriteToggleService.isFavorite(this.place.id),this.cdr.detectChanges(),this.randomPlaces=this.shuffleArray(r.filter(m=>m.id!==this.place.id)).slice(0,8),this.loaderService.hide()},error:()=>{this.router.navigate(["/not-found"]),this.loaderService.hide()}})}ngAfterViewChecked(){this.scrollToReviewForm&&this.reviewsSectionRef&&(this.scrollToReviewForm=!1,this.reviewsSectionRef.nativeElement.scrollIntoView({behavior:"smooth",block:"start"}))}shuffleArray(i){let e=[...i];for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}onResize(){this.updateScreenMode()}updateScreenMode(){this.isMobile=window.innerWidth<1024,this.cdr.detectChanges()}handleLeaveReviewClick(){if(!this.currentUser){this.showLoginModal=!0;return}this.showAddReviewForm=!0,this.isMobile&&(this.scrollToReviewForm=!0)}onToggleFavorite(){event?.preventDefault(),event?.stopPropagation(),this.place&&this.favoriteToggleService.toggleFavorite(this.place).subscribe({next:()=>{this.isFavorite=this.favoriteToggleService.isFavorite(this.place.id),this.cdr.detectChanges()},error:i=>{i.message==="NOT_AUTHENTICATED"?this.showLoginModal=!0:alert("An error occurred while updating favorites.")}})}navigateToAuth(){localStorage.setItem("returnUrl",this.router.url),this.showLoginModal=!1,this.router.navigate(["/auth"])}openShareModal(){if(!this.isLoggedIn){this.showLoginModal=!0;return}this.showShareModal=!0,this.copied=!1}handleShare(){this.place?.id&&navigator.clipboard.writeText(this.currentShareLink).then(()=>{this.copied=!0,setTimeout(()=>{this.copied=!1},3e3)}).catch(i=>{console.error("Failed to copy URL: ",i)})}get currentUser(){return this.authService.getCurrentUser()}get isLoggedIn(){return!!this.currentUser}get currentShareLink(){return`${window.location.origin}/home-pro/catalog/${this.place?.id}`}static \u0275fac=function(e){return new(e||n)(v(it),v(ee),v(lt),v(ut),v(mt),v(dt),v(B),v(vt),v(ie))};static \u0275cmp=I({type:n,selectors:[["app-place-details-page"]],viewQuery:function(e,t){if(e&1&&Ze(me,5,fe),e&2){let r;Ge(r=Qe())&&(t.reviewsSectionRef=r.first)}},hostBindings:function(e,t){e&1&&g("resize",function(){return t.onResize()},he)},decls:20,vars:18,consts:[["class","flex max-w-[1320px] flex-col gap-20 px-5 lg:px-10 xxl:mx-auto xxl:px-0",4,"ngIf"],[3,"close","isOpen"],[1,"mb-4","text-center"],[1,"flex","justify-center","gap-4"],[1,"button-font","button-bg-blue","px-6","py-2",3,"click"],[1,"button-font","button-bg-transparent","px-6","py-2",3,"click"],["readonly","",1,"mb-4","w-full","truncate","rounded-lg","border","p-3",3,"value"],[1,"button-bg-blue","h-12","w-full",3,"click"],[1,"flex","max-w-[1320px]","flex-col","gap-20","px-5","lg:px-10","xxl:mx-auto","xxl:px-0"],[1,"xxl:grid","xxl:grid-cols-8","xxl:gap-5"],[1,"mb-[24px]","xxl:col-span-8",3,"lastLabel"],[1,"xxl:col-span-4",3,"onToggleFavorite","onShare","place","photoUrls","isFavorite"],[1,"mt-4","lg:mt-0","xxl:col-span-4",3,"place"],[3,"closeAddReviewForm","cafeId","place","currentUser","isMobile","showAddReviewForm","alwaysShowFormOnDesktop"],[3,"cafeId",4,"ngIf"],[3,"unauthorizedFavoriteClick","title","places"],[3,"leaveReviewClick","onToggleFavorite","onShare","isFavorite","isMobile","showAddReviewForm","isLoggedIn"],[3,"cafeId"]],template:function(e,t){e&1&&(_(0,di,10,20,"div",0),s(1,"app-modal",1),g("close",function(){return t.showLoginModal=!1}),s(2,"h4",2),d(3),c(4,"translate"),l(),s(5,"div",3)(6,"button",4),g("click",function(){return t.navigateToAuth()}),d(7),c(8,"translate"),l(),s(9,"button",5),g("click",function(){return t.showLoginModal=!1}),d(10),c(11,"translate"),l()()(),s(12,"app-modal",1),g("close",function(){return t.showShareModal=!1}),s(13,"h4",2),d(14,"Share this caf\xE9"),l(),w(15,"input",6),s(16,"button",7),g("click",function(){return t.handleShare()}),d(17),c(18,"translate"),c(19,"translate"),l()()),e&2&&(a("ngIf",t.place),o(),a("isOpen",t.showLoginModal),o(2),b(p(4,8,"modals.loginTitle")),o(4),C(" ",p(8,10,"modals.loginBtn")," "),o(3),C(" ",p(11,12,"modals.closeBtn")," "),o(2),a("isOpen",t.showShareModal),o(3),a("value",t.currentShareLink),o(2),C(" ",t.copied?p(18,14,"modals.copied"):p(19,16,"modals.copyLink")," "))},dependencies:[S,F,Ee,Le,Pe,ne,ft,me,gt,M,Ve,A],encapsulation:2})};export{wt as PlaceDetailsPageComponent};
