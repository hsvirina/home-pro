import{$ as n,$a as he,A as Y,Aa as ce,Ab as _e,B as J,Bb as ke,Cb as Fe,Db as T,Ea as L,F as X,Fa as E,Ia as pe,J as D,Ja as a,Ka as s,M as o,Ma as le,P as v,Pa as de,R as ee,Sa as ue,Ta as me,Ua as ve,W as w,X as M,Y as te,Ya as fe,a as Z,aa as p,ba as l,ca as y,cb as ge,eb as P,f as q,g as W,ga as R,ha as z,i as Q,ia as ie,j as x,ja as I,k as G,ka as g,na as re,nb as Ce,oa as oe,pa as ne,qa as ae,r as U,ra as K,rb as be,t as C,ta as f,ua as se,ub as Se,va as b,vb as ye,w as h,wb as Ie,xb as Te,yb as k,z as d}from"./chunk-2Z55U5GN.js";var V=(t=>(t.Full="full",t.Favourites="favourites",t.Catalog="catalog",t))(V||{});var A=class r{constructor(e,i){this.http=e;this.authService=i}baseUrl=k.user.favorites;getAuthHeaders(){let e=this.authService.getToken();return e?Q(new ge({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})):x(()=>new Error("Authorization token is missing"))}addFavorite(e){return this.getAuthHeaders().pipe(U(i=>this.http.post(this.baseUrl,{cafeId:e},{headers:i})))}removeFavorite(e){return this.getAuthHeaders().pipe(U(i=>this.http.request("delete",this.baseUrl,{headers:i,body:{cafeId:e}})))}static \u0275fac=function(i){return new(i||r)(d(P),d(T))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var N=class r{constructor(e,i){this.favoritesService=e;this.authService=i;this.loadFavorites()}favoritesSubject=new W([]);favorites$=this.favoritesSubject.asObservable();loadFavorites(){let e=this.authService.getCurrentUser();e?.favoriteCafeIds?this.favoritesSubject.next(e.favoriteCafeIds):this.favoritesSubject.next([])}addFavorite(e){return this.favoritesService.addFavorite(e).pipe(C(()=>{let i=this.favoritesSubject.value;i.includes(e)||this.favoritesSubject.next([...i,e])}))}removeFavorite(e){return this.favoritesService.removeFavorite(e).pipe(C(()=>{let i=this.favoritesSubject.value.filter(t=>t!==e);this.favoritesSubject.next(i)}))}isFavorite(e){return this.favoritesSubject.value.includes(e)}static \u0275fac=function(i){return new(i||r)(d(A),d(T))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var O=class r{constructor(e,i){this.authService=e;this.favoritesStore=i}isFavorite(e){return this.favoritesStore.isFavorite(e)}toggleFavorite(e){if(!this.authService.getCurrentUser())return x(()=>new Error("NOT_AUTHENTICATED"));let t=e.id,c=this.favoritesStore.isFavorite(t);return(c?this.favoritesStore.removeFavorite(t):this.favoritesStore.addFavorite(t)).pipe(C(()=>{let m=this.authService.getCurrentUser();m&&(m.favoriteCafeIds=c?m.favoriteCafeIds.filter(S=>S!==t):[...m.favoriteCafeIds,t],this.authService.updateCurrentUser(Z({},m)))}),G(()=>!c))}static \u0275fac=function(i){return new(i||r)(d(T),d(N))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var H=class r{constructor(e){this.http=e}checkInsUpdatedSource=new q;checkInsUpdated$=this.checkInsUpdatedSource.asObservable();checkInToCafe(e){return this.http.post(`${k.checkins.base}/${e}`,null).pipe(C(()=>this.checkInsUpdatedSource.next()))}getCheckInsByCafe(e){return this.http.get(`${k.checkins.base}/cafe/${e}`)}static \u0275fac=function(i){return new(i||r)(d(P))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var He=["tagsContainer"],$e=(r,e,i,t,c)=>({"h-[570px]":r,"h-[334px]":e,"h-[510px]":i,"bg-[var(--color-white)] hover:bg-[var(--color-gray-10)]":t,"bg-[var(--color-bg-card)] hover:bg-[var(--color-gray-100)]":c}),we=(r,e)=>({"bg-[#FFFFFF]/60":r,"bg-[#0D0D0D]/60":e}),Be=(r,e)=>({"text-[var(--color-gray-75)]":r,"text-[var(--color-white)]":e}),Ue=r=>({"text-[var(--color-gray-10)]":r}),De=r=>({"text-[var(--color-white)]":r});function Me(r,e){if(r&1&&(p(0,"p",18),f(1),l()),r&2){let i=g();o(),b(" ",i.place.shortDescription," ")}}function Re(r,e){if(r&1&&(p(0,"span",22),a(1,"async"),f(2),l()),r&2){let i=e.$implicit,t=g(2);K("background-color",s(1,3,t.currentTheme$)==="dark"?t.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)"),o(2),b(" ",i.name," ")}}function ze(r,e){if(r&1&&(p(0,"span",22),a(1,"async"),f(2," ... "),l()),r&2){let i=g(2);K("background-color",s(1,2,i.currentTheme$)==="dark"?i.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)")}}function Ke(r,e){if(r&1&&(p(0,"div",19,0),R(2),w(3,Re,3,5,"span",20)(4,ze,3,4,"span",21),z(),l()),r&2){let i=g();o(3),n("ngForOf",i.displayTags),o(),n("ngIf",i.showEllipsis)}}function Le(r,e){if(r&1&&(R(0),y(1,"app-icon",8),f(2),a(3,"translate"),a(4,"translate"),z()),r&2){let i=g(2);o(),n("icon",i.isCheckedIn?i.ICONS.CheckCircle:i.ICONS.AddCircle),o(),b(" ",i.isCheckedIn?s(3,2,"CHECK_IN.CHECKED_IN"):s(4,4,"CHECK_IN.CHECK_IN")," ")}}function Ve(r,e){r&1&&(f(0),a(1,"translate")),r&2&&b(" ",s(1,1,"button.learn_more")," ")}function Ze(r,e){if(r&1){let i=ie();p(0,"button",23),a(1,"translate"),a(2,"translate"),I("click",function(c){Y(i);let u=g();return J(u.onCheckInClick(c))}),w(3,Le,5,6,"ng-container",24)(4,Ve,2,3,"ng-template",null,1,le),l()}if(r&2){let i=ae(5),t=g();n("disabled",t.isCheckedIn)("title",t.isCheckedIn?s(1,4,"CHECK_IN.ALREADY_CHECKED_IN"):s(2,6,"CHECK_IN.CHECK_IN")),o(3),n("ngIf",t.isAuthenticated)("ngIfElse",i)}}var Ee=class r{constructor(e,i,t,c,u,m,S,$){this.cdr=e;this.ngZone=i;this.router=t;this.favoriteToggleService=c;this.themeService=u;this.storageService=m;this.checkInsService=S;this.userService=$;this.currentTheme$=this.themeService.theme$}place;cardType="full";unauthorizedFavoriteClick=new M;favoriteToggled=new M;tagsContainer;displayTags=[];showEllipsis=!1;isHovered=!1;isCheckedIn=!1;ICONS=Ie;PlaceCardType=V;currentTheme$;ngOnChanges(){this.place?.tags&&(this.displayTags=[...this.place.tags]),this.updateCheckInStatus()}ngAfterViewInit(){this.cardType==="full"&&(this.displayTags=[...this.place.tags],this.updateCheckInStatus(),this.ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this.displayTags=[...this.place.tags],this.cdr.detectChanges(),setTimeout(()=>{let e=this.tagsContainer.nativeElement,i=e.clientWidth,t=getComputedStyle(e),c=parseFloat(t.gap)||0,u=2,m=Array.from(e.querySelectorAll("span")),S=0,$=1,_=[];for(let F=0;F<m.length;F++){let B=m[F].offsetWidth;if(S+B<=i)S+=B+c;else{if($++,$>u)break;S=B+c}_.push(this.displayTags[F])}_.length<this.displayTags.length&&_.length>0&&(_.pop(),this.showEllipsis=!0),this.ngZone.run(()=>{this.displayTags=_,this.cdr.detectChanges()})},0)})}))}get isFavorite(){return this.favoriteToggleService.isFavorite(this.place.id)}get isAuthenticated(){return!!this.storageService.getUser()}onCardClick(){this.router.navigate(["/catalog",this.place.id])}onToggleFavorite(e){e.preventDefault(),e.stopPropagation(),this.favoriteToggleService.toggleFavorite(this.place).subscribe({next:i=>{this.cdr.detectChanges(),this.favoriteToggled.emit({placeId:this.place.id,isFavorite:i})},error:i=>{i.message==="NOT_AUTHENTICATED"?this.unauthorizedFavoriteClick.emit():alert("An error occurred while updating favorites.")}})}getGoogleMapsLink(e){return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`}updateCheckInStatus(){if(!this.place)return;let e=this.storageService.getPublicUserProfile();e&&e.checkInCafes?this.isCheckedIn=e.checkInCafes.some(i=>i.id===this.place.id):this.isCheckedIn=!1,this.cdr.detectChanges()}onCheckInClick(e){this.isAuthenticated&&(e.preventDefault(),e.stopPropagation(),!this.isCheckedIn&&this.performCheckIn())}performCheckIn(){this.checkInsService.checkInToCafe(this.place.id).subscribe({next:()=>{this.userService.getPublicUserProfile(this.storageService.getUser()?.userId||0).subscribe({next:e=>{this.storageService.setPublicUserProfile(e),this.isCheckedIn=!0,this.cdr.detectChanges(),this.router.navigate(["/catalog",this.place.id])},error:e=>{console.error("Error updating public profile:",e)}})},error:e=>{console.error("Error during check-in:",e)}})}static \u0275fac=function(i){return new(i||r)(v(de),v(te),v(Ce),v(O),v(be),v(Fe),v(H),v(ke))};static \u0275cmp=ee({type:r,selectors:[["app-place-card"]],viewQuery:function(i,t){if(i&1&&re(He,5),i&2){let c;oe(c=ne())&&(t.tagsContainer=c.first)}},inputs:{place:"place",cardType:"cardType"},outputs:{unauthorizedFavoriteClick:"unauthorizedFavoriteClick",favoriteToggled:"favoriteToggled"},features:[X],decls:33,vars:62,consts:[["tagsContainer",""],["learnMore",""],[1,"box-border","w-full","cursor-pointer","overflow-hidden","rounded-[40px]","transition-colors","duration-300",3,"mouseenter","mouseleave","ngClass"],[1,"block","w-full","no-underline",3,"click"],[1,"relative"],["alt","Place Image",1,"h-[222px]","w-full","rounded-t-[40px]","object-cover",3,"src"],[1,"absolute","left-[12px]","top-[12px]","z-10","flex","items-center","justify-center","gap-1","rounded-[40px]","px-2","py-[4px]","backdrop-blur",3,"ngClass"],[1,"body-font-1",3,"ngClass"],[3,"icon"],[1,"absolute","right-[12px]","top-[12px]","z-10","flex","h-[32px]","w-[32px]","items-center","justify-center","rounded-[40px]","p-[4px]","backdrop-blur",3,"click","ngClass","title"],[1,"flex","flex-col","gap-[12px]","p-[12px]",3,"ngClass"],[1,"flex","h-[52px]","items-start","justify-between"],[3,"ngClass"],["target","_blank","rel","noopener noreferrer",1,"group","flex","items-center","gap-2",3,"click","href"],[1,"body-font-1","relative","underline"],["class","body-font-1 line-clamp-3 h-[72px] overflow-hidden",4,"ngIf"],["class","flex h-[80px] flex-wrap gap-2 overflow-hidden",4,"ngIf"],["class","button-bg-transparent gap-2 py-3",3,"disabled","title","click",4,"ngIf"],[1,"body-font-1","line-clamp-3","h-[72px]","overflow-hidden"],[1,"flex","h-[80px]","flex-wrap","gap-2","overflow-hidden"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngFor","ngForOf"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngIf"],[1,"body-font-2","whitespace-nowrap","rounded-[40px]","px-[12px]","py-[8px]",2,"transition","background-color 0.3s ease"],[1,"button-bg-transparent","gap-2","py-3",3,"click","disabled","title"],[4,"ngIf","ngIfElse"]],template:function(i,t){i&1&&(p(0,"div",2),a(1,"async"),a(2,"async"),I("mouseenter",function(){return t.isHovered=!0})("mouseleave",function(){return t.isHovered=!1}),p(3,"div",3),I("click",function(){return t.onCardClick()}),p(4,"div",4),y(5,"img",5),p(6,"div",6),a(7,"async"),a(8,"async"),p(9,"span",7),a(10,"async"),a(11,"async"),f(12),l(),y(13,"app-icon",8),l(),p(14,"button",9),a(15,"translate"),a(16,"async"),a(17,"async"),I("click",function(u){return t.onToggleFavorite(u)}),y(18,"app-icon",8),a(19,"themedIcon"),l()(),p(20,"div",10),a(21,"async"),p(22,"div",11)(23,"h5",12),a(24,"async"),f(25),l()(),p(26,"a",13),I("click",function(u){return u.stopPropagation()}),y(27,"app-icon",8),p(28,"span",14),f(29),l()(),w(30,Me,2,1,"p",15)(31,Ke,5,2,"div",16)(32,Ze,6,8,"button",17),l()()()),i&2&&(n("ngClass",pe(43,$e,t.cardType===t.PlaceCardType.Full,t.cardType===t.PlaceCardType.Favourites,t.cardType===t.PlaceCardType.Catalog,s(1,19,t.currentTheme$)==="light",s(2,21,t.currentTheme$)==="dark")),o(5),n("src",t.place.photoUrls[0],D),o(),n("ngClass",E(49,we,s(7,23,t.currentTheme$)==="light",s(8,25,t.currentTheme$)==="dark")),o(3),n("ngClass",E(52,Be,s(10,27,t.currentTheme$)==="light",s(11,29,t.currentTheme$)==="dark")),o(3),b(" ",t.place.rating," "),o(),n("icon",t.ICONS.Star),o(),n("title",ce(s(15,31,"BUTTON.ADD_TO_FAVORITES")))("ngClass",E(55,we,s(16,33,t.currentTheme$)==="light",s(17,35,t.currentTheme$)==="dark")),o(4),n("icon",s(19,37,t.isFavorite?"HeartBlueFill":"HeartBlue")),o(2),n("ngClass",L(58,Ue,s(21,39,t.currentTheme$)==="dark")),o(3),n("ngClass",L(60,De,s(24,41,t.currentTheme$)==="dark")),o(2),b(" ",t.place.name," "),o(),n("href",t.getGoogleMapsLink(t.place.address),D),o(),n("icon",t.ICONS.Location),o(2),se(t.place.address),o(),n("ngIf",t.cardType===t.PlaceCardType.Full||t.cardType===t.PlaceCardType.Catalog),o(),n("ngIf",t.cardType===t.PlaceCardType.Full||t.cardType===t.PlaceCardType.Catalog),o(),n("ngIf",t.cardType===t.PlaceCardType.Full))},dependencies:[he,ue,me,ve,Te,ye,fe,_e,Se],encapsulation:2})};export{V as a,A as b,O as c,H as d,Ee as e};
