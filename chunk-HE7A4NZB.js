import{a as we,b as Te}from"./chunk-R2JEHSE4.js";import{a as Ie}from"./chunk-IGQXHS2B.js";import{a as U}from"./chunk-GCYQK47Q.js";import{l as ve,m as be}from"./chunk-VDMQKWZ2.js";import{a as Fe}from"./chunk-M2CEMBH3.js";import{a as Se,e as ke}from"./chunk-AFDVTN5P.js";import"./chunk-NJHPLZ7J.js";import{a as _e,c as Ce,f as he,j as K}from"./chunk-WFJC462D.js";import{$ as le,Aa as D,Ba as $,Bb as Pe,C as h,Ca as A,D as v,E as ne,Ia as de,L as oe,La as g,Ma as d,P as n,S as _,U as P,Ua as me,Va as w,Wa as S,Z as C,_ as T,_a as R,a as ie,ba as se,bb as k,ca as p,da as o,ea as l,f as ae,fa as F,ja as E,ka as V,la as b,ma as m,na as c,nb as fe,pb as ue,qa as pe,ra as ce,sa as ge,u as B,ub as Q,va as j,vb as z,wa as f,wb as L,xa as I,xb as W,y as re,ya as u,yb as ye,zb as xe}from"./chunk-YV6EM6KD.js";var Me=(a,t)=>({"border border-[var(--color-white)] bg-[var(--color-white)] text-[var(--color-gray-100)]":a,"border border-[var(--color-bg)] bg-[var(--color-bg-card)] text-[var(--color-gray-10)]":t});function je(a,t){if(a&1){let e=b();o(0,"label",10)(1,"input",11),A("ngModelChange",function(r){let s=h(e).$implicit,M=c(2).$implicit,y=c();return $(y.internalFilters[M.key][s.key],r)||(y.internalFilters[M.key][s.key]=r),v(r)}),l(),F(2,"span",12),f(3),l()}if(a&2){let e=t.$implicit,i=c(2).$implicit,r=c();n(),D("ngModel",r.internalFilters[i.key][e.key]),n(2),u(" ",e.label," ")}}function Ne(a,t){if(a&1&&(o(0,"div",6)(1,"h5"),f(2),g(3,"translate"),l(),o(4,"div",7),C(5,je,4,2,"label",8),l(),F(6,"div",9),l()),a&2){let e=c().$implicit;n(2),I(d(3,2,e.title)),n(3),p("ngForOf",e.options)}}function Be(a,t){if(a&1&&(E(0),C(1,Ne,7,4,"div",5),V()),a&2){let e=t.$implicit,i=c();n(),p("ngIf",i.internalFilters[e.key])}}var Z=class a{constructor(t){this.themeService=t;this.currentTheme$=this.themeService.theme$}filtersChange=new T;applyFiltersClicked=new T;_filterCategories=[];_filters={};set filterCategories(t){this._filterCategories=t,this.internalFilters=this.initializeFilters(this._filters)}get filterCategories(){return this._filterCategories}set filters(t){this._filters=t,this.internalFilters=this.initializeFilters(t)}get filters(){return this._filters}internalFilters={};currentTheme$;onApplyClick(){this.filtersChange.emit(this.deepClone(this.internalFilters)),this.applyFiltersClicked.emit()}clearAll(){for(let t in this.internalFilters)for(let e in this.internalFilters[t])this.internalFilters[t][e]=!1;this.filtersChange.emit(this.deepClone(this.internalFilters)),this.applyFiltersClicked.emit()}initializeFilters(t){let e={};for(let i of this._filterCategories){e[i.key]={};for(let r of i.options)e[i.key][r.key]=t?.[i.key]?.[r.key]??!1}return e}deepClone(t){return JSON.parse(JSON.stringify(t))}static \u0275fac=function(e){return new(e||a)(_(W))};static \u0275cmp=P({type:a,selectors:[["app-catalog-filters"]],inputs:{filterCategories:"filterCategories",filters:"filters"},outputs:{filtersChange:"filtersChange",applyFiltersClicked:"applyFiltersClicked"},decls:15,vars:21,consts:[[1,"flex","flex-col","gap-6","rounded-[24px]","p-6","xxl:w-full",3,"ngClass"],[1,"flex","items-center","justify-between"],["type","button",3,"click"],[4,"ngFor","ngForOf"],["type","button",1,"button-font","button-bg-blue","h-12","px-6","py-3",3,"click"],["class","flex flex-col gap-3",4,"ngIf"],[1,"flex","flex-col","gap-3"],[1,"flex","flex-col","gap-2"],["class","body-font-1 flex cursor-pointer select-none items-center gap-3",4,"ngFor","ngForOf"],[1,"my-2","h-px","bg-[var(--color-gray-20)]"],[1,"body-font-1","flex","cursor-pointer","select-none","items-center","gap-3"],["type","checkbox",1,"peer","sr-only",3,"ngModelChange","ngModel"],[1,"relative","flex","h-8","w-8","items-center","justify-center","rounded-lg","border","border-[var(--color-gray-20)]","before:absolute","before:left-1/2","before:top-1/2","before:h-4","before:w-2","before:-translate-x-1/2","before:-translate-y-[60%]","before:rotate-45","before:border-b-2","before:border-r-2","before:border-[var(--color-primary)]","before:opacity-0","before:transition-opacity","peer-checked:border-[var(--color-primary)]","peer-checked:before:opacity-100"]],template:function(e,i){e&1&&(o(0,"div",0),g(1,"async"),g(2,"async"),o(3,"div",1)(4,"h5"),f(5),g(6,"translate"),l(),o(7,"button",2),g(8,"translate"),m("click",function(){return i.clearAll()}),f(9),g(10,"translate"),l()(),C(11,Be,2,1,"ng-container",3),o(12,"button",4),m("click",function(){return i.onApplyClick()}),f(13),g(14,"translate"),l()()),e&2&&(p("ngClass",de(18,Me,d(1,6,i.currentTheme$)==="light",d(2,8,i.currentTheme$)==="dark")),n(5),I(d(6,10,"catalog_page.filters.header")),n(2),se("aria-label",d(8,12,"catalog_page.filters.clear_all_aria")),n(2),u(" ",d(10,14,"catalog_page.filters.clear_all")," "),n(2),p("ngForOf",i.filterCategories),n(2),u(" ",d(14,16,"catalog_page.filters.apply")," "))},dependencies:[k,me,w,S,K,_e,Ce,he,L,R,z],encapsulation:2})};function De(a,t){if(a&1){let e=b();o(0,"button",3),m("click",function(){let r=h(e).$implicit,s=c(2);return v(s.onPageChange(r))}),f(1),l()}if(a&2){let e=t.$implicit,i=c(2);j("bg-blue-600",e===i.currentPage)("text-white",e===i.currentPage)("bg-gray-200",e!==i.currentPage)("text-gray-700",e!==i.currentPage),p("disabled",e===i.currentPage),n(),u(" ",e," ")}}function $e(a,t){if(a&1&&(E(0),o(1,"div",1),C(2,De,2,10,"button",2),l(),V()),a&2){let e=c();n(2),p("ngForOf",e.totalPagesArray)}}var H=class a{totalItems=0;selectedSize=6;currentPage=1;pageChange=new T;get totalPages(){return this.selectedSize===-1?1:Math.ceil(this.totalItems/this.selectedSize)}get totalPagesArray(){return Array.from({length:this.totalPages},(t,e)=>e+1)}onPageChange(t){this.pageChange.emit(t)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-pagination"]],inputs:{totalItems:"totalItems",selectedSize:"selectedSize",currentPage:"currentPage"},outputs:{pageChange:"pageChange"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"flex","w-full","justify-center","gap-2"],["class","button-bg-blue flex h-10 w-10",3,"disabled","bg-blue-600","text-white","bg-gray-200","text-gray-700","click",4,"ngFor","ngForOf"],[1,"button-bg-blue","flex","h-10","w-10",3,"click","disabled"]],template:function(e,i){e&1&&C(0,$e,3,1,"ng-container",0),e&2&&p("ngIf",i.selectedSize!==-1)},dependencies:[k,w,S],encapsulation:2})};function Ae(a,t){if(a&1){let e=b();o(0,"div",7),m("click",function(){let r=h(e).$implicit,s=c(2);return v(s.selectOption(r.value))}),f(1),g(2,"translate"),l()}if(a&2){let e=t.$implicit,i=c(2);j("font-bold",e.value===i.selectedValue),n(),u(" ",d(2,3,"catalog_page.items_per_page."+(e.label==="all"?"all":e.label))," ")}}function Re(a,t){if(a&1&&(o(0,"div",5),C(1,Ae,3,5,"div",6),l()),a&2){let e=c();n(),p("ngForOf",e.sizeOptions)}}var G=class a{constructor(t){this.translate=t}selectedValue;selectedValueChange=new T;dropdownOpen=!1;sizeOptions=[{label:"6",value:6},{label:"12",value:12},{label:"all",value:-1}];toggleDropdown(){this.dropdownOpen=!this.dropdownOpen}selectOption(t){this.selectedValueChange.emit(t),this.dropdownOpen=!1}getSelectedLabel(){let t=this.sizeOptions.find(e=>e.value===this.selectedValue);if(!t)return"Select";switch(t.label){case"all":return this.translate.instant("catalog_page.items_per_page.all");case"6":return this.translate.instant("catalog_page.items_per_page.6");case"12":return this.translate.instant("catalog_page.items_per_page.12");default:return t.label}}static \u0275fac=function(e){return new(e||a)(_(Q))};static \u0275cmp=P({type:a,selectors:[["app-page-size-dropdown"]],inputs:{selectedValue:"selectedValue"},outputs:{selectedValueChange:"selectedValueChange"},decls:9,vars:7,consts:[[1,"custom-dropdown","relative","flex","items-center","gap-2"],[1,"flex","w-[80px]","cursor-pointer","items-center","justify-between","rounded","px-3","py-1",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"ml-2","h-4","w-4","transform","transition-transform","duration-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["class","absolute right-0 top-[110%] z-20 w-[80px] rounded-[16px] border p-2 bg-white dark:bg-gray-800 border-gray-300",4,"ngIf"],[1,"absolute","right-0","top-[110%]","z-20","w-[80px]","rounded-[16px]","border","p-2","bg-white","dark:bg-gray-800","border-gray-300"],["class","cursor-pointer rounded px-2 py-1 transition-colors duration-300 hover:bg-gray-200 dark:hover:bg-gray-700",3,"font-bold","click",4,"ngFor","ngForOf"],[1,"cursor-pointer","rounded","px-2","py-1","transition-colors","duration-300","hover:bg-gray-200","dark:hover:bg-gray-700",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"span"),f(2),g(3,"translate"),l(),o(4,"div",1),m("click",function(){return i.toggleDropdown()}),f(5),ne(),o(6,"svg",2),F(7,"path",3),l()(),C(8,Re,2,1,"div",4),l()),e&2&&(n(2),I(d(3,5,"catalog_page.show_label")),n(3),u(" ",i.getSelectedLabel()," "),n(),j("rotate-180",i.dropdownOpen),n(2),p("ngIf",i.dropdownOpen))},dependencies:[k,w,S,L,z],encapsulation:2})};function Ee(a,t,e){if(e===-1)return[...a];let i=(t-1)*e;return a.slice(i,i+e)}var J=class a{filterPlaces(t,e,i){return t.filter(r=>{let s=r.tags||[],M=r.city.toLowerCase();for(let y in e){let N=Object.keys(e[y]).filter(O=>e[y][O]);if(N.length!==0){if(y==="location"){let O=i.find(x=>x.key==="location");if(!N.map(x=>{let te=O?.options.find(ze=>ze.key===x);return te?te.label.toLowerCase():x.toLowerCase()}).some(x=>M.includes(x)))return!1}else if(!N.some(O=>{let ee=this.getLabelByKey(i,y,O);return s.some(x=>x.name===ee)}))return!1}}return!0})}getLabelByKey(t,e,i){return t.find(s=>s.key===e)?.options.find(s=>s.key===i)?.label||""}static \u0275fac=function(e){return new(e||a)};static \u0275prov=re({token:a,factory:a.\u0275fac,providedIn:"root"})};var Qe=["filtersPanel"];function We(a,t){if(a&1&&(E(0),F(1,"span",25),g(2,"translate"),g(3,"translate"),V()),a&2){let e=t.ngIf;n(),p("innerHTML",e!=="en"?"<br>"+d(2,1,"catalog_page.highlight"):d(3,3,"catalog_page.highlight"),oe)}}function Ze(a,t){if(a&1){let e=b();o(0,"div",26),m("click",function(){h(e);let r=c();return v(r.toggleFilters())}),o(1,"div",27,0),m("click",function(r){return h(e),v(r.stopPropagation())}),o(3,"div",28)(4,"app-icon",29),m("click",function(){h(e);let r=c();return v(r.toggleFilters())}),l()(),o(5,"app-catalog-filters",30),m("filtersChange",function(r){h(e);let s=c();return v(s.onFiltersChange(r))})("applyFiltersClicked",function(){h(e);let r=c();return v(r.toggleFilters())}),l()()()}if(a&2){let e=c();n(4),p("icon",e.ICONS.Close),n(),p("filters",e.filters)("filterCategories",e.filterCategories)}}function qe(a,t){if(a&1){let e=b();o(0,"app-place-card",31),m("unauthorizedFavoriteClick",function(){h(e);let r=c();return v(r.showLoginModal())}),l()}if(a&2){let e=t.$implicit,i=c();p("place",e)("cardType",i.PlaceCardType.Full)}}function He(a,t){a&1&&(o(0,"div",32)(1,"h3"),f(2),g(3,"translate"),l(),o(4,"p",33),f(5),g(6,"translate"),l()()),a&2&&(n(2),I(d(3,2,"catalog_page.no_cafes_found_title")),n(3),u(" ",d(6,4,"catalog_page.no_cafes_found_title_desc")," "))}var Ve=class a{constructor(t,e,i,r,s,M,y,N,O){this.router=t;this.route=e;this.loaderService=i;this.themeService=r;this.languageService=s;this.translate=M;this.placesStore=y;this.catalogFilterService=N;this.ngZone=O;this.currentTheme$=this.themeService.theme$,this.lang$=this.languageService.lang$}ICONS=ye;PlaceCardType=Se;filtersPanel;places=[];filteredPlaces=[];paginatedPlaces=[];filters={};filterCategories=U;showFilters=!1;isLoginModalVisible=!1;itemsPerPage=-1;currentPage=1;currentTheme$;lang$;destroy$=new ae;updatingFromQueryParams=!1;ngOnInit(){this.loaderService.show(),this.placesStore.loadPlaces(),this.placesStore.places$.pipe(B(this.destroy$)).subscribe({next:t=>{this.places=t||[],this.setFilterCategories(this.translate.currentLang),this.initializeFilters(),this.filterAndPaginate(),this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngZone.run(()=>{setTimeout(()=>this.loaderService.hide(),300)})},0)})},error:t=>{console.error("Error loading places:",t),this.loaderService.hide()}}),this.route.queryParams.pipe(B(this.destroy$)).subscribe(t=>{if(this.loaderService.show(),this.updatingFromQueryParams)this.updatingFromQueryParams=!1;else{this.initializeFilters();for(let e in t)this.filters[e]||(this.filters[e]={}),(Array.isArray(t[e])?t[e]:[t[e]]).forEach(r=>this.filters[e][r]=!0)}this.filterAndPaginate(),setTimeout(()=>this.loaderService.hide(),300)}),this.translate.onLangChange.pipe(B(this.destroy$)).subscribe(t=>{this.setFilterCategories(t.lang),this.initializeFilters(),this.filterAndPaginate()})}onFiltersChange(t){this.loaderService.show(),this.filters=ie({},t);let e={};for(let i in this.filters){let r=Object.keys(this.filters[i]).filter(s=>this.filters[i][s]);r.length&&(e[i]=r)}this.updatingFromQueryParams=!0,this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:""})}initializeFilters(){this.filters={};for(let t of this.filterCategories){this.filters[t.key]={};for(let e of t.options)this.filters[t.key][e.key]=!1}}toggleFilters(){this.showFilters=!this.showFilters,document.body.style.overflow=this.showFilters?"hidden":""}setFilterCategories(t){this.filterCategories=t==="uk"?we:U}onPageChange(t){this.currentPage=t,this.updatePaginatedPlaces(),window.scrollTo({top:0,behavior:"smooth"})}onPageSizeChange(t){this.itemsPerPage=t,this.currentPage=1,this.updatePaginatedPlaces()}filterAndPaginate(){this.filteredPlaces=this.catalogFilterService.filterPlaces(this.places,this.filters,this.filterCategories),this.updatePaginatedPlaces()}updatePaginatedPlaces(){this.paginatedPlaces=Ee(this.filteredPlaces,this.currentPage,this.itemsPerPage)}showLoginModal(){this.isLoginModalVisible=!0}onLoginClick(){this.isLoginModalVisible=!1,this.router.navigate(["/login"])}get hasActiveFilters(){return Object.values(this.filters).some(t=>Object.values(t).some(e=>e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)(_(ue),_(fe),_(Fe),_(W),_(Pe),_(Q),_(Te),_(J),_(le))};static \u0275cmp=P({type:a,selectors:[["app-catalog-page"]],viewQuery:function(e,i){if(e&1&&pe(Qe,5),e&2){let r;ce(r=ge())&&(i.filtersPanel=r.first)}},decls:39,vars:31,consts:[["filtersPanel",""],[1,"mx-auto","grid","w-full","max-w-[1320px]","grid-cols-4","gap-[16px]","px-[20px]","xxl:grid-cols-8","xxl:gap-[20px]","xxl:px-[0px]"],[1,"col-span-4","xxl:col-span-8"],[1,"col-span-4","mb-[60px]","text-center","text-[32px]","xxl:col-span-8","xxl:text-[64px]"],[4,"ngIf"],[1,"col-span-4","mb-[40px]","h-[48px]","rounded-[40px]","border","border-[var(--color-gray-20)]","xxl:hidden"],["aria-label","Toggle filters",1,"flex","h-full","w-full","items-center","justify-center",3,"click"],[1,"mb-4","flex","justify-end"],[3,"selectedValueChange","selectedValue"],["aria-label","Catalog filters sidebar",1,"col-span-4","hidden","xxl:col-span-2","xxl:block"],[3,"filtersChange","filters","filterCategories"],["class","fixed left-0 top-0 z-50 h-full w-full xxl:hidden","appClickOutside","","role","dialog","aria-modal","true","aria-labelledby","filters-panel-title",3,"click",4,"ngIf"],["aria-live","polite",1,"col-span-4","lg:col-span-6"],[1,"grid","grid-cols-1","gap-5","sm:grid-cols-2","lg:grid-cols-3"],[3,"place","cardType","unauthorizedFavoriteClick",4,"ngFor","ngForOf"],["class","col-span-full flex flex-col items-center justify-center gap-4 p-12 text-center","role","alert","aria-live","assertive",4,"ngIf"],[1,"col-span-4","mt-6","flex","flex-col","items-center","gap-4","lg:col-span-6","xxl:col-span-8","xxl:mb-[148px]"],["aria-label","Catalog pagination",3,"pageChange","totalItems","selectedSize","currentPage"],["width","400px","role","dialog","aria-modal","true","aria-labelledby","login-modal-title",3,"close","isOpen"],[1,"flex","flex-col","items-center","gap-3"],["id","login-modal-title",1,"mb-4","text-xl","font-semibold"],[1,"mb-6"],[1,"flex","flex-wrap","justify-end","gap-4"],["aria-label","Login",1,"button-bg-blue","min-w-[120px]","px-6","py-3",3,"click"],["aria-label","Close",1,"button-bg-transparent","px-6","py-3",3,"click"],[1,"text-[var(--color-primary)]",3,"innerHTML"],["appClickOutside","","role","dialog","aria-modal","true","aria-labelledby","filters-panel-title",1,"fixed","left-0","top-0","z-50","h-full","w-full","xxl:hidden",3,"click"],[1,"relative","h-full","w-full","overflow-y-auto","bg-[var(--color-gray-20)]","px-[20px]","pt-[12px]",3,"click"],[1,"mb-[25px]","ml-auto","flex","h-[40px]","w-[40px]","items-center","justify-center","rounded-[40px]","bg-white"],["aria-label","Close filters",1,"cursor-pointer",3,"click","icon"],[3,"filtersChange","applyFiltersClicked","filters","filterCategories"],[3,"unauthorizedFavoriteClick","place","cardType"],["role","alert","aria-live","assertive",1,"col-span-full","flex","flex-col","items-center","justify-center","gap-4","p-12","text-center"],[1,"max-w-sm"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2),F(2,"app-breadcrumbs"),l(),o(3,"h2",3),f(4),g(5,"translate"),C(6,We,4,5,"ng-container",4),g(7,"async"),l(),o(8,"div",5)(9,"button",6),m("click",function(){return i.toggleFilters()}),f(10),g(11,"translate"),l()(),o(12,"div",2)(13,"div",7)(14,"app-page-size-dropdown",8),A("selectedValueChange",function(s){return $(i.itemsPerPage,s)||(i.itemsPerPage=s),s}),m("selectedValueChange",function(s){return i.onPageSizeChange(s)}),l()()(),o(15,"div",9)(16,"app-catalog-filters",10),m("filtersChange",function(s){return i.onFiltersChange(s)}),l()(),C(17,Ze,6,3,"div",11),o(18,"div",12)(19,"div",13),C(20,qe,1,2,"app-place-card",14)(21,He,7,6,"div",15),l()(),o(22,"div",16)(23,"app-pagination",17),m("pageChange",function(s){return i.onPageChange(s)}),l()(),o(24,"app-modal",18),m("close",function(){return i.isLoginModalVisible=!1}),o(25,"div",19)(26,"h2",20),f(27),g(28,"translate"),l(),o(29,"p",21),f(30),g(31,"translate"),l(),o(32,"div",22)(33,"button",23),m("click",function(){return i.onLoginClick()}),f(34),g(35,"translate"),l(),o(36,"button",24),m("click",function(){return i.isLoginModalVisible=!1}),f(37),g(38,"translate"),l()()()()()),e&2&&(n(4),u(" ",d(5,17,"catalog_page.title")," "),n(2),p("ngIf",d(7,19,i.lang$)),n(4),u(" ",d(11,21,"catalog_page.filters_button")," "),n(4),D("selectedValue",i.itemsPerPage),n(2),p("filters",i.filters)("filterCategories",i.filterCategories),n(),p("ngIf",i.showFilters),n(3),p("ngForOf",i.paginatedPlaces),n(),p("ngIf",i.paginatedPlaces.length===0&&i.hasActiveFilters),n(2),p("totalItems",i.filteredPlaces.length)("selectedSize",i.itemsPerPage)("currentPage",i.currentPage),n(),p("isOpen",i.isLoginModalVisible),n(3),u(" ",d(28,23,"catalog_page.login_modal.title")," "),n(3),u(" ",d(31,25,"catalog_page.login_modal.description")," "),n(4),u(" ",d(35,27,"catalog_page.login_modal.login_button")," "),n(3),u(" ",d(38,29,"catalog_page.login_modal.login_button")," "))},dependencies:[k,w,S,K,L,Z,Ie,H,xe,ke,G,ve,R,z],encapsulation:2,data:{animation:[be]}})};export{Ve as CatalogPageComponent};
