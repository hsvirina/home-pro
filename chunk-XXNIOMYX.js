import{Ab as _,B as d,C as K,Ca as ce,Cb as Te,D as X,Db as _e,Eb as Fe,Fb as k,Ga as P,H as Y,Ha as A,Ka as se,L as D,La as o,Ma as c,Na as pe,O as n,Oa as le,R as m,Ra as de,T as ee,Ua as ue,Va as me,Wa as ve,Y as w,Z as M,_ as te,_a as he,a as q,ba as a,bb as fe,ca as p,da as l,ea as S,eb as ge,f as W,g as Q,gb as E,i as G,ia as R,j as x,ja as z,k as J,ka as ie,la as I,ma as g,pa as re,pb as Ce,qa as ne,ra as oe,sa as ae,t as U,ta as V,v as b,va as v,vb as be,wb as ye,xa as C,xb as Se,y as f,yb as Ie,zb as ke}from"./chunk-EAEB62OB.js";var L=(t=>(t.Full="full",t.Favourites="favourites",t.Catalog="catalog",t))(L||{});var j=class r{constructor(e,i){this.http=e;this.authService=i}baseUrl=_.user.favorites;getAuthHeaders(){let e=this.authService.getToken();return e?G(new ge({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})):x(()=>new Error("Authorization token is missing"))}addFavorite(e){return this.getAuthHeaders().pipe(U(i=>this.http.post(this.baseUrl,{cafeId:e},{headers:i})))}removeFavorite(e){return this.getAuthHeaders().pipe(U(i=>this.http.request("delete",this.baseUrl,{headers:i,body:{cafeId:e}})))}static \u0275fac=function(i){return new(i||r)(d(E),d(k))};static \u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"})};var N=class r{constructor(e,i){this.favoritesService=e;this.authService=i;this.loadFavorites()}favoritesSubject=new Q([]);favorites$=this.favoritesSubject.asObservable();loadFavorites(){let e=this.authService.getCurrentUser();e?.favoriteCafeIds?this.favoritesSubject.next(e.favoriteCafeIds):this.favoritesSubject.next([])}addFavorite(e){return this.favoritesService.addFavorite(e).pipe(b(()=>{let i=this.favoritesSubject.value;i.includes(e)||this.favoritesSubject.next([...i,e])}))}removeFavorite(e){return this.favoritesService.removeFavorite(e).pipe(b(()=>{let i=this.favoritesSubject.value.filter(t=>t!==e);this.favoritesSubject.next(i)}))}isFavorite(e){return this.favoritesSubject.value.includes(e)}static \u0275fac=function(i){return new(i||r)(d(j),d(k))};static \u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"})};var B=class r{constructor(e,i){this.authService=e;this.favoritesStore=i}isFavorite(e){return this.favoritesStore.isFavorite(e)}toggleFavorite(e){if(!this.authService.getCurrentUser())return x(()=>new Error("NOT_AUTHENTICATED"));let t=e.id,s=this.favoritesStore.isFavorite(t);return(s?this.favoritesStore.removeFavorite(t):this.favoritesStore.addFavorite(t)).pipe(b(()=>{let h=this.authService.getCurrentUser();h&&(h.favoriteCafeIds=s?h.favoriteCafeIds.filter(y=>y!==t):[...h.favoriteCafeIds,t],this.authService.updateCurrentUser(q({},h)))}),J(()=>!s))}static \u0275fac=function(i){return new(i||r)(d(k),d(N))};static \u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"})};var $=class r{constructor(e){this.http=e}checkInsUpdatedSource=new W;checkInsUpdated$=this.checkInsUpdatedSource.asObservable();checkInToCafe(e){return this.http.post(`${_.checkins.base}/${e}`,null).pipe(b(()=>this.checkInsUpdatedSource.next()))}getCheckInsByCafe(e){return this.http.get(`${_.checkins.base}/cafe/${e}`)}static \u0275fac=function(i){return new(i||r)(d(E))};static \u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"})};var Be=["tagsContainer"],$e=(r,e,i,t,s)=>({"h-[570px]":r,"h-[334px]":e,"h-[510px]":i,"bg-[var(--color-white)] hover:bg-[var(--color-gray-10)]":t,"bg-[var(--color-bg-card)] hover:bg-[var(--color-gray-100)]":s}),we=(r,e)=>({"bg-[#FFFFFF]/60":r,"bg-[#0D0D0D]/60":e}),He=(r,e)=>({"text-[var(--color-gray-75)]":r,"text-[var(--color-white)]":e}),Ue=r=>({"text-[var(--color-gray-10)]":r}),De=r=>({"text-[var(--color-white)]":r}),Me=r=>({city:r});function Re(r,e){if(r&1&&(p(0,"p",18),v(1),l()),r&2){let i=g();n(),C(" ",i.place.shortDescription," ")}}function ze(r,e){if(r&1&&(p(0,"span",22),o(1,"async"),v(2),l()),r&2){let i=e.$implicit,t=g(2);V("background-color",c(1,3,t.currentTheme$)==="dark"?t.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)"),n(2),C(" ",i.name," ")}}function Ve(r,e){if(r&1&&(p(0,"span",22),o(1,"async"),v(2," ... "),l()),r&2){let i=g(2);V("background-color",c(1,2,i.currentTheme$)==="dark"?i.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)")}}function Le(r,e){if(r&1&&(p(0,"div",19,0),R(2),w(3,ze,3,5,"span",20)(4,Ve,3,4,"span",21),z(),l()),r&2){let i=g();n(3),a("ngForOf",i.displayTags),n(),a("ngIf",i.showEllipsis)}}function Ze(r,e){if(r&1&&(R(0),S(1,"app-icon",8),v(2),o(3,"translate"),o(4,"translate"),z()),r&2){let i=g(2);n(),a("icon",i.isCheckedIn?i.ICONS.CheckCircle:i.ICONS.AddCircle),n(),C(" ",i.isCheckedIn?c(3,2,"check_in.checked_in"):c(4,4,"check_in.check_in")," ")}}function qe(r,e){r&1&&(v(0),o(1,"translate")),r&2&&C(" ",c(1,1,"button.learn_more")," ")}function We(r,e){if(r&1){let i=ie();p(0,"button",23),o(1,"translate"),o(2,"translate"),I("click",function(s){K(i);let u=g();return X(u.onCheckInClick(s))}),w(3,Ze,5,6,"ng-container",24)(4,qe,2,3,"ng-template",null,1,le),l()}if(r&2){let i=ae(5),t=g();a("disabled",t.isCheckedIn)("title",t.isCheckedIn?c(1,4,"check_in.already_checked_in"):c(2,6,"check_in.check_in")),n(3),a("ngIf",t.isAuthenticated)("ngIfElse",i)}}var Pe=class r{constructor(e,i,t,s,u,h,y,F){this.cdr=e;this.ngZone=i;this.router=t;this.favoriteToggleService=s;this.themeService=u;this.storageService=h;this.checkInsService=y;this.userService=F;this.currentTheme$=this.themeService.theme$}place;cardType="full";unauthorizedFavoriteClick=new M;favoriteToggled=new M;tagsContainer;displayTags=[];showEllipsis=!1;isHovered=!1;isCheckedIn=!1;ICONS=Ie;PlaceCardType=L;currentTheme$;ngOnChanges(){this.place?.tags&&(this.displayTags=[...this.place.tags]),this.updateCheckInStatus()}ngAfterViewInit(){this.cardType!=="full"&&this.cardType!=="catalog"||(this.displayTags=[...this.place.tags],this.updateCheckInStatus(),this.ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{let e=this.tagsContainer.nativeElement,i=getComputedStyle(e),t=parseFloat(i.gap)||0,s=e.clientWidth,u=2,h=Array.from(e.querySelectorAll("span")),y=[],F=0,Z=1;for(let T=0;T<this.place.tags.length;T++){let H=h[T]?.offsetWidth||0;if(F+H<=s)y.push(this.place.tags[T]),F+=H+t;else{if(Z++,Z>u){this.showEllipsis=!0;break}y.push(this.place.tags[T]),F=H+t}}this.ngZone.run(()=>{this.displayTags=y,this.cdr.detectChanges()})})}))}get isFavorite(){return this.favoriteToggleService.isFavorite(this.place.id)}get isAuthenticated(){return!!this.storageService.getUser()}onCardClick(){this.router.navigate(["/catalog",this.place.id])}onToggleFavorite(e){e.preventDefault(),e.stopPropagation(),this.favoriteToggleService.toggleFavorite(this.place).subscribe({next:i=>{this.cdr.detectChanges(),this.favoriteToggled.emit({placeId:this.place.id,isFavorite:i})},error:i=>{i.message==="NOT_AUTHENTICATED"?this.unauthorizedFavoriteClick.emit():alert("An error occurred while updating favorites.")}})}getGoogleMapsLink(e){return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`}updateCheckInStatus(){if(!this.place)return;let e=this.storageService.getPublicUserProfile();e&&e.checkInCafes?this.isCheckedIn=e.checkInCafes.some(i=>i.id===this.place.id):this.isCheckedIn=!1,this.cdr.detectChanges()}onCheckInClick(e){this.isAuthenticated&&(e.preventDefault(),e.stopPropagation(),!this.isCheckedIn&&this.performCheckIn())}performCheckIn(){this.checkInsService.checkInToCafe(this.place.id).subscribe({next:()=>{this.userService.getPublicUserProfile(this.storageService.getUser()?.userId||0).subscribe({next:e=>{this.storageService.setPublicUserProfile(e),this.isCheckedIn=!0,this.cdr.detectChanges(),this.router.navigate(["/catalog",this.place.id])},error:e=>{console.error("Error updating public profile:",e)}})},error:e=>{console.error("Error during check-in:",e)}})}static \u0275fac=function(i){return new(i||r)(m(de),m(te),m(Ce),m(B),m(Se),m(Fe),m($),m(_e))};static \u0275cmp=ee({type:r,selectors:[["app-place-card"]],viewQuery:function(i,t){if(i&1&&re(Be,5),i&2){let s;ne(s=oe())&&(t.tagsContainer=s.first)}},inputs:{place:"place",cardType:"cardType"},outputs:{unauthorizedFavoriteClick:"unauthorizedFavoriteClick",favoriteToggled:"favoriteToggled"},features:[Y],decls:34,vars:67,consts:[["tagsContainer",""],["learnMore",""],[1,"box-border","w-full","cursor-pointer","overflow-hidden","rounded-[40px]","transition-colors","duration-300",3,"mouseenter","mouseleave","ngClass"],[1,"block","w-full","no-underline",3,"click"],[1,"relative"],["alt","Place Image",1,"h-[222px]","w-full","rounded-t-[40px]","object-cover",3,"src"],[1,"absolute","left-[12px]","top-[12px]","z-10","flex","items-center","justify-center","gap-1","rounded-[40px]","px-2","py-[4px]","backdrop-blur",3,"ngClass"],[1,"body-font-1",3,"ngClass"],[3,"icon"],[1,"absolute","right-[12px]","top-[12px]","z-10","flex","h-[32px]","w-[32px]","items-center","justify-center","rounded-[40px]","p-[4px]","backdrop-blur",3,"click","ngClass","title"],[1,"flex","flex-col","gap-[12px]","p-[12px]",3,"ngClass"],[1,"flex","h-[52px]","items-start","justify-between"],[3,"ngClass"],["target","_blank","rel","noopener noreferrer",1,"group","flex","items-center","gap-2",3,"click","href"],[1,"body-font-1","relative","underline"],["class","body-font-1 line-clamp-3 h-[72px] overflow-hidden",4,"ngIf"],["class","flex h-[80px] flex-wrap gap-2 overflow-hidden",4,"ngIf"],["class","button-bg-transparent gap-2 py-3",3,"disabled","title","click",4,"ngIf"],[1,"body-font-1","line-clamp-3","h-[72px]","overflow-hidden"],[1,"flex","h-[80px]","flex-wrap","gap-2","overflow-hidden"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngFor","ngForOf"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngIf"],[1,"body-font-2","whitespace-nowrap","rounded-[40px]","px-[12px]","py-[8px]",2,"transition","background-color 0.3s ease"],[1,"button-bg-transparent","gap-2","py-3",3,"click","disabled","title"],[4,"ngIf","ngIfElse"]],template:function(i,t){i&1&&(p(0,"div",2),o(1,"async"),o(2,"async"),I("mouseenter",function(){return t.isHovered=!0})("mouseleave",function(){return t.isHovered=!1}),p(3,"div",3),I("click",function(){return t.onCardClick()}),p(4,"div",4),S(5,"img",5),p(6,"div",6),o(7,"async"),o(8,"async"),p(9,"span",7),o(10,"async"),o(11,"async"),v(12),l(),S(13,"app-icon",8),l(),p(14,"button",9),o(15,"translate"),o(16,"async"),o(17,"async"),I("click",function(u){return t.onToggleFavorite(u)}),S(18,"app-icon",8),o(19,"themedIcon"),l()(),p(20,"div",10),o(21,"async"),p(22,"div",11)(23,"h5",12),o(24,"async"),v(25),l()(),p(26,"a",13),I("click",function(u){return u.stopPropagation()}),S(27,"app-icon",8),p(28,"span",14),v(29),o(30,"translate"),l()(),w(31,Re,2,1,"p",15)(32,Le,5,2,"div",16)(33,We,6,8,"button",17),l()()()),i&2&&(a("ngClass",se(46,$e,t.cardType===t.PlaceCardType.Full,t.cardType===t.PlaceCardType.Favourites,t.cardType===t.PlaceCardType.Catalog,c(1,19,t.currentTheme$)==="light",c(2,21,t.currentTheme$)==="dark")),n(5),a("src",t.place.photoUrls[0],D),n(),a("ngClass",A(52,we,c(7,23,t.currentTheme$)==="light",c(8,25,t.currentTheme$)==="dark")),n(3),a("ngClass",A(55,He,c(10,27,t.currentTheme$)==="light",c(11,29,t.currentTheme$)==="dark")),n(3),C(" ",t.place.rating," "),n(),a("icon",t.ICONS.Star),n(),a("title",ce(c(15,31,"BUTTON.ADD_TO_FAVORITES")))("ngClass",A(58,we,c(16,33,t.currentTheme$)==="light",c(17,35,t.currentTheme$)==="dark")),n(4),a("icon",c(19,37,t.isFavorite?"HeartBlueFill":"HeartBlue")),n(2),a("ngClass",P(61,Ue,c(21,39,t.currentTheme$)==="dark")),n(3),a("ngClass",P(63,De,c(24,41,t.currentTheme$)==="dark")),n(2),C(" ",t.place.name," "),n(),a("href",t.getGoogleMapsLink(t.place.address),D),n(),a("icon",t.ICONS.Location),n(2),C(" ",pe(30,43,"infoSector.cityCountry",P(65,Me,t.place.city))," "),n(2),a("ngIf",t.cardType===t.PlaceCardType.Full||t.cardType===t.PlaceCardType.Catalog),n(),a("ngIf",t.cardType===t.PlaceCardType.Full||t.cardType===t.PlaceCardType.Catalog),n(),a("ngIf",t.cardType===t.PlaceCardType.Full))},dependencies:[fe,ue,me,ve,ke,ye,he,Te,be],encapsulation:2})};export{L as a,j as b,B as c,$ as d,Pe as e};
