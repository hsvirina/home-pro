import{a as Pe,b as Se}from"./chunk-EFCLJZFB.js";import{a as ke}from"./chunk-DJVKRGXL.js";import{a as U}from"./chunk-GCYQK47Q.js";import{l as he,m as ve}from"./chunk-JNKG7ZJO.js";import{a as xe}from"./chunk-BVDCD44H.js";import{a as Fe,e as we}from"./chunk-XXNIOMYX.js";import"./chunk-X25XQKGC.js";import{a as ue,c as _e,f as Ce,j as R}from"./chunk-H5V2GQTQ.js";import{Aa as B,Ba as $,C as _,D as C,E as ae,Ha as ce,La as m,Ma as f,O as n,R as h,T as P,Ua as ge,Va as w,Wa as S,Y as v,Z as T,_ as ne,_a as de,a as te,aa as oe,ba as c,bb as k,ca as o,da as l,ea as I,f as ie,ia as N,ja as D,ka as b,la as d,ma as p,nb as me,pa as le,pb as fe,qa as se,ra as pe,u as j,ua as M,ub as K,va as g,vb as O,wa as F,wb as E,xa as u,xb as Q,y as re,yb as be,za as A,zb as ye}from"./chunk-EAEB62OB.js";var ze=(r,t)=>({"border border-[var(--color-white)] bg-[var(--color-white)] text-[var(--color-gray-100)]":r,"border border-[var(--color-bg)] bg-[var(--color-bg-card)] text-[var(--color-gray-10)]":t});function Me(r,t){if(r&1){let e=b();o(0,"label",10)(1,"input",11),$("ngModelChange",function(a){let s=_(e).$implicit,V=p(2).$implicit,y=p();return B(y.internalFilters[V.key][s.key],a)||(y.internalFilters[V.key][s.key]=a),C(a)}),l(),I(2,"span",12),g(3),l()}if(r&2){let e=t.$implicit,i=p(2).$implicit,a=p();n(),A("ngModel",a.internalFilters[i.key][e.key]),n(2),u(" ",e.label," ")}}function Le(r,t){if(r&1&&(o(0,"div",6)(1,"h5"),g(2),m(3,"translate"),l(),o(4,"div",7),v(5,Me,4,2,"label",8),l(),I(6,"div",9),l()),r&2){let e=p().$implicit;n(2),F(f(3,2,e.title)),n(3),c("ngForOf",e.options)}}function je(r,t){if(r&1&&(N(0),v(1,Le,7,4,"div",5),D()),r&2){let e=t.$implicit,i=p();n(),c("ngIf",i.internalFilters[e.key])}}var W=class r{constructor(t){this.themeService=t;this.currentTheme$=this.themeService.theme$}filtersChange=new T;applyFiltersClicked=new T;_filterCategories=[];_filters={};set filterCategories(t){this._filterCategories=t,this.internalFilters=this.initializeFilters(this._filters)}get filterCategories(){return this._filterCategories}set filters(t){this._filters=t,this.internalFilters=this.initializeFilters(t)}get filters(){return this._filters}internalFilters={};currentTheme$;onApplyClick(){this.filtersChange.emit(this.deepClone(this.internalFilters)),this.applyFiltersClicked.emit()}clearAll(){for(let t in this.internalFilters)for(let e in this.internalFilters[t])this.internalFilters[t][e]=!1;this.filtersChange.emit(this.deepClone(this.internalFilters)),this.applyFiltersClicked.emit()}initializeFilters(t){let e={};for(let i of this._filterCategories){e[i.key]={};for(let a of i.options)e[i.key][a.key]=t?.[i.key]?.[a.key]??!1}return e}deepClone(t){return JSON.parse(JSON.stringify(t))}static \u0275fac=function(e){return new(e||r)(h(Q))};static \u0275cmp=P({type:r,selectors:[["app-catalog-filters"]],inputs:{filterCategories:"filterCategories",filters:"filters"},outputs:{filtersChange:"filtersChange",applyFiltersClicked:"applyFiltersClicked"},decls:15,vars:21,consts:[[1,"flex","flex-col","gap-6","rounded-[24px]","p-6","xxl:w-full",3,"ngClass"],[1,"flex","items-center","justify-between"],["type","button",3,"click"],[4,"ngFor","ngForOf"],["type","button",1,"button-font","button-bg-blue","h-12","px-6","py-3",3,"click"],["class","flex flex-col gap-3",4,"ngIf"],[1,"flex","flex-col","gap-3"],[1,"flex","flex-col","gap-2"],["class","body-font-1 flex cursor-pointer select-none items-center gap-3",4,"ngFor","ngForOf"],[1,"my-2","h-px","bg-[var(--color-gray-20)]"],[1,"body-font-1","flex","cursor-pointer","select-none","items-center","gap-3"],["type","checkbox",1,"peer","sr-only",3,"ngModelChange","ngModel"],[1,"relative","flex","h-8","w-8","items-center","justify-center","rounded-lg","border","border-[var(--color-gray-20)]","before:absolute","before:left-1/2","before:top-1/2","before:h-4","before:w-2","before:-translate-x-1/2","before:-translate-y-[60%]","before:rotate-45","before:border-b-2","before:border-r-2","before:border-[var(--color-primary)]","before:opacity-0","before:transition-opacity","peer-checked:border-[var(--color-primary)]","peer-checked:before:opacity-100"]],template:function(e,i){e&1&&(o(0,"div",0),m(1,"async"),m(2,"async"),o(3,"div",1)(4,"h5"),g(5),m(6,"translate"),l(),o(7,"button",2),m(8,"translate"),d("click",function(){return i.clearAll()}),g(9),m(10,"translate"),l()(),v(11,je,2,1,"ng-container",3),o(12,"button",4),d("click",function(){return i.onApplyClick()}),g(13),m(14,"translate"),l()()),e&2&&(c("ngClass",ce(18,ze,f(1,6,i.currentTheme$)==="light",f(2,8,i.currentTheme$)==="dark")),n(5),F(f(6,10,"catalog_page.filters.header")),n(2),oe("aria-label",f(8,12,"catalog_page.filters.clear_all_aria")),n(2),u(" ",f(10,14,"catalog_page.filters.clear_all")," "),n(2),c("ngForOf",i.filterCategories),n(2),u(" ",f(14,16,"catalog_page.filters.apply")," "))},dependencies:[k,ge,w,S,R,ue,_e,Ce,E,de,O],encapsulation:2})};function Ne(r,t){if(r&1){let e=b();o(0,"button",3),d("click",function(){let a=_(e).$implicit,s=p(2);return C(s.onPageChange(a))}),g(1),l()}if(r&2){let e=t.$implicit,i=p(2);M("bg-blue-600",e===i.currentPage)("text-white",e===i.currentPage)("bg-gray-200",e!==i.currentPage)("text-gray-700",e!==i.currentPage),c("disabled",e===i.currentPage),n(),u(" ",e," ")}}function De(r,t){if(r&1&&(N(0),o(1,"div",1),v(2,Ne,2,10,"button",2),l(),D()),r&2){let e=p();n(2),c("ngForOf",e.totalPagesArray)}}var q=class r{totalItems=0;selectedSize=6;currentPage=1;pageChange=new T;get totalPages(){return this.selectedSize===-1?1:Math.ceil(this.totalItems/this.selectedSize)}get totalPagesArray(){return Array.from({length:this.totalPages},(t,e)=>e+1)}onPageChange(t){this.pageChange.emit(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=P({type:r,selectors:[["app-pagination"]],inputs:{totalItems:"totalItems",selectedSize:"selectedSize",currentPage:"currentPage"},outputs:{pageChange:"pageChange"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"flex","w-full","justify-center","gap-2"],["class","button-bg-blue flex h-10 w-10",3,"disabled","bg-blue-600","text-white","bg-gray-200","text-gray-700","click",4,"ngFor","ngForOf"],[1,"button-bg-blue","flex","h-10","w-10",3,"click","disabled"]],template:function(e,i){e&1&&v(0,De,3,1,"ng-container",0),e&2&&c("ngIf",i.selectedSize!==-1)},dependencies:[k,w,S],encapsulation:2})};function Ae(r,t){if(r&1){let e=b();o(0,"div",7),d("click",function(){let a=_(e).$implicit,s=p(2);return C(s.selectOption(a.value))}),g(1),m(2,"translate"),l()}if(r&2){let e=t.$implicit,i=p(2);M("font-bold",e.value===i.selectedValue),n(),u(" ",f(2,3,"catalog_page.items_per_page."+(e.label==="all"?"all":e.label))," ")}}function Be(r,t){if(r&1&&(o(0,"div",5),v(1,Ae,3,5,"div",6),l()),r&2){let e=p();n(),c("ngForOf",e.sizeOptions)}}var G=class r{constructor(t){this.translate=t}selectedValue;selectedValueChange=new T;dropdownOpen=!1;sizeOptions=[{label:"6",value:6},{label:"12",value:12},{label:"all",value:-1}];toggleDropdown(){this.dropdownOpen=!this.dropdownOpen}selectOption(t){this.selectedValueChange.emit(t),this.dropdownOpen=!1}getSelectedLabel(){let t=this.sizeOptions.find(e=>e.value===this.selectedValue);if(!t)return"Select";switch(t.label){case"all":return this.translate.instant("catalog_page.items_per_page.all");case"6":return this.translate.instant("catalog_page.items_per_page.6");case"12":return this.translate.instant("catalog_page.items_per_page.12");default:return t.label}}static \u0275fac=function(e){return new(e||r)(h(K))};static \u0275cmp=P({type:r,selectors:[["app-page-size-dropdown"]],inputs:{selectedValue:"selectedValue"},outputs:{selectedValueChange:"selectedValueChange"},decls:9,vars:7,consts:[[1,"custom-dropdown","relative","flex","items-center","gap-2"],[1,"flex","w-[80px]","cursor-pointer","items-center","justify-between","rounded","px-3","py-1",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"ml-2","h-4","w-4","transform","transition-transform","duration-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["class","absolute right-0 top-[110%] z-20 w-[80px] rounded-[16px] border p-2 bg-white dark:bg-gray-800 border-gray-300",4,"ngIf"],[1,"absolute","right-0","top-[110%]","z-20","w-[80px]","rounded-[16px]","border","p-2","bg-white","dark:bg-gray-800","border-gray-300"],["class","cursor-pointer rounded px-2 py-1 transition-colors duration-300 hover:bg-gray-200 dark:hover:bg-gray-700",3,"font-bold","click",4,"ngFor","ngForOf"],[1,"cursor-pointer","rounded","px-2","py-1","transition-colors","duration-300","hover:bg-gray-200","dark:hover:bg-gray-700",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"span"),g(2),m(3,"translate"),l(),o(4,"div",1),d("click",function(){return i.toggleDropdown()}),g(5),ae(),o(6,"svg",2),I(7,"path",3),l()(),v(8,Be,2,1,"div",4),l()),e&2&&(n(2),F(f(3,5,"catalog_page.show_label")),n(3),u(" ",i.getSelectedLabel()," "),n(),M("rotate-180",i.dropdownOpen),n(2),c("ngIf",i.dropdownOpen))},dependencies:[k,w,S,E,O],encapsulation:2})};function Ie(r,t,e){if(e===-1)return[...r];let i=(t-1)*e;return r.slice(i,i+e)}var J=class r{filterPlaces(t,e,i){return t.filter(a=>{let s=a.tags||[],V=a.city.toLowerCase();for(let y in e){let L=Object.keys(e[y]).filter(z=>e[y][z]);if(L.length!==0){if(y==="location"){let z=i.find(x=>x.key==="location");if(!L.map(x=>{let ee=z?.options.find(Ee=>Ee.key===x);return ee?ee.label.toLowerCase():x.toLowerCase()}).some(x=>V.includes(x)))return!1}else if(!L.some(z=>{let Y=this.getLabelByKey(i,y,z);return s.some(x=>x.name===Y)}))return!1}}return!0})}getLabelByKey(t,e,i){return t.find(s=>s.key===e)?.options.find(s=>s.key===i)?.label||""}static \u0275fac=function(e){return new(e||r)};static \u0275prov=re({token:r,factory:r.\u0275fac,providedIn:"root"})};var Re=["filtersPanel"];function Ke(r,t){if(r&1){let e=b();o(0,"div",25),d("click",function(){_(e);let a=p();return C(a.toggleFilters())}),o(1,"div",26,0),d("click",function(a){return _(e),C(a.stopPropagation())}),o(3,"div",27)(4,"app-icon",28),d("click",function(){_(e);let a=p();return C(a.toggleFilters())}),l()(),o(5,"app-catalog-filters",29),d("filtersChange",function(a){_(e);let s=p();return C(s.onFiltersChange(a))})("applyFiltersClicked",function(){_(e);let a=p();return C(a.toggleFilters())}),l()()()}if(r&2){let e=p();n(4),c("icon",e.ICONS.Close),n(),c("filters",e.filters)("filterCategories",e.filterCategories)}}function Qe(r,t){if(r&1){let e=b();o(0,"app-place-card",30),d("unauthorizedFavoriteClick",function(){_(e);let a=p();return C(a.showLoginModal())}),l()}if(r&2){let e=t.$implicit,i=p();c("place",e)("cardType",i.PlaceCardType.Catalog)}}function We(r,t){r&1&&(o(0,"div",31)(1,"h3"),g(2),m(3,"translate"),l(),o(4,"p",32),g(5),m(6,"translate"),l()()),r&2&&(n(2),F(f(3,2,"catalog_page.no_cafes_found_title")),n(3),u(" ",f(6,4,"catalog_page.no_cafes_found_title_desc")," "))}var Oe=class r{constructor(t,e,i,a,s,V,y,L){this.router=t;this.route=e;this.loaderService=i;this.themeService=a;this.translate=s;this.placesStore=V;this.catalogFilterService=y;this.ngZone=L;this.currentTheme$=this.themeService.theme$}ICONS=be;PlaceCardType=Fe;filtersPanel;places=[];filteredPlaces=[];paginatedPlaces=[];filters={};filterCategories=U;showFilters=!1;isLoginModalVisible=!1;itemsPerPage=-1;currentPage=1;currentTheme$;destroy$=new ie;updatingFromQueryParams=!1;ngOnInit(){this.loaderService.show(),this.placesStore.loadPlaces(),this.placesStore.places$.pipe(j(this.destroy$)).subscribe({next:t=>{this.places=t||[],this.setFilterCategories(this.translate.currentLang),this.initializeFilters(),this.filterAndPaginate(),this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngZone.run(()=>{setTimeout(()=>this.loaderService.hide(),300)})},0)})},error:t=>{console.error("Error loading places:",t),this.loaderService.hide()}}),this.route.queryParams.pipe(j(this.destroy$)).subscribe(t=>{if(this.loaderService.show(),this.updatingFromQueryParams)this.updatingFromQueryParams=!1;else{this.initializeFilters();for(let e in t)this.filters[e]||(this.filters[e]={}),(Array.isArray(t[e])?t[e]:[t[e]]).forEach(a=>this.filters[e][a]=!0)}this.filterAndPaginate(),setTimeout(()=>this.loaderService.hide(),300)}),this.translate.onLangChange.pipe(j(this.destroy$)).subscribe(t=>{this.setFilterCategories(t.lang),this.initializeFilters(),this.filterAndPaginate()})}onFiltersChange(t){this.loaderService.show(),this.filters=te({},t);let e={};for(let i in this.filters){let a=Object.keys(this.filters[i]).filter(s=>this.filters[i][s]);a.length&&(e[i]=a)}this.updatingFromQueryParams=!0,this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:""})}initializeFilters(){this.filters={};for(let t of this.filterCategories){this.filters[t.key]={};for(let e of t.options)this.filters[t.key][e.key]=!1}}toggleFilters(){this.showFilters=!this.showFilters,document.body.style.overflow=this.showFilters?"hidden":""}setFilterCategories(t){this.filterCategories=t==="uk"?Pe:U}onPageChange(t){this.currentPage=t,this.updatePaginatedPlaces(),window.scrollTo({top:0,behavior:"smooth"})}onPageSizeChange(t){this.itemsPerPage=t,this.currentPage=1,this.updatePaginatedPlaces()}filterAndPaginate(){this.filteredPlaces=this.catalogFilterService.filterPlaces(this.places,this.filters,this.filterCategories),this.updatePaginatedPlaces()}updatePaginatedPlaces(){this.paginatedPlaces=Ie(this.filteredPlaces,this.currentPage,this.itemsPerPage)}showLoginModal(){this.isLoginModalVisible=!0}onLoginClick(){this.isLoginModalVisible=!1,this.router.navigate(["/login"])}get hasActiveFilters(){return Object.values(this.filters).some(t=>Object.values(t).some(e=>e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||r)(h(fe),h(me),h(xe),h(Q),h(K),h(Se),h(J),h(ne))};static \u0275cmp=P({type:r,selectors:[["app-catalog-page"]],viewQuery:function(e,i){if(e&1&&le(Re,5),e&2){let a;se(a=pe())&&(i.filtersPanel=a.first)}},decls:40,vars:31,consts:[["filtersPanel",""],[1,"mx-auto","grid","w-full","max-w-[1320px]","grid-cols-4","gap-[16px]","px-[20px]","xxl:grid-cols-8","xxl:gap-[20px]","xxl:px-[0px]"],[1,"col-span-4","xxl:col-span-8"],[1,"col-span-4","mb-[60px]","text-center","text-[32px]","xxl:col-span-8","xxl:text-[64px]"],[1,"text-[var(--color-primary)]"],[1,"col-span-4","mb-[40px]","h-[48px]","rounded-[40px]","border","border-[var(--color-gray-20)]","xxl:hidden"],["aria-label","Toggle filters",1,"flex","h-full","w-full","items-center","justify-center",3,"click"],[1,"mb-4","flex","justify-end"],[3,"selectedValueChange","selectedValue"],["aria-label","Catalog filters sidebar",1,"col-span-4","hidden","xxl:col-span-2","xxl:block"],[3,"filtersChange","filters","filterCategories"],["class","fixed left-0 top-0 z-50 h-full w-full xxl:hidden","appClickOutside","","role","dialog","aria-modal","true","aria-labelledby","filters-panel-title",3,"click",4,"ngIf"],["aria-live","polite",1,"col-span-4","lg:col-span-6"],[1,"grid","grid-cols-1","gap-5","sm:grid-cols-2","lg:grid-cols-3"],[3,"place","cardType","unauthorizedFavoriteClick",4,"ngFor","ngForOf"],["class","col-span-full flex flex-col items-center justify-center gap-4 p-12 text-center","role","alert","aria-live","assertive",4,"ngIf"],[1,"col-span-4","mt-6","flex","flex-col","items-center","gap-4","lg:col-span-6","xxl:col-span-8","xxl:mb-[148px]"],["aria-label","Catalog pagination",3,"pageChange","totalItems","selectedSize","currentPage"],["width","400px","role","dialog","aria-modal","true","aria-labelledby","login-modal-title",3,"close","isOpen"],[1,"flex","flex-col","items-center","gap-3"],["id","login-modal-title",1,"mb-4","text-xl","font-semibold"],[1,"mb-6"],[1,"flex","flex-wrap","justify-end","gap-4"],["aria-label","Login",1,"button-bg-blue","min-w-[120px]","px-6","py-3",3,"click"],["aria-label","Close",1,"button-bg-transparent","px-6","py-3",3,"click"],["appClickOutside","","role","dialog","aria-modal","true","aria-labelledby","filters-panel-title",1,"fixed","left-0","top-0","z-50","h-full","w-full","xxl:hidden",3,"click"],[1,"relative","h-full","w-full","overflow-y-auto","bg-[var(--color-gray-20)]","px-[20px]","pt-[12px]",3,"click"],[1,"mb-[25px]","ml-auto","flex","h-[40px]","w-[40px]","items-center","justify-center","rounded-[40px]","bg-white"],["aria-label","Close filters",1,"cursor-pointer",3,"click","icon"],[3,"filtersChange","applyFiltersClicked","filters","filterCategories"],[3,"unauthorizedFavoriteClick","place","cardType"],["role","alert","aria-live","assertive",1,"col-span-full","flex","flex-col","items-center","justify-center","gap-4","p-12","text-center"],[1,"max-w-sm"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2),I(2,"app-breadcrumbs"),l(),o(3,"h2",3),g(4),m(5,"translate"),o(6,"span",4),g(7),m(8,"translate"),l()(),o(9,"div",5)(10,"button",6),d("click",function(){return i.toggleFilters()}),g(11),m(12,"translate"),l()(),o(13,"div",2)(14,"div",7)(15,"app-page-size-dropdown",8),$("selectedValueChange",function(s){return B(i.itemsPerPage,s)||(i.itemsPerPage=s),s}),d("selectedValueChange",function(s){return i.onPageSizeChange(s)}),l()()(),o(16,"div",9)(17,"app-catalog-filters",10),d("filtersChange",function(s){return i.onFiltersChange(s)}),l()(),v(18,Ke,6,3,"div",11),o(19,"div",12)(20,"div",13),v(21,Qe,1,2,"app-place-card",14)(22,We,7,6,"div",15),l()(),o(23,"div",16)(24,"app-pagination",17),d("pageChange",function(s){return i.onPageChange(s)}),l()(),o(25,"app-modal",18),d("close",function(){return i.isLoginModalVisible=!1}),o(26,"div",19)(27,"h2",20),g(28),m(29,"translate"),l(),o(30,"p",21),g(31),m(32,"translate"),l(),o(33,"div",22)(34,"button",23),d("click",function(){return i.onLoginClick()}),g(35),m(36,"translate"),l(),o(37,"button",24),d("click",function(){return i.isLoginModalVisible=!1}),g(38),m(39,"translate"),l()()()()()),e&2&&(n(4),u(" ",f(5,17,"catalog_page.title")," "),n(3),F(f(8,19,"catalog_page.highlight")),n(4),u(" ",f(12,21,"catalog_page.filters_button")," "),n(4),A("selectedValue",i.itemsPerPage),n(2),c("filters",i.filters)("filterCategories",i.filterCategories),n(),c("ngIf",i.showFilters),n(3),c("ngForOf",i.paginatedPlaces),n(),c("ngIf",i.paginatedPlaces.length===0&&i.hasActiveFilters),n(2),c("totalItems",i.filteredPlaces.length)("selectedSize",i.itemsPerPage)("currentPage",i.currentPage),n(),c("isOpen",i.isLoginModalVisible),n(3),u(" ",f(29,23,"catalog_page.login_modal.title")," "),n(3),u(" ",f(32,25,"catalog_page.login_modal.description")," "),n(4),u(" ",f(36,27,"catalog_page.login_modal.login_button")," "),n(3),u(" ",f(39,29,"catalog_page.login_modal.login_button")," "))},dependencies:[k,w,S,R,E,W,ke,q,ye,we,G,he,O],encapsulation:2,data:{animation:[ve]}})};export{Oe as CatalogPageComponent};
