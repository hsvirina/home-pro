import{A as d,B as Y,Ba as se,Bb as _e,C as J,Cb as ke,Db as Fe,Eb as T,Fa as E,G as X,Ga as P,Ja as ce,K as D,Ka as n,La as s,Ma as pe,N as o,Na as le,Q as m,Qa as de,S as ee,Ta as ue,Ua as me,Va as ve,X as w,Y as M,Z as te,Za as fe,a as Z,aa as a,ab as he,ba as p,ca as l,da as S,db as ge,f as q,fb as A,g as W,ha as R,i as Q,ia as z,j as x,ja as ie,k as G,ka as I,la as g,oa as re,ob as Ce,pa as oe,qa as ne,ra as ae,s as U,sa as K,sb as be,u as b,ua as v,vb as ye,wa as C,wb as Se,x as h,xb as Ie,yb as Te,zb as k}from"./chunk-WDYIKGVT.js";var L=(t=>(t.Full="full",t.Favourites="favourites",t.Catalog="catalog",t))(L||{});var j=class r{constructor(e,i){this.http=e;this.authService=i}baseUrl=k.user.favorites;getAuthHeaders(){let e=this.authService.getToken();return e?Q(new ge({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})):x(()=>new Error("Authorization token is missing"))}addFavorite(e){return this.getAuthHeaders().pipe(U(i=>this.http.post(this.baseUrl,{cafeId:e},{headers:i})))}removeFavorite(e){return this.getAuthHeaders().pipe(U(i=>this.http.request("delete",this.baseUrl,{headers:i,body:{cafeId:e}})))}static \u0275fac=function(i){return new(i||r)(d(A),d(T))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var O=class r{constructor(e,i){this.favoritesService=e;this.authService=i;this.loadFavorites()}favoritesSubject=new W([]);favorites$=this.favoritesSubject.asObservable();loadFavorites(){let e=this.authService.getCurrentUser();e?.favoriteCafeIds?this.favoritesSubject.next(e.favoriteCafeIds):this.favoritesSubject.next([])}addFavorite(e){return this.favoritesService.addFavorite(e).pipe(b(()=>{let i=this.favoritesSubject.value;i.includes(e)||this.favoritesSubject.next([...i,e])}))}removeFavorite(e){return this.favoritesService.removeFavorite(e).pipe(b(()=>{let i=this.favoritesSubject.value.filter(t=>t!==e);this.favoritesSubject.next(i)}))}isFavorite(e){return this.favoritesSubject.value.includes(e)}static \u0275fac=function(i){return new(i||r)(d(j),d(T))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var H=class r{constructor(e,i){this.authService=e;this.favoritesStore=i}isFavorite(e){return this.favoritesStore.isFavorite(e)}toggleFavorite(e){if(!this.authService.getCurrentUser())return x(()=>new Error("NOT_AUTHENTICATED"));let t=e.id,c=this.favoritesStore.isFavorite(t);return(c?this.favoritesStore.removeFavorite(t):this.favoritesStore.addFavorite(t)).pipe(b(()=>{let f=this.authService.getCurrentUser();f&&(f.favoriteCafeIds=c?f.favoriteCafeIds.filter(y=>y!==t):[...f.favoriteCafeIds,t],this.authService.updateCurrentUser(Z({},f)))}),G(()=>!c))}static \u0275fac=function(i){return new(i||r)(d(T),d(O))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var B=class r{constructor(e){this.http=e}checkInsUpdatedSource=new q;checkInsUpdated$=this.checkInsUpdatedSource.asObservable();checkInToCafe(e){return this.http.post(`${k.checkins.base}/${e}`,null).pipe(b(()=>this.checkInsUpdatedSource.next()))}getCheckInsByCafe(e){return this.http.get(`${k.checkins.base}/cafe/${e}`)}static \u0275fac=function(i){return new(i||r)(d(A))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var He=["tagsContainer"],Be=(r,e,i,t,c)=>({"h-[570px]":r,"h-[334px]":e,"h-[510px]":i,"bg-[var(--color-white)] hover:bg-[var(--color-gray-10)]":t,"bg-[var(--color-bg-card)] hover:bg-[var(--color-gray-100)]":c}),we=(r,e)=>({"bg-[#FFFFFF]/60":r,"bg-[#0D0D0D]/60":e}),$e=(r,e)=>({"text-[var(--color-gray-75)]":r,"text-[var(--color-white)]":e}),Ue=r=>({"text-[var(--color-gray-10)]":r}),De=r=>({"text-[var(--color-white)]":r}),Me=r=>({city:r});function Re(r,e){if(r&1&&(p(0,"p",18),v(1),l()),r&2){let i=g();o(),C(" ",i.place.shortDescription," ")}}function ze(r,e){if(r&1&&(p(0,"span",22),n(1,"async"),v(2),l()),r&2){let i=e.$implicit,t=g(2);K("background-color",s(1,3,t.currentTheme$)==="dark"?t.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)"),o(2),C(" ",i.name," ")}}function Ke(r,e){if(r&1&&(p(0,"span",22),n(1,"async"),v(2," ... "),l()),r&2){let i=g(2);K("background-color",s(1,2,i.currentTheme$)==="dark"?i.isHovered?"var(--color-bg)":"var(--color-gray-100)":"var(--color-secondary)")}}function Le(r,e){if(r&1&&(p(0,"div",19,0),R(2),w(3,ze,3,5,"span",20)(4,Ke,3,4,"span",21),z(),l()),r&2){let i=g();o(3),a("ngForOf",i.displayTags),o(),a("ngIf",i.showEllipsis)}}function Ve(r,e){if(r&1&&(R(0),S(1,"app-icon",8),v(2),n(3,"translate"),n(4,"translate"),z()),r&2){let i=g(2);o(),a("icon",i.isCheckedIn?i.ICONS.CheckCircle:i.ICONS.AddCircle),o(),C(" ",i.isCheckedIn?s(3,2,"CHECK_IN.CHECKED_IN"):s(4,4,"CHECK_IN.CHECK_IN")," ")}}function Ze(r,e){r&1&&(v(0),n(1,"translate")),r&2&&C(" ",s(1,1,"button.learn_more")," ")}function qe(r,e){if(r&1){let i=ie();p(0,"button",23),n(1,"translate"),n(2,"translate"),I("click",function(c){Y(i);let u=g();return J(u.onCheckInClick(c))}),w(3,Ve,5,6,"ng-container",24)(4,Ze,2,3,"ng-template",null,1,le),l()}if(r&2){let i=ae(5),t=g();a("disabled",t.isCheckedIn)("title",t.isCheckedIn?s(1,4,"CHECK_IN.ALREADY_CHECKED_IN"):s(2,6,"CHECK_IN.CHECK_IN")),o(3),a("ngIf",t.isAuthenticated)("ngIfElse",i)}}var Ee=class r{constructor(e,i,t,c,u,f,y,F){this.cdr=e;this.ngZone=i;this.router=t;this.favoriteToggleService=c;this.themeService=u;this.storageService=f;this.checkInsService=y;this.userService=F;this.currentTheme$=this.themeService.theme$}place;cardType="full";unauthorizedFavoriteClick=new M;favoriteToggled=new M;tagsContainer;displayTags=[];showEllipsis=!1;isHovered=!1;isCheckedIn=!1;ICONS=Ie;PlaceCardType=L;currentTheme$;ngOnChanges(){this.place?.tags&&(this.displayTags=[...this.place.tags]),this.updateCheckInStatus()}ngAfterViewInit(){this.cardType!=="full"&&this.cardType!=="catalog"||(this.displayTags=[...this.place.tags],this.updateCheckInStatus(),this.ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{let e=this.tagsContainer.nativeElement,i=getComputedStyle(e),t=parseFloat(i.gap)||0,c=e.clientWidth,u=2,f=Array.from(e.querySelectorAll("span")),y=[],F=0,V=1;for(let _=0;_<this.place.tags.length;_++){let $=f[_]?.offsetWidth||0;if(F+$<=c)y.push(this.place.tags[_]),F+=$+t;else{if(V++,V>u){this.showEllipsis=!0;break}y.push(this.place.tags[_]),F=$+t}}this.ngZone.run(()=>{this.displayTags=y,this.cdr.detectChanges()})})}))}get isFavorite(){return this.favoriteToggleService.isFavorite(this.place.id)}get isAuthenticated(){return!!this.storageService.getUser()}onCardClick(){this.router.navigate(["/catalog",this.place.id])}onToggleFavorite(e){e.preventDefault(),e.stopPropagation(),this.favoriteToggleService.toggleFavorite(this.place).subscribe({next:i=>{this.cdr.detectChanges(),this.favoriteToggled.emit({placeId:this.place.id,isFavorite:i})},error:i=>{i.message==="NOT_AUTHENTICATED"?this.unauthorizedFavoriteClick.emit():alert("An error occurred while updating favorites.")}})}getGoogleMapsLink(e){return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`}updateCheckInStatus(){if(!this.place)return;let e=this.storageService.getPublicUserProfile();e&&e.checkInCafes?this.isCheckedIn=e.checkInCafes.some(i=>i.id===this.place.id):this.isCheckedIn=!1,this.cdr.detectChanges()}onCheckInClick(e){this.isAuthenticated&&(e.preventDefault(),e.stopPropagation(),!this.isCheckedIn&&this.performCheckIn())}performCheckIn(){this.checkInsService.checkInToCafe(this.place.id).subscribe({next:()=>{this.userService.getPublicUserProfile(this.storageService.getUser()?.userId||0).subscribe({next:e=>{this.storageService.setPublicUserProfile(e),this.isCheckedIn=!0,this.cdr.detectChanges(),this.router.navigate(["/catalog",this.place.id])},error:e=>{console.error("Error updating public profile:",e)}})},error:e=>{console.error("Error during check-in:",e)}})}static \u0275fac=function(i){return new(i||r)(m(de),m(te),m(Ce),m(H),m(be),m(Fe),m(B),m(ke))};static \u0275cmp=ee({type:r,selectors:[["app-place-card"]],viewQuery:function(i,t){if(i&1&&re(He,5),i&2){let c;oe(c=ne())&&(t.tagsContainer=c.first)}},inputs:{place:"place",cardType:"cardType"},outputs:{unauthorizedFavoriteClick:"unauthorizedFavoriteClick",favoriteToggled:"favoriteToggled"},features:[X],decls:34,vars:67,consts:[["tagsContainer",""],["learnMore",""],[1,"box-border","w-full","cursor-pointer","overflow-hidden","rounded-[40px]","transition-colors","duration-300",3,"mouseenter","mouseleave","ngClass"],[1,"block","w-full","no-underline",3,"click"],[1,"relative"],["alt","Place Image",1,"h-[222px]","w-full","rounded-t-[40px]","object-cover",3,"src"],[1,"absolute","left-[12px]","top-[12px]","z-10","flex","items-center","justify-center","gap-1","rounded-[40px]","px-2","py-[4px]","backdrop-blur",3,"ngClass"],[1,"body-font-1",3,"ngClass"],[3,"icon"],[1,"absolute","right-[12px]","top-[12px]","z-10","flex","h-[32px]","w-[32px]","items-center","justify-center","rounded-[40px]","p-[4px]","backdrop-blur",3,"click","ngClass","title"],[1,"flex","flex-col","gap-[12px]","p-[12px]",3,"ngClass"],[1,"flex","h-[52px]","items-start","justify-between"],[3,"ngClass"],["target","_blank","rel","noopener noreferrer",1,"group","flex","items-center","gap-2",3,"click","href"],[1,"body-font-1","relative","underline"],["class","body-font-1 line-clamp-3 h-[72px] overflow-hidden",4,"ngIf"],["class","flex h-[80px] flex-wrap gap-2 overflow-hidden",4,"ngIf"],["class","button-bg-transparent gap-2 py-3",3,"disabled","title","click",4,"ngIf"],[1,"body-font-1","line-clamp-3","h-[72px]","overflow-hidden"],[1,"flex","h-[80px]","flex-wrap","gap-2","overflow-hidden"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngFor","ngForOf"],["class","body-font-2 whitespace-nowrap rounded-[40px] px-[12px] py-[8px]","style","transition: background-color 0.3s ease",3,"background-color",4,"ngIf"],[1,"body-font-2","whitespace-nowrap","rounded-[40px]","px-[12px]","py-[8px]",2,"transition","background-color 0.3s ease"],[1,"button-bg-transparent","gap-2","py-3",3,"click","disabled","title"],[4,"ngIf","ngIfElse"]],template:function(i,t){i&1&&(p(0,"div",2),n(1,"async"),n(2,"async"),I("mouseenter",function(){return t.isHovered=!0})("mouseleave",function(){return t.isHovered=!1}),p(3,"div",3),I("click",function(){return t.onCardClick()}),p(4,"div",4),S(5,"img",5),p(6,"div",6),n(7,"async"),n(8,"async"),p(9,"span",7),n(10,"async"),n(11,"async"),v(12),l(),S(13,"app-icon",8),l(),p(14,"button",9),n(15,"translate"),n(16,"async"),n(17,"async"),I("click",function(u){return t.onToggleFavorite(u)}),S(18,"app-icon",8),n(19,"themedIcon"),l()(),p(20,"div",10),n(21,"async"),p(22,"div",11)(23,"h5",12),n(24,"async"),v(25),l()(),p(26,"a",13),I("click",function(u){return u.stopPropagation()}),S(27,"app-icon",8),p(28,"span",14),v(29),n(30,"translate"),l()(),w(31,Re,2,1,"p",15)(32,Le,5,2,"div",16)(33,qe,6,8,"button",17),l()()()),i&2&&(a("ngClass",ce(46,Be,t.cardType===t.PlaceCardType.Full,t.cardType===t.PlaceCardType.Favourites,t.cardType===t.PlaceCardType.Catalog,s(1,19,t.currentTheme$)==="light",s(2,21,t.currentTheme$)==="dark")),o(5),a("src",t.place.photoUrls[0],D),o(),a("ngClass",P(52,we,s(7,23,t.currentTheme$)==="light",s(8,25,t.currentTheme$)==="dark")),o(3),a("ngClass",P(55,$e,s(10,27,t.currentTheme$)==="light",s(11,29,t.currentTheme$)==="dark")),o(3),C(" ",t.place.rating," "),o(),a("icon",t.ICONS.Star),o(),a("title",se(s(15,31,"BUTTON.ADD_TO_FAVORITES")))("ngClass",P(58,we,s(16,33,t.currentTheme$)==="light",s(17,35,t.currentTheme$)==="dark")),o(4),a("icon",s(19,37,t.isFavorite?"HeartBlueFill":"HeartBlue")),o(2),a("ngClass",E(61,Ue,s(21,39,t.currentTheme$)==="dark")),o(3),a("ngClass",E(63,De,s(24,41,t.currentTheme$)==="dark")),o(2),C(" ",t.place.name," "),o(),a("href",t.getGoogleMapsLink(t.place.address),D),o(),a("icon",t.ICONS.Location),o(2),C(" ",pe(30,43,"infoSector.cityCountry",E(65,Me,t.place.city))," "),o(2),a("ngIf",t.cardType===t.PlaceCardType.Full||t.cardType===t.PlaceCardType.Catalog),o(),a("ngIf",t.cardType===t.PlaceCardType.Full||t.cardType===t.PlaceCardType.Catalog),o(),a("ngIf",t.cardType===t.PlaceCardType.Full))},dependencies:[he,ue,me,ve,Te,Se,fe,_e,ye],encapsulation:2})};export{L as a,j as b,H as c,B as d,Ee as e};
